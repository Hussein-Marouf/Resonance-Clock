import { useState, useEffect, useMemo, useCallback } from ‚Äúreact‚Äù;
import { AreaChart, Area, LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, ReferenceLine } from ‚Äúrecharts‚Äù;

const PHASES = [
{ id:1, name:‚ÄúRest‚Äù,        symbol:‚Äúüåô‚Äù, start:0,    end:6.95,  fill:‚Äù#1a1650‚Äù, stroke:‚Äù#a5b4fc‚Äù, glow:‚Äù#818cf8‚Äù, desc:‚ÄúDeep restoration & memory consolidation‚Äù, science:‚ÄúGrowth hormone secretion peaks. Neural synaptic pruning. Hippocampal consolidation via slow-wave sleep. Glymphatic system clears adenosine and metabolic waste.‚Äù, best:[‚ÄúSleep‚Äù,‚ÄúRest‚Äù,‚ÄúMeditation‚Äù], avoid:[‚ÄúStimulants‚Äù,‚ÄúScreens‚Äù,‚ÄúHeavy food‚Äù] },
{ id:2, name:‚ÄúAwakening‚Äù,   symbol:‚ÄúüåÖ‚Äù, start:6.95, end:8.5,   fill:‚Äù#6b2d00‚Äù, stroke:‚Äù#fcd34d‚Äù, glow:‚Äù#fbbf24‚Äù, desc:‚ÄúCortisol Awakening Response activates the system‚Äù, science:‚ÄúHPA axis cortisol surge (CAR) within 30‚Äì45 min of waking. Blood pressure and heart rate rise rapidly. Delay caffeine 90 min to preserve the natural CAR (Brabant 1990).‚Äù, best:[‚ÄúPlanning‚Äù,‚ÄúLight exercise‚Äù,‚ÄúJournaling‚Äù], avoid:[‚ÄúCaffeine (delay 90 min)‚Äù,‚ÄúHigh-stakes decisions‚Äù] },
{ id:3, name:‚ÄúFocus Rise‚Äù,  symbol:‚Äú‚ö°‚Äù, start:8.5,  end:10.0,  fill:‚Äù#0d3d38‚Äù, stroke:‚Äù#5eead4‚Äù, glow:‚Äù#2dd4bf‚Äù, desc:‚ÄúDopamine & norepinephrine build cognitive clarity‚Äù, science:‚ÄúDopamine and norepinephrine rising sharply. Prefrontal cortex activation strengthens. Working memory capacity expanding. Best for structured analytical intake.‚Äù, best:[‚ÄúDeep work‚Äù,‚ÄúWriting‚Äù,‚ÄúAnalysis‚Äù], avoid:[‚ÄúMultitasking‚Äù,‚ÄúPassive meetings‚Äù] },
{ id:4, name:‚ÄúPeak Focus‚Äù,  symbol:‚ÄúüéØ‚Äù, start:10.0, end:12.5,  fill:‚Äù#6b2200‚Äù, stroke:‚Äù#fb923c‚Äù, glow:‚Äù#f97316‚Äù, desc:‚ÄúDaily apex ‚Äî cortisol & alertness both maximal‚Äù, science:‚ÄúCortisol and alertness at daily apex (Van Cauter 1999). Reaction time, working memory, and executive function are all optimal. Reserve this window fiercely.‚Äù, best:[‚ÄúComplex decisions‚Äù,‚ÄúLearning‚Äù,‚ÄúProblem solving‚Äù], avoid:[‚ÄúInterruptions‚Äù,‚ÄúLow-value tasks‚Äù] },
{ id:5, name:‚ÄúIntegration‚Äù, symbol:‚Äúüîó‚Äù, start:12.5, end:14.5,  fill:‚Äù#053d2f‚Äù, stroke:‚Äù#34d399‚Äù, glow:‚Äù#10b981‚Äù, desc:‚ÄúSerotonin supports social bonding & consolidation‚Äù, science:‚ÄúPost-peak serotonin supports empathy and social bonding. Post-lunch dip (PLD) is physiological, not a failure. Ideal for collaborative synthesis.‚Äù, best:[‚ÄúMeetings‚Äù,‚ÄúCollaboration‚Äù,‚ÄúLunch‚Äù], avoid:[‚ÄúCritical solo analysis‚Äù,‚ÄúMajor decisions‚Äù] },
{ id:6, name:‚ÄúCreative‚Äù,    symbol:‚Äúüé®‚Äù, start:14.5, end:16.5,  fill:‚Äù#3b1580‚Äù, stroke:‚Äù#c084fc‚Äù, glow:‚Äù#a78bfa‚Äù, desc:‚ÄúReduced inhibition unlocks divergent thinking‚Äù, science:‚ÄúSlightly reduced prefrontal inhibition enables novel associative connections. Core temperature still elevated. Lateral thinking and creative synthesis naturally emerge.‚Äù, best:[‚ÄúBrainstorming‚Äù,‚ÄúArt‚Äù,‚ÄúLateral thinking‚Äù], avoid:[‚ÄúRigid analysis‚Äù,‚ÄúDetailed editing‚Äù] },
{ id:7, name:‚ÄúVitality‚Äù,    symbol:‚Äúüî•‚Äù, start:16.5, end:18.5,  fill:‚Äù#6b1010‚Äù, stroke:‚Äù#f87171‚Äù, glow:‚Äù#ef4444‚Äù, desc:‚ÄúCore temperature peaks ‚Üí physical performance apex‚Äù, science:‚ÄúBody temperature peaks at ~17:00 (Refinetti 2010). Muscle strength, VO2 max, cardiovascular efficiency, and neuromuscular coordination are all maximal.‚Äù, best:[‚ÄúExercise‚Äù,‚ÄúSport‚Äù,‚ÄúPhysical work‚Äù], avoid:[‚ÄúDemanding mental tasks‚Äù] },
{ id:8, name:‚ÄúWind Down‚Äù,   symbol:‚ÄúüåÜ‚Äù, start:18.5, end:21.0,  fill:‚Äù#6b0f3a‚Äù, stroke:‚Äù#f9a8d4‚Äù, glow:‚Äù#ec4899‚Äù, desc:‚ÄúParasympathetic shift ‚Äî serotonin‚Üímelatonin conversion‚Äù, science:‚ÄúTemperature falling. Serotonin‚Üímelatonin conversion begins in pineal gland. Blue light at 480nm suppresses melatonin onset by up to 50%.‚Äù, best:[‚ÄúLight social‚Äù,‚ÄúCooking‚Äù,‚ÄúReflection‚Äù], avoid:[‚ÄúIntense exercise‚Äù,‚ÄúBlue light‚Äù,‚ÄúNews‚Äù] },
{ id:9, name:‚ÄúPreparation‚Äù, symbol:‚Äúüåå‚Äù, start:21.0, end:24.0,  fill:‚Äù#091235‚Äù, stroke:‚Äù#93c5fd‚Äù, glow:‚Äù#60a5fa‚Äù, desc:‚ÄúMelatonin rises ‚Äî sleep architecture initiating‚Äù, science:‚ÄúPineal gland melatonin secretion rises sharply (Lewy 1999). Core temperature continues dropping. Protect this window: light, alcohol, and stimulants all delay sleep onset.‚Äù, best:[‚ÄúReading‚Äù,‚ÄúMeditation‚Äù,‚ÄúJournaling‚Äù], avoid:[‚ÄúScreens‚Äù,‚ÄúCaffeine‚Äù,‚ÄúAlcohol‚Äù] },
];

const ACTIVITIES = [
{ name:‚ÄúDeep Work‚Äù, icon:‚Äúüí°‚Äù, optimalPhases:[3,4] }, { name:‚ÄúExercise‚Äù, icon:‚ÄúüèãÔ∏è‚Äù, optimalPhases:[7,2] },
{ name:‚ÄúCreative‚Äù,  icon:‚Äúüé®‚Äù, optimalPhases:[6,3] }, { name:‚ÄúMeetings‚Äù, icon:‚Äúüë•‚Äù, optimalPhases:[5,4] },
{ name:‚ÄúLearning‚Äù,  icon:‚Äúüìö‚Äù, optimalPhases:[4,3] }, { name:‚ÄúRest/Nap‚Äù, icon:‚Äúüò¥‚Äù, optimalPhases:[1,9] },
{ name:‚ÄúSocial‚Äù,    icon:‚Äúü§ù‚Äù, optimalPhases:[5,8] }, { name:‚ÄúPlanning‚Äù, icon:‚Äúüìã‚Äù, optimalPhases:[2,4] },
{ name:‚ÄúMeditation‚Äù,icon:‚Äúüßò‚Äù, optimalPhases:[1,9] }, { name:‚ÄúSport‚Äù,    icon:‚Äú‚öΩ‚Äù, optimalPhases:[7,6] },
];

function clamp(v){ return Math.max(0.02,Math.min(0.98,v)); }
function cosH(n,t,p){ return Math.cos(2*Math.PI*n*(t-p)/24); }
function cortisol(t) { return clamp(0.5+0.32*cosH(1,t,7.5)+0.10*cosH(2,t,7.5)+0.04*cosH(3,t,7.5)+0.02*cosH(4,t,7.5)); }
function bodyTemp(t) { return clamp(0.5+0.28*cosH(1,t,17.0)+0.07*cosH(2,t,17.0)+0.02*cosH(3,t,17.0)); }
function melatonin(t){ return clamp(0.5+0.38*cosH(1,t,3.0)+0.08*cosH(2,t,3.0)+0.02*cosH(3,t,3.0)); }
function composite(t){ return 0.5*cortisol(t)+0.3*bodyTemp(t)+0.2*melatonin(t); }

function hDeg(h){ return (h/24)*360; }
function toXY(cx,cy,r,deg){ const rad=(deg-90)*Math.PI/180; return [cx+r*Math.cos(rad),cy+r*Math.sin(rad)]; }
function arcD(cx,cy,r1,r2,h1,h2){
const a1=hDeg(h1),a2=hDeg(Math.min(h2,23.9999));
const [x1,y1]=toXY(cx,cy,r2,a1),[x2,y2]=toXY(cx,cy,r2,a2);
const [ix1,iy1]=toXY(cx,cy,r1,a2),[ix2,iy2]=toXY(cx,cy,r1,a1);
const lg=(a2-a1)>180?1:0;
return `M${x1},${y1} A${r2},${r2} 0 ${lg},1 ${x2},${y2} L${ix1},${iy1} A${r1},${r1} 0 ${lg},0 ${ix2},${iy2}Z`;
}
function wavePath(cx,cy,rMin,rMax,fn,n=300){
return Array.from({length:n+1},(_,i)=>{
const t=(i/n)*24,r=rMin+(rMax-rMin)*fn(t);
const [x,y]=toXY(cx,cy,r,(i/n)*360);
return(i===0?‚ÄúM‚Äù:‚ÄúL‚Äù)+x.toFixed(2)+‚Äù,‚Äù+y.toFixed(2);
}).join(‚Äù ‚Äú)+‚ÄúZ‚Äù;
}
function fmtH(modelHour,offset){
const s=((modelHour+offset)%24+24)%24;
return `${Math.floor(s)}:${String(Math.round((s%1)*60)).padStart(2,"0")}`;
}
function phaseAt(sh){ return PHASES.find(p=>sh>=p.start&&sh<p.end)||PHASES[0]; }

export default function ResonanceClock(){
const [now,setNow]           = useState(new Date());
const [wakeHour,setWakeHour] = useState(7.0);
const [tab,setTab]           = useState(‚Äúclock‚Äù);
const [selAct,setSelAct]     = useState(null);
const [trackLog,setTrackLog] = useState([]);
const [modal,setModal]       = useState(false);
const [entry,setEntry]       = useState({energy:3,focus:3,mood:3,note:‚Äù‚Äù});

useEffect(()=>{ const t=setInterval(()=>setNow(new Date()),1000); return()=>clearInterval(t); },[]);
useEffect(()=>{(async()=>{ try{ const r=await window.storage.get(‚Äúrc-log‚Äù); if(r?.value)setTrackLog(JSON.parse(r.value)); }catch(*){} })();},[]);
const saveLog=useCallback(async l=>{ try{ await window.storage.set(‚Äúrc-log‚Äù,JSON.stringify(l)); }catch(*){} },[]);

const wo=wakeHour-7.0;
const curHour=now.getHours()+now.getMinutes()/60+now.getSeconds()/3600;
const shiftedH=((curHour-wo)%24+24)%24;
const curPhase=useMemo(()=>phaseAt(shiftedH),[shiftedH]);
const phaseProg=useMemo(()=>(shiftedH-curPhase.start)/(curPhase.end-curPhase.start),[shiftedH,curPhase]);
const alignScore=useCallback(act=>{
const r=act.optimalPhases.indexOf(curPhase.id);
if(r===0)return 95; if(r===1)return 78;
const d=Math.min(‚Ä¶act.optimalPhases.map(id=>Math.abs(id-curPhase.id)));
return d===1?60:d===2?42:20;
},[curPhase]);
const hormoneData=useMemo(()=>Array.from({length:49},(_,i)=>({hour:i/2,cortisol:+cortisol(i/2).toFixed(3),temp:+bodyTemp(i/2).toFixed(3),melatonin:+melatonin(i/2).toFixed(3),composite:+composite(i/2).toFixed(3)})),[]);

const addEntry=useCallback(()=>{
const e={‚Ä¶entry,time:now.toISOString(),hour:+curHour.toFixed(2),phase:curPhase.name,phaseId:curPhase.id};
const nl=[e,‚Ä¶trackLog].slice(0,100);
setTrackLog(nl); saveLog(nl); setModal(false); setEntry({energy:3,focus:3,mood:3,note:‚Äù‚Äù});
},[entry,now,curHour,curPhase,trackLog,saveLog]);

const CX=220,CY=220,SZ=440;
const R_TO=210,R_TI=198,R_HL=224;
const R_AO=194,R_AI=150,R_AM=(194+150)/2;
const R_PR=148,R_WO=142,R_WI=106,R_PT=88,R_CE=70;

const nd=hDeg(shiftedH);
const [nTX,nTY]=toXY(CX,CY,R_AO+9,nd);
const [nBX,nBY]=toXY(CX,CY,18,(nd+180)%360);
const peH=curPhase.start+(curPhase.end-curPhase.start)*phaseProg;
const [pAX,pAY]=toXY(CX,CY,R_PR,hDeg(curPhase.start));
const [pBX,pBY]=toXY(CX,CY,R_PR,hDeg(Math.min(peH,23.9999)));
const pLA=(hDeg(peH)-hDeg(curPhase.start))>180?1:0;
const ts=`${String(now.getHours()).padStart(2,"0")}:${String(now.getMinutes()).padStart(2,"0")}`;
const ss=String(now.getSeconds()).padStart(2,‚Äú0‚Äù);
const cp=curPhase;

return (
<div style={{minHeight:‚Äú100vh‚Äù,fontFamily:‚Äù‚ÄòDM Sans‚Äô,sans-serif‚Äù,background:‚Äù#040810‚Äù,maxWidth:480,margin:‚Äú0 auto‚Äù,color:‚Äúwhite‚Äù,display:‚Äúflex‚Äù,flexDirection:‚Äúcolumn‚Äù}}>
<style>{`@import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500;600&family=DM+Sans:wght@300;400;500;600;700&family=Cinzel:wght@500;700&display=swap'); *{box-sizing:border-box;-webkit-font-smoothing:antialiased;} ::-webkit-scrollbar{width:3px;}::-webkit-scrollbar-thumb{background:#1e293b;border-radius:2px;} .su{animation:su .22s ease-out;}@keyframes su{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}} .fi{animation:fi .2s;}@keyframes fi{from{opacity:0}to{opacity:1}} button{cursor:pointer;}textarea{font-family:'DM Sans',sans-serif;color:white;}`}</style>

```
  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 14px",borderBottom:"1px solid rgba(255,255,255,0.07)"}}>
    <div>
      <div style={{fontFamily:"Cinzel,serif",fontSize:14,fontWeight:700,letterSpacing:"0.22em",color:cp.glow}}>RESONANCE</div>
      <div style={{fontSize:10,color:"rgba(255,255,255,0.3)"}}>9-Phase Circadian Clock ¬∑ H.A. Marouf</div>
    </div>
    <div style={{display:"flex",alignItems:"center",gap:8}}>
      <div style={{fontSize:10,color:"rgba(255,255,255,0.3)"}}>{now.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}</div>
      <button onClick={()=>setModal(true)} style={{fontSize:11,padding:"5px 12px",borderRadius:20,border:`1px solid ${cp.glow}50`,color:cp.glow,background:cp.glow+"14"}}>+ Track</button>
    </div>
  </div>

  <div style={{display:"flex",background:"rgba(0,0,0,0.5)",borderBottom:"1px solid rgba(255,255,255,0.06)"}}>
    {[["clock","üïê","Clock"],["align","üéØ","Align"],["insights","üìä","Insights"],["science","üî¨","Science"]].map(([id,ic,lb])=>(
      <button key={id} onClick={()=>setTab(id)} style={{flex:1,padding:"7px 0",fontSize:11,fontWeight:500,background:"transparent",border:"none",borderBottom:`2px solid ${tab===id?cp.glow:"transparent"}`,color:tab===id?cp.glow:"rgba(255,255,255,0.35)",transition:"color .2s,border-color .2s"}}>
        <div style={{fontSize:13}}>{ic}</div><div>{lb}</div>
      </button>
    ))}
  </div>

  <div style={{flex:1,overflowY:"auto",paddingBottom:28}}>

    {tab==="clock" && <div className="su">
      <svg viewBox={`0 0 ${SZ} ${SZ}`} width="100%" style={{display:"block"}}>
        <defs>
          <filter id="gw4"><feGaussianBlur stdDeviation="4" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <filter id="gw2"><feGaussianBlur stdDeviation="2.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          {PHASES.map(p=>(<radialGradient key={`rg${p.id}`} id={`rg${p.id}`} cx="50%" cy="50%" r="50%"><stop offset="0%" stopColor={p.stroke} stopOpacity="1"/><stop offset="55%" stopColor={p.fill} stopOpacity="1"/><stop offset="100%" stopColor={p.fill} stopOpacity="0.75"/></radialGradient>))}
          <radialGradient id="cGr" cx="50%" cy="50%" r="50%"><stop offset="0%" stopColor={cp.fill} stopOpacity="0.65"/><stop offset="100%" stopColor="#030608" stopOpacity="1"/></radialGradient>
        </defs>
        <circle cx={CX} cy={CY} r={R_AO+24} fill="none" stroke={cp.glow} strokeWidth="48" strokeOpacity="0.03"/>
        {Array.from({length:24},(_,i)=>{
          const a=hDeg(i),mj=i%6===0,mn=i%3===0;
          const [x1,y1]=toXY(CX,CY,R_TI,a),[x2,y2]=toXY(CX,CY,R_TO+(mj?9:mn?5:2),a);
          return <line key={i} x1={x1} y1={y1} x2={x2} y2={y2} stroke={mj?"rgba(255,255,255,0.8)":mn?"rgba(255,255,255,0.38)":"rgba(255,255,255,0.13)"} strokeWidth={mj?1.8:mn?1:0.7}/>;
        })}
        {[0,3,6,9,12,15,18,21].map(h=>{
          const [lx,ly]=toXY(CX,CY,R_HL,hDeg(h));
          return <text key={h} x={lx} y={ly} textAnchor="middle" dominantBaseline="middle" fontSize="8.5" fill="rgba(255,255,255,0.6)" fontFamily="DM Mono,monospace">{h===0?"12a":h===12?"12p":h>12?`${h}p`:`${h}a`}</text>;
        })}
        {PHASES.map(p=>{
          const ac=p.id===cp.id;
          return <g key={`pa${p.id}`}>
            <path d={arcD(CX,CY,R_AI,R_AO,p.start,p.end)} fill={ac?`url(#rg${p.id})`:p.fill} stroke={p.stroke} strokeWidth={ac?2:0.6} opacity={ac?1:0.72} filter={ac?"url(#gw4)":"none"}/>
            {ac && <><path d={arcD(CX,CY,R_AO,R_AO+6,p.start,p.end)} fill={p.stroke} fillOpacity="0.45" filter="url(#gw4)"/><path d={arcD(CX,CY,R_AI,R_AI+5,p.start,p.end)} fill={p.stroke} fillOpacity="0.22" filter="url(#gw2)"/></>}
          </g>;
        })}
        {PHASES.map(p=>{
          const [x1,y1]=toXY(CX,CY,R_AI-3,hDeg(p.start)),[x2,y2]=toXY(CX,CY,R_AO+5,hDeg(p.start));
          return <line key={`dv${p.id}`} x1={x1} y1={y1} x2={x2} y2={y2} stroke="#040810" strokeWidth="2.2"/>;
        })}
        {PHASES.map(p=>{
          const mid=(p.start+p.end)/2,[tx,ty]=toXY(CX,CY,R_AM,hDeg(mid)),ac=p.id===cp.id;
          return <g key={`lbl${p.id}`}>
            {ac && <ellipse cx={tx} cy={ty} rx="13" ry="16" fill={p.stroke} fillOpacity="0.18"/>}
            <text x={tx} y={ty-4} textAnchor="middle" dominantBaseline="middle" fontSize={ac?"15":"12"} opacity={ac?1:0.82}>{p.symbol}</text>
            <text x={tx} y={ty+10} textAnchor="middle" dominantBaseline="middle" fontFamily="DM Mono,monospace" fontWeight="600" fontSize={ac?"9":"8"} fill={ac?"white":p.stroke} fillOpacity={ac?1:0.7}>{p.id}</text>
          </g>;
        })}
        <path d={arcD(CX,CY,R_PR-2,R_PR+2,cp.start,cp.end)} fill="rgba(255,255,255,0.05)"/>
        {phaseProg>0.015 && <path d={`M${pAX},${pAY} A${R_PR},${R_PR} 0 ${pLA},1 ${pBX},${pBY}`} fill="none" stroke="white" strokeWidth="3.5" strokeLinecap="round" strokeOpacity="0.88" filter="url(#gw2)"/>}
        <circle cx={CX} cy={CY} r={R_AI} fill="none" stroke="rgba(255,255,255,0.18)" strokeWidth="1.2"/>
        <circle cx={CX} cy={CY} r={R_WO+3} fill="none" stroke="rgba(255,255,255,0.09)" strokeWidth="0.8"/>
        <circle cx={CX} cy={CY} r={R_WI-3} fill="none" stroke="rgba(255,255,255,0.09)" strokeWidth="0.8"/>
        <path d={arcD(CX,CY,R_WI,R_WO,0,24)} fill="#030609" fillOpacity="0.97"/>
        <path d={wavePath(CX,CY,R_WI+2,R_WO-2,cortisol)} fill="none" stroke="#fbbf24" strokeWidth="1.4" strokeOpacity="0.7"/>
        <path d={wavePath(CX,CY,R_WI+2,R_WO-2,bodyTemp)} fill="none" stroke="#f97316" strokeWidth="1.4" strokeOpacity="0.7"/>
        <path d={wavePath(CX,CY,R_WI+2,R_WO-2,melatonin)} fill="none" stroke="#818cf8" strokeWidth="1.4" strokeOpacity="0.7"/>
        <path d={wavePath(CX,CY,R_WI+2,R_WO-2,composite)} fill="none" stroke={cp.glow} strokeWidth="2.2" strokeOpacity="0.92"/>
        <circle cx={CX} cy={CY} r={(R_WI+R_WO)/2} fill="none" stroke="rgba(255,255,255,0.07)" strokeWidth="0.6" strokeDasharray="3,4"/>
        {[{l:"C",c:"#fbbf24",a:5},{l:"T",c:"#f97316",a:40},{l:"M",c:"#818cf8",a:75},{l:"F",c:cp.glow,a:110}].map(({l,c,a})=>{
          const [lx,ly]=toXY(CX,CY,R_WI-8,a);
          return <g key={l}><circle cx={lx} cy={ly} r="5.5" fill={c} fillOpacity="0.92"/><text x={lx} y={ly} textAnchor="middle" dominantBaseline="middle" fontSize="5" fontWeight="700" fill="#020507" fontFamily="DM Mono,monospace">{l}</text></g>;
        })}
        <circle cx={CX} cy={CY} r={R_WI-4} fill="#040810"/>
        {Array.from({length:9},(_,i)=>{
          const angle=(i/9)*360,ph=PHASES[i],ac=ph.id===cp.id,[px,py]=toXY(CX,CY,R_PT,angle);
          return <ellipse key={`pt${i}`} cx={px} cy={py} rx="9" ry="17" transform={`rotate(${angle},${px},${py})`} fill={ph.glow} fillOpacity={ac?0.42:0.09} stroke={ph.glow} strokeWidth="0.7" strokeOpacity={ac?0.88:0.28} filter={ac?"url(#gw2)":"none"}/>;
        })}
        <circle cx={CX} cy={CY} r={R_CE+9} fill="#040810"/>
        <circle cx={CX} cy={CY} r={R_CE} fill="url(#cGr)"/>
        <circle cx={CX} cy={CY} r={R_CE} fill="none" stroke={cp.stroke} strokeWidth="1.8" strokeOpacity="0.72"/>
        <text x={CX} y={CY-26} textAnchor="middle" fontSize="19">{cp.symbol}</text>
        <text x={CX} y={CY-10} textAnchor="middle" fontSize="7.5" fontFamily="Cinzel,serif" fontWeight="600" fill={cp.stroke} letterSpacing="2.5">{cp.name.toUpperCase()}</text>
        <text x={CX} y={CY+8} textAnchor="middle" fontSize="21" fontFamily="DM Mono,monospace" fontWeight="600" fill="white">{ts}<tspan fontSize="10" fill="rgba(255,255,255,0.36)">.{ss}</tspan></text>
        <text x={CX} y={CY+24} textAnchor="middle" fontSize="7.5" fill="rgba(255,255,255,0.3)">Phase {cp.id} of 9</text>
        <rect x={CX-26} y={CY+30} width="52" height="2.5" rx="1.5" fill="rgba(255,255,255,0.07)"/>
        <rect x={CX-26} y={CY+30} width={52*Math.min(phaseProg,1)} height="2.5" rx="1.5" fill={cp.stroke} opacity="0.85"/>
        <line x1={nBX} y1={nBY} x2={nTX} y2={nTY} stroke="white" strokeWidth="2" strokeLinecap="round" style={{filter:"drop-shadow(0 0 6px rgba(255,255,255,0.85))"}}/>
        <circle cx={nTX} cy={nTY} r="3.5" fill="white" style={{filter:"drop-shadow(0 0 5px white)"}}/>
        <circle cx={CX} cy={CY} r="7.5" fill={cp.stroke} filter="url(#gw2)"/>
        <circle cx={CX} cy={CY} r="4" fill="white"/>
      </svg>

      <div style={{margin:"4px 12px 10px",padding:"11px 13px",borderRadius:12,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.07)"}}>
        <p style={{fontSize:9,color:"rgba(255,255,255,0.3)",letterSpacing:"0.12em",marginBottom:9,fontFamily:"DM Mono,monospace"}}>CLOCK ANATOMY</p>
        {[[{sw:cp.stroke,lb:"OUTER RING",ds:"9 colored circadian phase arcs"},{sw:"white",lb:"PROGRESS ARC",ds:"How far through current phase"}],[{sw:cp.glow,lb:"F(t) WAVE",ds:"Composite hormone curve (inner ring)"},{sw:"#fbbf24",lb:"C ¬∑ Cortisol",ds:"Peaks ~07:30 ‚Äî Brabant 1990"}],[{sw:"#f97316",lb:"T ¬∑ Body Temp",ds:"Peaks ~17:00 ‚Äî Refinetti 2010"},{sw:"#818cf8",lb:"M ¬∑ Melatonin",ds:"Peaks ~03:00 ‚Äî Lewy 1999"}]].map((row,i)=>(
          <div key={i} style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px 14px",marginBottom:6}}>
            {row.map(({sw,lb,ds})=>(<div key={lb} style={{display:"flex",alignItems:"flex-start",gap:7}}><div style={{width:9,height:9,borderRadius:2,background:sw,flexShrink:0,marginTop:1,border:"1px solid rgba(255,255,255,0.12)"}}/><div><div style={{fontSize:9,fontFamily:"DM Mono,monospace",color:"rgba(255,255,255,0.75)"}}>{lb}</div><div style={{fontSize:9,color:"rgba(255,255,255,0.3)"}}>{ds}</div></div></div>))}
          </div>
        ))}
      </div>

      <div style={{margin:"0 12px 10px"}}>
        <p style={{fontSize:9,color:"rgba(255,255,255,0.3)",letterSpacing:"0.12em",marginBottom:7,fontFamily:"DM Mono,monospace"}}>PHASE REFERENCE MAP</p>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6}}>
          {PHASES.map(p=>{
            const ac=p.id===cp.id;
            return <div key={p.id} style={{padding:"7px 8px",borderRadius:9,background:ac?p.fill+"b0":"rgba(255,255,255,0.04)",border:`1px solid ${ac?p.stroke+"75":"rgba(255,255,255,0.08)"}`,display:"flex",alignItems:"center",gap:6}}>
              <div style={{width:8,height:8,borderRadius:2,background:p.stroke,flexShrink:0}}/>
              <div style={{flex:1,minWidth:0}}>
                <div style={{fontSize:9.5,fontFamily:"DM Mono,monospace",fontWeight:500,color:ac?p.stroke:"rgba(255,255,255,0.65)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{p.name}</div>
                <div style={{fontSize:8,color:"rgba(255,255,255,0.28)",marginTop:1}}>{fmtH(p.start,wo)}</div>
              </div>
              <div style={{fontSize:12}}>{p.symbol}</div>
            </div>;
          })}
        </div>
      </div>

      <div style={{margin:"0 12px 10px",borderRadius:14,overflow:"hidden",border:`1px solid ${cp.stroke}32`,background:`linear-gradient(135deg,${cp.fill}75,#040810 65%)`}}>
        <div style={{padding:14}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10}}>
            <div style={{display:"flex",alignItems:"center",gap:10}}>
              <span style={{fontSize:28}}>{cp.symbol}</span>
              <div><h2 style={{fontFamily:"Cinzel,serif",fontSize:15,fontWeight:700,color:cp.stroke,margin:0}}>{cp.name}</h2><p style={{fontSize:11,color:"rgba(255,255,255,0.5)",margin:"2px 0 0"}}>{cp.desc}</p></div>
            </div>
            <div style={{textAlign:"right",fontFamily:"DM Mono,monospace",fontSize:11,color:"rgba(255,255,255,0.35)",flexShrink:0,marginLeft:8}}>
              <div>{fmtH(cp.start,wo)}</div><div>‚Üí {fmtH(cp.end>=24?0:cp.end,wo)}</div>
            </div>
          </div>
          <div style={{height:4,borderRadius:2,background:"rgba(255,255,255,0.08)",overflow:"hidden",marginBottom:4}}><div style={{height:"100%",borderRadius:2,width:`${phaseProg*100}%`,background:`linear-gradient(90deg,${cp.fill},${cp.stroke})`,transition:"width 1s"}}/></div>
          <div style={{display:"flex",justifyContent:"space-between",fontSize:10,color:"rgba(255,255,255,0.28)",marginBottom:10}}>
            <span>{(phaseProg*100).toFixed(0)}% complete</span><span>{((1-phaseProg)*(cp.end-cp.start)*60).toFixed(0)} min remaining</span>
          </div>
          <p style={{fontSize:11,lineHeight:1.6,color:"rgba(255,255,255,0.6)",marginBottom:10}}>{cp.science}</p>
          <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
            {cp.best.map(a=><span key={a} style={{fontSize:10,padding:"3px 9px",borderRadius:20,background:cp.stroke+"22",color:cp.stroke,border:`1px solid ${cp.stroke}35`}}>‚úì {a}</span>)}
            {cp.avoid.map(a=><span key={a} style={{fontSize:10,padding:"3px 9px",borderRadius:20,background:"rgba(239,68,68,0.1)",color:"#f87171",border:"1px solid rgba(239,68,68,0.18)"}}>‚úó {a}</span>)}
          </div>
        </div>
      </div>

      <div style={{margin:"0 12px 10px",padding:"11px 14px",borderRadius:12,background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.08)"}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
          <div><div style={{fontSize:12,fontWeight:600,color:"white"}}>Wake time</div><div style={{fontSize:10,color:"rgba(255,255,255,0.3)"}}>Shifts all 9 phase boundaries</div></div>
          <div style={{display:"flex",alignItems:"center",gap:10}}>
            <button onClick={()=>setWakeHour(h=>Math.max(4,+(h-.5).toFixed(1)))} style={{width:30,height:30,borderRadius:15,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.06)",color:"white",fontSize:18,display:"flex",alignItems:"center",justifyContent:"center"}}>‚àí</button>
            <span style={{fontSize:15,fontWeight:700,fontFamily:"DM Mono,monospace",color:"white",width:44,textAlign:"center"}}>{Math.floor(wakeHour)}:{(wakeHour%1*60).toFixed(0).padStart(2,"0")}</span>
            <button onClick={()=>setWakeHour(h=>Math.min(11,+(h+.5).toFixed(1)))} style={{width:30,height:30,borderRadius:15,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.06)",color:"white",fontSize:18,display:"flex",alignItems:"center",justifyContent:"center"}}>+</button>
          </div>
        </div>
      </div>

      <div style={{margin:"0 12px"}}>
        <p style={{fontSize:9,color:"rgba(255,255,255,0.3)",letterSpacing:"0.12em",marginBottom:7,fontFamily:"DM Mono,monospace"}}>UPCOMING PHASES</p>
        <div style={{display:"flex",gap:7,overflowX:"auto",paddingBottom:4}}>
          {PHASES.map(p=>{
            const past=p.id<cp.id,cur=p.id===cp.id;
            return <div key={p.id} style={{flexShrink:0,padding:"7px 9px",borderRadius:10,textAlign:"center",minWidth:56,background:cur?p.fill+"65":"rgba(255,255,255,0.04)",border:`1px solid ${cur?p.stroke+"65":"rgba(255,255,255,0.07)"}`,opacity:past?0.35:1}}>
              <div style={{fontSize:15}}>{p.symbol}</div>
              <div style={{fontSize:8.5,fontFamily:"DM Mono,monospace",color:cur?p.stroke:"rgba(255,255,255,0.45)",marginTop:3}}>{fmtH(p.start,wo)}</div>
              <div style={{fontSize:7.5,color:cur?p.stroke:"rgba(255,255,255,0.28)",marginTop:1}}>{p.id}</div>
            </div>;
          })}
        </div>
      </div>
    </div>}

    {tab==="align" && <div className="su" style={{padding:12,display:"flex",flexDirection:"column",gap:12}}>
      <div style={{borderRadius:12,padding:12,display:"flex",alignItems:"center",gap:12,border:`1px solid ${cp.stroke}35`,background:`linear-gradient(135deg,${cp.fill}55,rgba(0,0,0,0.5))`}}>
        <span style={{fontSize:32}}>{cp.symbol}</span>
        <div><p style={{fontFamily:"Cinzel,serif",fontSize:13,fontWeight:700,color:cp.stroke,margin:0}}>{cp.name}</p><p style={{fontSize:11,color:"rgba(255,255,255,0.5)",margin:"2px 0 0"}}>{cp.desc}</p></div>
      </div>
      <p style={{fontSize:9,color:"rgba(255,255,255,0.35)",letterSpacing:"0.12em",margin:0,fontFamily:"DM Mono,monospace"}}>SELECT ACTIVITY ‚Äî SEE BIOLOGICAL ALIGNMENT</p>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
        {ACTIVITIES.map(act=>{
          const score=alignScore(act),sel=selAct?.name===act.name,col=score>=80?"#10b981":score>=60?"#f59e0b":"#ef4444";
          return <button key={act.name} onClick={()=>setSelAct(act)} style={{padding:12,borderRadius:12,textAlign:"left",border:`1px solid ${sel?cp.stroke+"60":"rgba(255,255,255,0.08)"}`,background:sel?cp.glow+"18":"rgba(0,0,0,0.4)"}}>
            <div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontSize:22}}>{act.icon}</span><span style={{fontSize:12,fontWeight:700,fontFamily:"DM Mono,monospace",color:col}}>{score}%</span></div>
            <p style={{fontSize:12,fontWeight:600,color:"white",margin:"6px 0 5px"}}>{act.name}</p>
            <div style={{height:2.5,borderRadius:1.5,background:"rgba(255,255,255,0.07)"}}><div style={{width:`${score}%`,height:"100%",borderRadius:1.5,background:col}}/></div>
          </button>;
        })}
      </div>
      {selAct&&(()=>{
        const score=alignScore(selAct),col=score>=80?"#10b981":score>=60?"#f59e0b":"#ef4444";
        const best=PHASES.find(p=>p.id===selAct.optimalPhases[0]);
        return <div style={{borderRadius:12,padding:14,border:`1px solid ${col}28`,background:col+"10"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
            <div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:22}}>{selAct.icon}</span><span style={{fontSize:14,fontWeight:600,color:"white"}}>{selAct.name}</span></div>
            <div style={{position:"relative",width:52,height:52}}>
              <svg viewBox="0 0 44 44" width="52" height="52"><circle cx="22" cy="22" r="17" fill="none" stroke="rgba(255,255,255,0.07)" strokeWidth="4.5"/><circle cx="22" cy="22" r="17" fill="none" stroke={col} strokeWidth="4.5" strokeDasharray={`${score*1.069} 106.9`} strokeLinecap="round" transform="rotate(-90 22 22)"/></svg>
              <div style={{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,color:col,fontFamily:"DM Mono,monospace"}}>{score}%</div>
            </div>
          </div>
          <p style={{fontSize:11,fontWeight:600,color:col,margin:"0 0 5px"}}>{score>=80?"Excellent ‚Äî peak biological window":score>=60?"Good ‚Äî workable alignment":"Low ‚Äî suboptimal timing"}</p>
          <p style={{fontSize:11,lineHeight:1.55,color:"rgba(255,255,255,0.55)",margin:"0 0 10px"}}>{score>=80?`${cp.name} is the sweet spot for ${selAct.name}.`:score>=60?`Works now, but ${best?.name} (${fmtH(best?.start??0,wo)}) is biologically superior.`:`Best during ${best?.name} at ${fmtH(best?.start??0,wo)}.`}</p>
          {score<80&&best&&<div style={{display:"flex",alignItems:"center",gap:8,padding:"8px 10px",borderRadius:8,background:best.glow+"16",border:`1px solid ${best.glow}28`}}><span style={{fontSize:18}}>{best.symbol}</span><div><p style={{fontSize:11,fontWeight:600,color:best.stroke,margin:0}}>Optimal: {best.name}</p><p style={{fontSize:10,color:"rgba(255,255,255,0.38)",margin:"1px 0 0",fontFamily:"DM Mono,monospace"}}>{fmtH(best.start,wo)} ‚Äì {fmtH(best.end>=24?0:best.end,wo)}</p></div></div>}
        </div>;
      })()}
    </div>}

    {tab==="insights" && <div className="su" style={{padding:12,display:"flex",flexDirection:"column",gap:14}}>
      <div>
        <p style={{fontSize:9,color:"rgba(255,255,255,0.35)",letterSpacing:"0.12em",marginBottom:7,fontFamily:"DM Mono,monospace"}}>LIVE HORMONE LEVELS</p>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8}}>
          {[{name:"Cortisol",val:cortisol(curHour),color:"#fbbf24",peak:"07:30",icon:"‚ö°",ref:"Brabant 1990"},{name:"Core Temp",val:bodyTemp(curHour),color:"#f97316",peak:"17:00",icon:"üå°",ref:"Refinetti 2010"},{name:"Melatonin",val:melatonin(curHour),color:"#818cf8",peak:"03:00",icon:"üåô",ref:"Lewy 1999"}].map(h=>(
            <div key={h.name} style={{borderRadius:12,padding:"11px 8px",textAlign:"center",border:"1px solid rgba(255,255,255,0.07)",background:"rgba(0,0,0,0.45)"}}>
              <div style={{fontSize:18}}>{h.icon}</div>
              <p style={{fontSize:9,color:"rgba(255,255,255,0.4)",margin:"5px 0 2px",fontFamily:"DM Mono,monospace"}}>{h.name}</p>
              <p style={{fontSize:22,fontWeight:700,color:h.color,fontFamily:"DM Mono,monospace",margin:0}}>{(h.val*100).toFixed(0)}<span style={{fontSize:10,fontWeight:400}}>%</span></p>
              <div style={{height:3,borderRadius:2,background:"rgba(255,255,255,0.07)",overflow:"hidden",margin:"7px 0 5px"}}><div style={{width:`${h.val*100}%`,height:"100%",background:h.color,borderRadius:2}}/></div>
              <div style={{fontSize:8,color:"rgba(255,255,255,0.22)",fontFamily:"DM Mono,monospace"}}><div>Peak {h.peak}</div><div>{h.ref}</div></div>
            </div>
          ))}
        </div>
      </div>
      <div>
        <p style={{fontSize:9,color:"rgba(255,255,255,0.35)",letterSpacing:"0.12em",marginBottom:7,fontFamily:"DM Mono,monospace"}}>24H MODEL ¬∑ F(t)=0.5C+0.3T+0.2M</p>
        <div style={{borderRadius:12,padding:12,border:"1px solid rgba(255,255,255,0.07)",background:"rgba(0,0,0,0.45)"}}>
          <ResponsiveContainer width="100%" height={155}>
            <AreaChart data={hormoneData} margin={{top:5,right:8,bottom:5,left:-28}}>
              <defs>{[["cg","#fbbf24"],["tg","#f97316"],["mg","#818cf8"],["fg",cp.glow]].map(([id,c])=>(<linearGradient key={id} id={id} x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor={c} stopOpacity="0.25"/><stop offset="95%" stopColor={c} stopOpacity="0"/></linearGradient>))}</defs>
              <XAxis dataKey="hour" tick={{fill:"#374151",fontSize:8}} axisLine={false} tickLine={false} tickFormatter={h=>h%6===0?(h===0?"12a":h===12?"12p":h<12?`${h}a`:`${h}p`):""}/>
              <YAxis domain={[0,1]} tick={false} axisLine={false}/>
              <Tooltip contentStyle={{background:"#07101f",border:"1px solid #1e293b",borderRadius:8,fontSize:11}} formatter={(v,n)=>[`${(v*100).toFixed(0)}%`,n]} labelFormatter={h=>`${Math.floor(h)}:${h%1===.5?"30":"00"}`}/>
              <ReferenceLine x={curHour} stroke="rgba(255,255,255,0.4)" strokeDasharray="3 2" strokeWidth={1.2}/>
              <Area type="monotone" dataKey="cortisol" name="Cortisol" stroke="#fbbf24" fill="url(#cg)" strokeWidth={1.5} dot={false}/>
              <Area type="monotone" dataKey="temp" name="Body Temp" stroke="#f97316" fill="url(#tg)" strokeWidth={1.5} dot={false}/>
              <Area type="monotone" dataKey="melatonin" name="Melatonin" stroke="#818cf8" fill="url(#mg)" strokeWidth={1.5} dot={false}/>
              <Area type="monotone" dataKey="composite" name="F(t)" stroke={cp.glow} fill="none" strokeWidth={2.2} dot={false} strokeDasharray="5 2"/>
            </AreaChart>
          </ResponsiveContainer>
          <div style={{display:"flex",flexWrap:"wrap",gap:"5px 12px",justifyContent:"center",marginTop:4}}>
            {[["Cortisol","#fbbf24"],["Body Temp","#f97316"],["Melatonin","#818cf8"],["F(t)",cp.glow]].map(([n,c])=>(<div key={n} style={{display:"flex",alignItems:"center",gap:5}}><div style={{width:8,height:8,borderRadius:2,background:c}}/><span style={{fontSize:9,color:"rgba(255,255,255,0.4)"}}>{n}</span></div>))}
          </div>
        </div>
      </div>
      <div>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:7}}>
          <p style={{fontSize:9,color:"rgba(255,255,255,0.35)",letterSpacing:"0.12em",margin:0,fontFamily:"DM Mono,monospace"}}>YOUR ENERGY LOG</p>
          <button onClick={()=>setModal(true)} style={{fontSize:10,padding:"4px 12px",borderRadius:20,border:`1px solid ${cp.stroke}45`,color:cp.stroke,background:"transparent"}}>+ Entry</button>
        </div>
        {trackLog.length===0?(
          <div style={{borderRadius:12,padding:22,textAlign:"center",border:"1px solid rgba(255,255,255,0.07)",background:"rgba(0,0,0,0.3)"}}>
            <div style={{fontSize:32,marginBottom:8}}>üìä</div>
            <p style={{fontSize:13,color:"white",margin:"0 0 5px"}}>No entries yet</p>
            <p style={{fontSize:11,color:"rgba(255,255,255,0.35)",margin:"0 0 12px",lineHeight:1.5}}>Log energy, focus & mood to compare against the biological model.</p>
            <button onClick={()=>setModal(true)} style={{fontSize:11,padding:"7px 18px",borderRadius:20,fontWeight:600,background:cp.glow+"28",color:cp.glow,border:`1px solid ${cp.glow}45`}}>Start Tracking</button>
          </div>
        ):(
          <>
            {trackLog.length>=3&&<div style={{borderRadius:12,padding:12,marginBottom:10,border:"1px solid rgba(255,255,255,0.07)",background:"rgba(0,0,0,0.45)"}}>
              <ResponsiveContainer width="100%" height={90}>
                <LineChart data={[...trackLog].reverse().slice(-20)} margin={{top:5,right:5,bottom:5,left:-32}}>
                  <XAxis dataKey="phase" tick={{fill:"#374151",fontSize:7}} tickFormatter={(v,i)=>i%3===0?v.substring(0,4):""} axisLine={false} tickLine={false}/>
                  <YAxis domain={[1,5]} ticks={[1,3,5]} tick={{fill:"#374151",fontSize:7}} axisLine={false} tickLine={false}/>
                  <Tooltip contentStyle={{background:"#07101f",border:"1px solid #1e293b",borderRadius:8,fontSize:10}}/>
                  <Line type="monotone" dataKey="energy" name="Energy" stroke="#f59e0b" strokeWidth={2} dot={false}/>
                  <Line type="monotone" dataKey="focus" name="Focus" stroke="#2dd4bf" strokeWidth={2} dot={false}/>
                  <Line type="monotone" dataKey="mood" name="Mood" stroke="#a78bfa" strokeWidth={2} dot={false}/>
                </LineChart>
              </ResponsiveContainer>
            </div>}
            <div style={{display:"flex",flexDirection:"column",gap:6,maxHeight:260,overflowY:"auto"}}>
              {trackLog.map((e,i)=>{
                const ep=PHASES.find(p=>p.name===e.phase)||PHASES[0];
                return <div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"9px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.3)"}}>
                  <span style={{fontSize:18}}>{ep.symbol}</span>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontSize:11,fontWeight:600,color:"white"}}>{e.phase}</span><span style={{fontSize:10,color:"rgba(255,255,255,0.3)",fontFamily:"DM Mono,monospace"}}>{new Date(e.time).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}</span></div>
                    <div style={{display:"flex",gap:10,marginTop:3}}>{[["‚ö°",e.energy,"#f59e0b"],["üéØ",e.focus,"#2dd4bf"],["üòä",e.mood,"#a78bfa"]].map(([ic,v,c])=>(<span key={ic} style={{fontSize:10,color:c}}>{ic} {"‚óè".repeat(v)}{"‚óã".repeat(5-v)}</span>))}</div>
                  </div>
                </div>;
              })}
            </div>
          </>
        )}
      </div>
    </div>}

    {tab==="science" && <div className="su" style={{padding:12,display:"flex",flexDirection:"column",gap:12}}>
      <div style={{borderRadius:14,padding:14,border:"1px solid rgba(129,140,248,0.28)",background:"rgba(26,22,80,0.5)"}}>
        <p style={{fontSize:9,fontWeight:600,letterSpacing:"0.15em",color:"#818cf8",marginBottom:8,fontFamily:"DM Mono,monospace"}}>THE DISCOVERY</p>
        <h2 style={{fontFamily:"Cinzel,serif",fontSize:15,fontWeight:700,color:"white",marginBottom:10}}>Artwork Validates Biology</h2>
        <p style={{fontSize:12,lineHeight:1.65,color:"rgba(255,255,255,0.65)",marginBottom:8}}>H.A. Marouf derived this 9-phase model <em>entirely from hormonal mathematics</em>, blind to any artwork. The composite F(t) was computed solely from published biochemical parameters.</p>
        <p style={{fontSize:12,lineHeight:1.65,color:"rgba(255,255,255,0.65)",marginBottom:14}}>When phase boundaries were overlaid on independent automatic mandala drawings ‚Äî a wholly separate meditative process ‚Äî the alignment was statistically extraordinary.</p>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8}}>
          {[{stat:"R¬≤=0.993",label:"Model fit",color:"#10b981"},{stat:"10.1¬∞",label:"Mean Ang. Error",color:"#60a5fa"},{stat:"p<0.001",label:"Significance",color:"#a78bfa"}].map(s=>(<div key={s.label} style={{textAlign:"center",padding:"10px 6px",borderRadius:10,background:"rgba(0,0,0,0.45)",border:`1px solid ${s.color}25`}}><p style={{fontSize:13,fontWeight:700,color:s.color,fontFamily:"DM Mono,monospace",margin:"0 0 3px"}}>{s.stat}</p><p style={{fontSize:9,color:"rgba(255,255,255,0.3)",margin:0}}>{s.label}</p></div>))}
        </div>
      </div>
      <div style={{borderRadius:14,padding:14,border:"1px solid rgba(255,255,255,0.08)",background:"rgba(0,0,0,0.5)"}}>
        <p style={{fontSize:9,letterSpacing:"0.15em",color:"rgba(255,255,255,0.35)",marginBottom:10,fontFamily:"DM Mono,monospace"}}>HORMONE OSCILLATIONS ¬∑ 24H PHASE BANDS</p>
        <svg viewBox="0 0 420 185" width="100%" style={{display:"block"}}>
          {PHASES.map(p=><rect key={p.id} x={(p.start/24)*420} y="0" width={((p.end-p.start)/24)*420} height="162" fill={p.fill} fillOpacity="0.3"/>)}
          {PHASES.map(p=><g key={`sl${p.id}`}><line x1={(p.start/24)*420} y1="0" x2={(p.start/24)*420} y2="162" stroke="rgba(255,255,255,0.07)" strokeWidth="0.8"/><text x={((p.start+p.end)/2/24)*420} y="12" textAnchor="middle" fontSize="10" fill="rgba(255,255,255,0.55)">{p.symbol}</text></g>)}
          {[0.25,0.5,0.75].map(v=><line key={v} x1="0" y1={162-v*148} x2="420" y2={162-v*148} stroke="rgba(255,255,255,0.05)" strokeWidth="0.7" strokeDasharray="4,3"/>)}
          {[0,6,12,18,24].map(h=><g key={h}><line x1={(h/24)*420} y1="0" x2={(h/24)*420} y2="162" stroke="rgba(255,255,255,0.04)" strokeWidth="0.5"/><text x={(h/24)*420+2} y="178" fontSize="8" fill="rgba(255,255,255,0.35)" fontFamily="DM Mono,monospace">{h===0?"12a":h===12?"12p":h<12?`${h}a`:`${h}p`}</text></g>)}
          {[{fn:cortisol,c:"#fbbf24"},{fn:bodyTemp,c:"#f97316"},{fn:melatonin,c:"#818cf8"}].map(({fn,c})=>{const d=Array.from({length:200},(_,i)=>{const t=i/199*24;return`${i===0?"M":"L"}${(t/24*420).toFixed(1)},${(162-fn(t)*148).toFixed(1)}`;}).join(" ");return <path key={c} d={d} fill="none" stroke={c} strokeWidth="1.5" strokeOpacity="0.85"/>;})}
          {(()=>{const d=Array.from({length:200},(_,i)=>{const t=i/199*24;return`${i===0?"M":"L"}${(t/24*420).toFixed(1)},${(162-composite(t)*148).toFixed(1)}`;}).join(" ");return <path d={d} fill="none" stroke={cp.glow} strokeWidth="2.5" strokeDasharray="7,3" strokeOpacity="0.95"/>;})()}
          <line x1={(curHour/24)*420} y1="0" x2={(curHour/24)*420} y2="162" stroke="white" strokeWidth="1.2" strokeDasharray="3,2" strokeOpacity="0.5"/>
          <text x={Math.min(curHour/24*420+4,400)} y="14" fontSize="7" fill="white" fillOpacity="0.45" fontFamily="DM Mono,monospace">NOW</text>
        </svg>
        <div style={{display:"flex",flexWrap:"wrap",gap:"5px 14px",justifyContent:"center",marginTop:8}}>{[["Cortisol","#fbbf24"],["Body Temp","#f97316"],["Melatonin","#818cf8"],["F(t)",cp.glow]].map(([n,c])=>(<div key={n} style={{display:"flex",alignItems:"center",gap:5}}><div style={{width:8,height:8,borderRadius:2,background:c}}/><span style={{fontSize:9,color:"rgba(255,255,255,0.4)"}}>{n}</span></div>))}</div>
      </div>
      <div style={{borderRadius:14,padding:14,border:"1px solid rgba(45,212,191,0.18)",background:"rgba(0,0,0,0.6)"}}>
        <p style={{fontSize:9,letterSpacing:"0.15em",color:"#2dd4bf",marginBottom:10,fontFamily:"DM Mono,monospace"}}>THE MATHEMATICS</p>
        <div style={{borderRadius:10,padding:12,background:"rgba(0,0,0,0.75)",fontFamily:"DM Mono,monospace",fontSize:11,lineHeight:1.9}}>
          <div style={{color:"#2dd4bf",marginBottom:4}}>F(t) = 0.5¬∑C(t) + 0.3¬∑T(t) + 0.2¬∑M(t)</div>
          <div style={{color:"rgba(255,255,255,0.2)",fontSize:9,marginBottom:10}}>// Composite circadian function</div>
          <div><span style={{color:"#fbbf24"}}>C(t)</span><span style={{color:"rgba(255,255,255,0.5)"}}> = Œ£ a‚Çô¬∑cos(2œÄn(t‚àí7.5)/24)</span><span style={{color:"rgba(255,255,255,0.2)",fontSize:9}}> n=1..4</span></div>
          <div><span style={{color:"#f97316"}}>T(t)</span><span style={{color:"rgba(255,255,255,0.5)"}}> = Œ£ b‚Çô¬∑cos(2œÄn(t‚àí17.0)/24)</span><span style={{color:"rgba(255,255,255,0.2)",fontSize:9}}> n=1..3</span></div>
          <div><span style={{color:"#818cf8"}}>M(t)</span><span style={{color:"rgba(255,255,255,0.5)"}}> = Œ£ c‚Çô¬∑cos(2œÄn(t‚àí3.0)/24)</span><span style={{color:"rgba(255,255,255,0.2)",fontSize:9}}> n=1..3</span></div>
          <div style={{marginTop:10,paddingTop:8,borderTop:"1px solid rgba(255,255,255,0.07)",color:"rgba(255,255,255,0.3)",fontSize:9}}>9 inflection points ‚Üí 9 phase boundaries ‚Üí 9-fold mandala symmetry (p &lt; 0.001)</div>
        </div>
      </div>
      <div style={{borderRadius:14,padding:14,border:"1px solid rgba(16,185,129,0.18)",background:"rgba(5,60,40,0.25)"}}>
        <p style={{fontSize:9,letterSpacing:"0.15em",color:"#10b981",marginBottom:12,fontFamily:"DM Mono,monospace"}}>BLIND VALIDATION PROTOCOL</p>
        {[{n:"1",title:"Blind derivation",desc:"Phase boundaries computed solely from F(t) inflection points ‚Äî zero artwork reference.",c:"#10b981"},{n:"2",title:"Independent artwork",desc:"Automatic mandala drawings created through meditative practice as a wholly separate process.",c:"#60a5fa"},{n:"3",title:"Angular comparison",desc:"Artwork sectors vs. model transitions. MAE = 10.1¬∞, R¬≤ = 0.993, p < 0.001.",c:"#a78bfa"}].map(({n,title,desc,c})=>(<div key={n} style={{display:"flex",gap:12,marginBottom:12}}><div style={{width:24,height:24,borderRadius:12,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,background:c+"1f",color:c,border:`1px solid ${c}40`}}>{n}</div><div><p style={{fontSize:12,fontWeight:600,color:"white",margin:"0 0 2px"}}>{title}</p><p style={{fontSize:11,color:"rgba(255,255,255,0.5)",margin:0,lineHeight:1.5}}>{desc}</p></div></div>))}
        <p style={{fontSize:9,color:"rgba(255,255,255,0.22)",borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:10,margin:0,fontFamily:"DM Mono,monospace"}}>Brabant (1990) ¬∑ Van Cauter (1999) ¬∑ Refinetti (2010) ¬∑ Lewy (1999)</p>
      </div>
    </div>}
  </div>

  {modal&&<div className="fi" onClick={e=>{if(e.target===e.currentTarget)setModal(false);}} style={{position:"fixed",inset:0,zIndex:50,display:"flex",alignItems:"flex-end",justifyContent:"center",background:"rgba(0,0,0,0.82)",backdropFilter:"blur(12px)"}}>
    <div className="su" style={{width:"100%",maxWidth:480,borderRadius:"20px 20px 0 0",padding:20,background:"linear-gradient(180deg,#0c1828,#050a12)",border:"1px solid rgba(255,255,255,0.1)",borderBottom:"none"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
        <div><h3 style={{fontFamily:"Cinzel,serif",fontSize:15,fontWeight:700,color:"white",margin:0}}>Track Your State</h3><p style={{fontSize:11,color:"rgba(255,255,255,0.4)",margin:"3px 0 0"}}>{cp.symbol} {cp.name} ¬∑ {ts}</p></div>
        <button onClick={()=>setModal(false)} style={{width:30,height:30,borderRadius:15,border:"1px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.07)",color:"rgba(255,255,255,0.6)",fontSize:14,display:"flex",alignItems:"center",justifyContent:"center"}}>‚úï</button>
      </div>
      {[{k:"energy",l:"Energy Level",i:"‚ö°",c:"#f59e0b"},{k:"focus",l:"Mental Focus",i:"üéØ",c:"#2dd4bf"},{k:"mood",l:"Mood",i:"üòä",c:"#a78bfa"}].map(({k,l,i,c})=>(
        <div key={k} style={{marginBottom:14}}>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:7}}><span style={{fontSize:12,color:"rgba(255,255,255,0.7)"}}>{i} {l}</span><span style={{fontSize:12,fontWeight:700,color:c,fontFamily:"DM Mono,monospace"}}>{entry[k]}/5</span></div>
          <div style={{display:"flex",gap:6}}>{[1,2,3,4,5].map(v=>(<button key={v} onClick={()=>setEntry(e=>({...e,[k]:v}))} style={{flex:1,padding:"9px 0",borderRadius:8,fontSize:13,fontWeight:700,background:entry[k]>=v?c+"28":"rgba(255,255,255,0.05)",color:entry[k]>=v?c:"rgba(255,255,255,0.2)",border:entry[k]===v?`1.5px solid ${c}`:"1.5px solid transparent"}}>{v}</button>))}</div>
        </div>
      ))}
      <textarea placeholder="Optional note‚Ä¶" value={entry.note} onChange={e=>setEntry(l=>({...l,note:e.target.value}))} rows={2} style={{width:"100%",borderRadius:10,padding:"10px 12px",fontSize:12,background:"rgba(0,0,0,0.55)",border:"1px solid rgba(255,255,255,0.1)",resize:"none",outline:"none",display:"block"}}/>
      <button onClick={addEntry} style={{width:"100%",marginTop:12,padding:"13px 0",borderRadius:12,fontSize:13,fontWeight:700,background:cp.stroke,color:"#020507",border:"none",letterSpacing:"0.06em"}}>SAVE ENTRY</button>
    </div>
  </div>}
</div>
```

);
}
