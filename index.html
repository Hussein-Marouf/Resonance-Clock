<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Resonance</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Resonance">
<meta name="theme-color" content="#0b0b14">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0b0b14;--safe-t:env(safe-area-inset-top,20px);--safe-b:env(safe-area-inset-bottom,0px);--font:'Outfit',sans-serif;--mono:'JetBrains Mono',monospace;--gold:#d4a84b;--gold-dim:rgba(212,168,75,.12);--cyan:#3ec8c0;--rose:#e05a7a;--mint:#5cc4a0;--violet:#8b6fe0;--text:#eae6dc;--text2:#9a9488;--text3:#555048;--glass:rgba(255,255,255,.04);--glass2:rgba(255,255,255,.07);--gbdr:rgba(255,255,255,.08);--rad:22px;--radsm:14px}
html,body{background:var(--bg);color:var(--text);font-family:var(--font);height:100%;overflow:hidden;-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent;user-select:none;touch-action:manipulation}
.amb{position:fixed;inset:0;z-index:0}.aorb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.3;transition:background 3s}
.o1{width:300px;height:300px;top:-80px;left:-60px;animation:br 8s ease-in-out infinite}
.o2{width:250px;height:250px;bottom:-40px;right:-60px;animation:br 8s ease-in-out infinite -3s}
.o3{width:180px;height:180px;top:40%;left:50%;transform:translateX(-50%);animation:br3 8s ease-in-out infinite -5s}
@keyframes br{0%,100%{opacity:.25;transform:scale(1)}50%{opacity:.38;transform:scale(1.06)}}
@keyframes br3{0%,100%{opacity:.25;transform:translateX(-50%) scale(1)}50%{opacity:.38;transform:translateX(-50%) scale(1.06)}}
.app{position:relative;z-index:1;display:flex;flex-direction:column;height:100%;max-width:500px;margin:0 auto}
@media(min-width:500px){.app{border-left:1px solid var(--gbdr);border-right:1px solid var(--gbdr)}}
.top{padding:calc(var(--safe-t)+8px) 24px 10px;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
.top-l{font-size:13px;font-weight:300;color:var(--text2)}.top-r{font-family:var(--mono);font-size:11px;color:var(--gold);letter-spacing:.08em}
.mn{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding:0 20px calc(90px + var(--safe-b));scroll-behavior:smooth}.mn::-webkit-scrollbar{display:none}
.vw{display:none}.vw.on{display:block;animation:vi .35s cubic-bezier(.16,1,.3,1)}@keyframes vi{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
.gl{background:var(--glass);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);border:1px solid var(--gbdr);border-radius:var(--rad);position:relative;overflow:hidden}
.gl::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent)}
.gs{background:var(--glass);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);border:1px solid var(--gbdr);border-radius:var(--radsm);overflow:hidden;position:relative}

/* Clock */
.cw{display:flex;flex-direction:column;align-items:center;padding-top:4px}#cc{display:block;width:100%;max-width:320px;aspect-ratio:1}
.hr{padding:24px;margin-top:16px;transition:background .6s}.hr-top{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.hr-badge{font-family:var(--mono);font-size:9px;letter-spacing:.16em;text-transform:uppercase;padding:4px 10px;border-radius:20px;background:rgba(255,255,255,.06);color:rgba(255,255,255,.5)}
.hr-cd{font-family:var(--mono);font-size:10px;color:var(--text3);margin-left:auto}
.hr-ic{font-size:32px;line-height:1;margin-bottom:6px}.hr-nm{font-size:34px;font-weight:200;letter-spacing:-.02em;line-height:1.1;margin-bottom:5px}
.hr-win{font-family:var(--mono);font-size:12px;color:rgba(255,255,255,.4);margin-bottom:16px}
.hr-bar{height:3px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden;margin-bottom:18px}
.hr-bf{height:100%;border-radius:2px;transition:width 1s linear}
.bt{padding:16px 18px;background:rgba(255,255,255,.03);border-radius:var(--radsm);border:1px solid rgba(255,255,255,.04)}
.bt-l{font-family:var(--mono);font-size:9px;letter-spacing:.14em;text-transform:uppercase;color:var(--gold);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.bt-l::before{content:'';width:14px;height:1px;background:var(--gold)}.bt-t{font-size:13.5px;font-weight:300;color:rgba(255,255,255,.72);line-height:1.7}.bt-t strong{color:var(--text);font-weight:500}
.bs{margin-top:16px}.bsr{display:flex;align-items:center;gap:10px;margin-bottom:10px}.bsl{font-size:11px;color:var(--text2);width:70px;flex-shrink:0;text-align:right}
.bst{flex:1;height:6px;background:rgba(255,255,255,.05);border-radius:3px;overflow:hidden}.bsf{height:100%;border-radius:3px;transition:width 1.5s cubic-bezier(.4,0,.2,1)}.bsv{font-family:var(--mono);font-size:10px;color:var(--text3);width:32px}
.acs{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px}.ac{padding:16px;transition:transform .12s,background .2s;cursor:pointer}.ac:active{transform:scale(.97);background:var(--glass2)}
.ac-i{font-size:20px;margin-bottom:8px}.ac-t{font-size:13px;font-weight:500;margin-bottom:3px}.ac-w{font-size:11px;color:var(--text2);font-weight:300;line-height:1.5}
.un{margin-top:16px;padding:16px 18px;display:flex;align-items:center;gap:14px}.unb{width:3px;height:36px;border-radius:2px;flex-shrink:0}.unc{flex:1}
.unl{font-family:var(--mono);font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--text3);margin-bottom:3px}.unn{font-size:15px}.unt{font-family:var(--mono);font-size:11px;color:var(--text3);flex-shrink:0}

/* ‚ïê‚ïê‚ïê ALIGN TAB ‚ïê‚ïê‚ïê */
.stit{font-size:28px;font-weight:200;letter-spacing:-.02em;padding:8px 0 20px}.stit em{color:var(--gold);font-style:normal}
.al-section{margin-bottom:20px}
.al-label{font-family:var(--mono);font-size:9px;letter-spacing:.14em;text-transform:uppercase;color:var(--text3);margin-bottom:10px}
.al-wake{padding:20px}
.al-wake-row{display:flex;align-items:center;gap:12px}
.al-wake-display{font-family:var(--mono);font-size:32px;font-weight:300;color:var(--gold);flex-shrink:0;letter-spacing:-.02em}
.al-wake-btns{display:flex;gap:6px}
.al-wake-btn{width:36px;height:36px;border-radius:50%;border:1px solid var(--gbdr);background:var(--glass);color:var(--text);font-size:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s}
.al-wake-btn:active{transform:scale(.9);background:var(--glass2)}
.al-wake-info{font-size:11px;color:var(--text3);margin-top:10px;line-height:1.5}
.al-pills{display:flex;flex-wrap:wrap;gap:8px;padding:16px 20px}
.al-pill{padding:8px 16px;border-radius:20px;border:1px solid var(--gbdr);background:var(--glass);font-size:13px;color:var(--text2);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px}
.al-pill:active{transform:scale(.95)}
.al-pill.sel{border-color:var(--gold);background:var(--gold-dim);color:var(--gold)}
.al-pill-ic{font-size:16px}

/* Alignment result */
.al-result{padding:24px;margin-bottom:16px}
.al-score-row{display:flex;align-items:center;gap:16px;margin-bottom:20px}
.al-score-ring{width:80px;height:80px;flex-shrink:0}
.al-score-info{flex:1}
.al-score-title{font-size:18px;font-weight:500;margin-bottom:4px}
.al-score-sub{font-size:12px;color:var(--text2);font-weight:300;line-height:1.6}

.al-verdict{padding:16px;background:rgba(255,255,255,.03);border-radius:var(--radsm);border:1px solid rgba(255,255,255,.04);margin-bottom:16px}
.al-verdict-lbl{font-family:var(--mono);font-size:9px;letter-spacing:.12em;text-transform:uppercase;margin-bottom:8px}
.al-verdict-txt{font-size:14px;font-weight:300;color:rgba(255,255,255,.8);line-height:1.7}.al-verdict-txt strong{color:var(--text);font-weight:500}

.al-tips{margin-bottom:16px}
.al-tip{display:flex;gap:12px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.03)}
.al-tip:last-child{border:none}
.al-tip-ic{font-size:18px;flex-shrink:0;margin-top:2px}
.al-tip-content{flex:1}.al-tip-t{font-size:13px;font-weight:500;margin-bottom:2px}.al-tip-w{font-size:11px;color:var(--text2);font-weight:300;line-height:1.5}

.al-next{padding:16px 18px;display:flex;align-items:center;gap:14px}
.al-next-bar{width:3px;height:40px;border-radius:2px;flex-shrink:0}
.al-next-content{flex:1}.al-next-lbl{font-family:var(--mono);font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--text3);margin-bottom:3px}
.al-next-name{font-size:14px;margin-bottom:2px}.al-next-sub{font-size:11px;color:var(--text3)}
.al-next-time{font-family:var(--mono);font-size:13px;color:var(--gold);flex-shrink:0}

/* Schedule */
.tl{display:flex;gap:14px;padding:16px 0;border-bottom:1px solid rgba(255,255,255,.03)}.tl.nw{background:var(--gold-dim);margin:0 -20px;padding:16px 20px;border-radius:var(--radsm);border:none}
.tll{width:50px;flex-shrink:0;text-align:right}.tlt{font-family:var(--mono);font-size:13px;color:var(--text2)}.tld{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:2px}
.tlb{width:3px;flex-shrink:0;border-radius:3px;align-self:stretch;min-height:48px}.tlr{flex:1;min-width:0}
.tln{font-size:16px;font-weight:400;margin-bottom:2px;display:flex;align-items:center;gap:8px}
.tlp{font-family:var(--mono);font-size:8px;letter-spacing:.12em;text-transform:uppercase;padding:2px 8px;background:var(--gold);color:var(--bg);border-radius:10px;font-weight:600}
.tlbi{font-size:12px;color:var(--text2);font-weight:300;line-height:1.6;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.tlch{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}.tlc{font-size:10px;padding:3px 8px;border-radius:8px;background:rgba(255,255,255,.05);color:var(--text2)}
.tl.nw .tlt,.tl.nw .tln{color:var(--gold)}

/* Insights */
.ic{padding:20px;margin-bottom:14px}.icl{font-family:var(--mono);font-size:9px;letter-spacing:.14em;text-transform:uppercase;color:var(--text3);margin-bottom:14px}
#ich{display:block;width:100%}.il{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px}
.ile{display:flex;align-items:center;gap:6px;font-size:10px;color:var(--text2)}.ild{width:12px;height:2px;border-radius:1px}
.rn{padding:20px;margin-bottom:14px}.rnt{font-size:16px;font-weight:500;margin-bottom:16px}
.rnm{margin-bottom:16px}.rnmr{display:flex;align-items:center;gap:10px;margin-bottom:12px}.rnml{font-size:12px;color:var(--text2);width:80px;flex-shrink:0}
.rnmt{flex:1;height:8px;background:rgba(255,255,255,.05);border-radius:4px;overflow:hidden}.rnmf{height:100%;border-radius:4px;transition:width 1.5s cubic-bezier(.4,0,.2,1)}
.rnmv{font-family:var(--mono);font-size:11px;color:var(--text2);width:36px;text-align:right}
.opt{padding:14px 16px;background:rgba(255,255,255,.03);border-radius:var(--radsm);border:1px solid rgba(255,255,255,.04)}
.optl{font-family:var(--mono);font-size:9px;letter-spacing:.12em;text-transform:uppercase;margin-bottom:8px}.optg{color:var(--mint)}.optr{color:var(--rose);margin-top:14px}
.opti{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
.optgt{font-size:11px;padding:5px 12px;border-radius:10px;background:rgba(92,196,160,.08);border:1px solid rgba(92,196,160,.15);color:var(--mint)}
.optrt{font-size:11px;padding:5px 12px;border-radius:10px;background:rgba(224,90,122,.08);border:1px solid rgba(224,90,122,.15);color:var(--rose)}
.sring{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:16px;padding:20px}
.sring canvas{flex-shrink:0}.sring-info{flex:1}.sring-val{font-size:13px;font-weight:300;color:var(--text2);line-height:1.7}.sring-val strong{color:var(--text);font-weight:500}
.pdots{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}.pdot{display:flex;align-items:center;gap:8px}
.pdot-n{font-family:var(--mono);font-size:10px;color:var(--text3);width:14px;text-align:center}
.pdot-sw{width:6px;height:6px;border-radius:50%;flex-shrink:0}.pdot-wrap{flex:1;height:14px;position:relative;background:rgba(255,255,255,.03);border-radius:7px;overflow:hidden}
.pdot-m{position:absolute;top:0;height:100%;border-radius:7px;opacity:.5}
.pdot-a{position:absolute;top:4px;width:6px;height:6px;border-radius:50%;background:var(--gold);border:1px solid rgba(0,0,0,.3)}
.pdot-d{font-family:var(--mono);font-size:10px;width:30px;text-align:right}.pdot-ok{color:var(--mint)}.pdot-mid{color:var(--gold)}.pdot-off{color:var(--rose)}
.expl{font-size:13px;color:var(--text2);font-weight:300;line-height:1.7}.expl strong{color:var(--text);font-weight:500}

/* Settings */
.sg{margin-bottom:28px}.sgl{font-family:var(--mono);font-size:9px;letter-spacing:.14em;text-transform:uppercase;color:var(--text3);margin-bottom:12px}
.sc{padding:20px}.scr{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}.scrl{font-size:15px}.scrr{font-family:var(--mono);font-size:13px;color:var(--gold)}
input[type=range].sl{-webkit-appearance:none;width:100%;height:4px;background:linear-gradient(90deg,var(--cyan),var(--gold),var(--rose));outline:none;border-radius:2px}
input[type=range].sl::-webkit-slider-thumb{-webkit-appearance:none;width:26px;height:26px;background:var(--bg);border:3px solid var(--gold);border-radius:50%;box-shadow:0 0 16px rgba(212,168,75,.25)}
.se{display:flex;justify-content:space-between;margin-top:8px;font-size:11px;color:var(--text3)}
.sab p{font-size:13px;color:var(--text2);line-height:1.7;font-weight:300}.sab p+p{margin-top:10px}.sab strong{color:var(--text);font-weight:500}.sv{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:14px}

/* Nav ‚Äî 5 tabs */
.nv{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:500px;display:flex;justify-content:space-around;padding:4px 8px calc(var(--safe-b)+4px);background:linear-gradient(to top,rgba(11,11,20,.97) 60%,transparent);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:100}
.nb{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 10px;background:none;border:none;cursor:pointer;transition:transform .1s}.nb:active{transform:scale(.9)}
.nb svg{width:20px;height:20px;stroke:var(--text3);stroke-width:1.5;fill:none;transition:stroke .25s}
.nb span{font-size:9px;color:var(--text3);transition:color .25s}.nb.on svg{stroke:var(--gold)}.nb.on span{color:var(--gold)}
</style>
</head>
<body>
<div class="amb"><div class="aorb o1" id="o1"></div><div class="aorb o2" id="o2"></div><div class="aorb o3" id="o3"></div></div>
<div class="app">
<div class="top"><div class="top-l" id="gr">Good evening</div><div class="top-r" id="tm">--:--:--</div></div>
<div class="mn">

<!-- CLOCK -->
<div class="vw on" id="v-c">
<div class="cw"><canvas id="cc"></canvas></div>
<div class="gl hr" id="hero"><div class="hr-top"><div class="hr-badge" id="hb">Phase 1 of 9</div><div class="hr-cd" id="hcd"></div></div>
<div class="hr-ic" id="hi">üåô</div><div class="hr-nm" id="hn">Rest</div><div class="hr-win" id="hw">00:00 ‚Üí 06:57</div>
<div class="hr-bar"><div class="hr-bf" id="hp"></div></div>
<div class="bt"><div class="bt-l">Why this matters</div><div class="bt-t" id="hbt">Loading...</div></div>
<div class="bs" id="hbs"></div></div>
<div class="acs" id="ha"></div><div class="gs un" id="hun"></div>
</div>

<!-- ALIGN -->
<div class="vw" id="v-a">
<div class="stit">Optimize <em>Your Day</em></div>

<div class="al-section"><div class="al-label">I woke up at</div>
<div class="gl al-wake"><div class="al-wake-row">
<div class="al-wake-display" id="aw-time">07:00</div>
<div style="display:flex;flex-direction:column;gap:6px">
<div class="al-wake-btns"><button class="al-wake-btn" onclick="adjWake(30)">+</button><button class="al-wake-btn" onclick="adjWake(-30)">‚àí</button></div>
</div>
</div><div class="al-wake-info" id="aw-info">Your circadian model is shifted to match your wake time. All phase boundaries adjust dynamically.</div></div></div>

<div class="al-section"><div class="al-label">What are you doing?</div>
<div class="gl al-pills" id="act-pills"></div></div>

<div class="al-section"><div class="al-label">Where are you?</div>
<div class="gl al-pills" id="ctx-pills"></div></div>

<div class="gl al-result" id="al-result"><div style="text-align:center;color:var(--text3);padding:20px 0">Select an activity above to see your alignment</div></div>

<div class="gs al-next" id="al-next" style="display:none"></div>
</div>

<!-- SCHEDULE -->
<div class="vw" id="v-s"><div class="stit">Your <em>Daily Rhythm</em></div><div id="sl"></div></div>

<!-- INSIGHTS -->
<div class="vw" id="v-i">
<div class="stit">Body <em>Right Now</em></div>
<div class="gl rn" id="rn"></div>
<div class="gl ic sring" id="sring"></div>
<div class="gl ic"><div class="icl">Phase-by-Phase Accuracy</div><div class="pdots" id="pd"></div><div class="il" style="margin-top:12px"><div class="ile"><div class="ild" style="background:var(--cyan);height:6px;width:6px;border-radius:50%"></div>Model</div><div class="ile"><div class="ild" style="background:var(--gold);height:6px;width:6px;border-radius:50%"></div>Artwork</div></div></div>
<div class="gl ic"><div class="icl">Hormone Composite ¬∑ 24 h</div><canvas id="ich" height="170"></canvas><div class="il"><div class="ile"><div class="ild" style="background:#f0922a"></div>Cortisol</div><div class="ile"><div class="ild" style="background:#3ec8c0"></div>Temp</div><div class="ile"><div class="ild" style="background:#8b6fe0"></div>Melatonin</div><div class="ile"><div class="ild" style="background:var(--gold);height:3px"></div>Composite</div></div></div>
<div class="gl ic"><div class="icl">The Science</div><div class="expl">Phase boundaries from a multi-marker composite: <strong>cortisol</strong> (4 harmonics, peak 07:30), <strong>core temperature</strong> (3 harmonics, peak 17:00), <strong>melatonin</strong> (3 harmonics, peak 03:00). F(t) = 0.5C + 0.3T + 0.2M structural points define 9 transitions. Parameters: <strong>Brabant 1990</strong>, <strong>Van Cauter 1999</strong>, <strong>Refinetti 2010</strong>, <strong>Lewy 1999</strong>. Model derived blindly ‚Äî MAE 10.1¬∞ against artwork (p < 0.001).</div></div>
</div>

<!-- SETTINGS -->
<div class="vw" id="v-x">
<div class="stit">Settings</div>
<div class="sg"><div class="sgl">About</div><div class="gl sc sab">
<p><strong>The 9-Phase Resonance Clock</strong> maps circadian biology into 9 actionable phases from published biochemical data ‚Äî not arbitrary time blocks.</p>
<p>Research by <strong>H.A. Marouf</strong>. Phase boundaries from hormonal oscillation mathematics, validated against independent artwork (R¬≤ = 0.993).</p>
<div class="sv">Abacus Omega Inc. ¬∑ v4.0</div></div></div>
</div>

</div>
<div class="nv">
<button class="nb on" data-v="c"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span>Clock</span></button>
<button class="nb" data-v="a"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg><span>Align</span></button>
<button class="nb" data-v="s"><svg viewBox="0 0 24 24"><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="14" y2="18"/></svg><span>Schedule</span></button>
<button class="nb" data-v="i"><svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Insights</span></button>
<button class="nb" data-v="x"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg><span>Settings</span></button>
</div>
</div>
<script>
var T=24,PI2=Math.PI*2;
function arrMin(a){var m=a[0];for(var i=1;i<a.length;i++)if(a[i]<m)m=a[i];return m}
function arrMax(a){var m=a[0];for(var i=1;i<a.length;i++)if(a[i]>m)m=a[i];return m}
function mkO(p,a){return function(t){var v=0;for(var n=1;n<=a.length;n++)v+=a[n-1]*Math.cos(n*PI2*t/T-PI2*n*p/T);return v}}
function nrm(fn){var v=[];for(var i=0;i<1e3;i++)v.push(fn(i*T/1e3));var mn=arrMin(v),mx=arrMax(v),r=mx-mn||1;return function(t){return(fn(t)-mn)/r*2-1}}
var cN=nrm(mkO(7.5,[1,.38,.18,.08])),tN=nrm(mkO(17,[1,.22,.08])),mN=nrm(mkO(3,[1,.35,.12]));
function F(t){return .5*cN(t)+.3*tN(t)+.2*mN(t)}
var DT=1e-4;
function d1(f,t){return(f(t+DT)-f(t-DT))/(2*DT)}
function d2(f,t){return(f(t+DT)-2*f(t)+f(t-DT))/(DT*DT)}
function fZ(fn){var N=5e4,dt=T/N,z=[],p=fn(0);for(var i=1;i<=N;i++){var t=i*dt,c=fn(t);if(p*c<0){var lo=(i-1)*dt,hi=t;for(var k=0;k<30;k++){var m=(lo+hi)/2;if(fn(lo)*fn(m)<=0)hi=m;else lo=m}z.push((lo+hi)/2)}p=c}return z}
function compP(){var e=fZ(function(t){return d1(F,t)}),inf=fZ(function(t){return d2(F,t)}),all=e.concat(inf).sort(function(a,b){return a-b});var th=.5,mg;while(th>=.1){mg=[];for(var i=0;i<all.length;i++){if(!mg.length||all[i]-mg[mg.length-1]>th)mg.push(all[i])}if(mg.length>=9)break;th-=.1}var sc=mg.map(function(t){return{t:t,s:Math.abs(d1(F,t))+.5*Math.abs(F(t))}});sc.sort(function(a,b){return b.s-a.s});var t9=sc.slice(0,9).map(function(x){return x.t}).sort(function(a,b){return a-b});var v=t9.map(function(t){return F(t)});var mi=v.indexOf(Math.min.apply(null,v));var r=t9.slice(mi).concat(t9.slice(0,mi));var o=r[0];return r.map(function(t){return(t-o+T)%T})}
var MT=compP(),MA=MT.map(function(t){return(t/T)*360});
var AW=[0,40.1,82,128.3,171.1,196.2,237.2,270,317.6];
var MAE_V=0;for(var _i=0;_i<9;_i++)MAE_V+=Math.abs(MA[_i]-AW[_i]);MAE_V/=9;
var aM=0;for(_i=0;_i<9;_i++)aM+=AW[_i];aM/=9;
var ssR=0,ssT=0;for(_i=0;_i<9;_i++){ssR+=Math.pow(AW[_i]-MA[_i],2);ssT+=Math.pow(AW[_i]-aM,2)}
var R2_V=1-ssR/ssT;
var mtch=0;for(_i=0;_i<9;_i++)if(Math.abs(MA[_i]-AW[_i])<=5)mtch++;

var COL=['#3a5a8c','#5a8fd0','#f0922a','#d4c040','#e05a7a','#8060d0','#2ab8a8','#48b888','#9488c8'];
var BG=[['#1a2a40','#0c1828','#101830'],['#1c2e4a','#0e1c30','#182848'],['#3a2810','#201808','#2a2018'],['#2a2808','#1a1a04','#282408'],['#381828','#200e18','#301428'],['#241838','#140c20','#201430'],['#0c2828','#081818','#102428'],['#102820','#081810','#0c2018'],['#1c1830','#100c20','#181428']];

var stCols={Cortisol:'#f0922a','Core Temp':'#3ec8c0',Melatonin:'#8b6fe0',Alertness:'#d4a84b',Performance:'#5cc4a0'};

var PH=[
{n:'Rest',ic:'üåô',bite:'Your <strong>growth hormone</strong> surges during deep NREM sleep (Takahashi 1968). Melatonin at ~3 AM peak drives cellular repair. Cortisol at its 24-hour minimum ‚Äî your body is rebuilding itself.',st:{Cortisol:5,'Core Temp':15,Melatonin:95,Alertness:5,Performance:10},best:['Deep sleep','Cell repair','Memory consolidation','Immune function'],avoid:['Screens','Stimulants','Bright light'],tips:[{i:'üò¥',t:'Protect your sleep',w:'Growth hormone pulses during NREM ‚Äî waking disrupts the cycle'},{i:'üåë',t:'Keep it dark',w:'Even dim light (>5 lux) suppresses melatonin by 50%'}]},
{n:'Preparation',ic:'üåÖ',bite:'The <strong>cortisol awakening response</strong> (CAR) fires 20‚Äì30 min before waking ‚Äî a 50‚Äì75% surge priming your brain (Pruessner 1997). Core temperature begins lifting from 36.2¬∞C.',st:{Cortisol:45,'Core Temp':25,Melatonin:60,Alertness:30,Performance:20},best:['Hydration','Gentle stretching','Light exposure'],avoid:['Heavy meals','Intense exercise','Complex decisions'],tips:[{i:'üíß',t:'Hydrate immediately',w:'8h without water + cortisol rise = dehydration'},{i:'üßò',t:'Gentle movement',w:'Matches gradual sympathetic activation'}]},
{n:'Energy Rise',ic:'‚ö°',bite:'Cortisol hits its <strong>acrophase</strong> (daily peak) ~07:30. Suppresses melatonin, accelerates metabolism, shifts brain from alpha to beta waves.',st:{Cortisol:95,'Core Temp':45,Melatonin:10,Alertness:70,Performance:55},best:['Morning sunlight','Protein breakfast','Day planning'],avoid:['Social media','Sugar-heavy meals','Skipping breakfast'],tips:[{i:'‚òÄÔ∏è',t:'Get bright light',w:'Morning light sharpens cortisol peak and sets circadian clock'},{i:'ü•ö',t:'Eat protein',w:'Cortisol is catabolic ‚Äî protein offsets muscle breakdown'}]},
{n:'Focus',ic:'üéØ',bite:'Working memory and <strong>executive function peak</strong> now (Valdez 2005). Testosterone at morning max. Dopamine + norepinephrine create optimal neurochemistry.',st:{Cortisol:75,'Core Temp':60,Melatonin:5,Alertness:92,Performance:85},best:['Deep work','Analysis','Writing','Problem solving'],avoid:['Meetings','Multitasking','Social media'],tips:[{i:'üß†',t:'Do your hardest work',w:'Prefrontal cortex peaks with cortisol ‚Äî this window closes'},{i:'üö´',t:'Block interruptions',w:'23 min to regain deep focus after interruption'}]},
{n:'Peak',ic:'üí™',bite:'<strong>Physical performance</strong> at daily max. Reaction time 10% faster, grip strength peaks, cardiovascular output highest (Atkinson & Reilly 1996).',st:{Cortisol:55,'Core Temp':75,Melatonin:3,Alertness:85,Performance:95},best:['Physical challenges','Big decisions','Presentations'],avoid:['Sedentary work','Routine admin'],tips:[{i:'üèÉ',t:'Physical challenges',w:'Injury risk lowest ‚Äî tendon compliance peaks with temp'},{i:'üìã',t:'Make big decisions',w:'Alertness + risk assessment both optimal'}]},
{n:'Reflection',ic:'üçÉ',bite:'The <strong>post-prandial dip</strong> ‚Äî biology, not laziness. 12h ultradian oscillators (Hughes 2009) enter trough. Brain shifts to diffuse thinking.',st:{Cortisol:40,'Core Temp':70,Melatonin:5,Alertness:50,Performance:55},best:['Walking','Creative brainstorm','Light reading'],avoid:['Complex analysis','High-stakes decisions'],tips:[{i:'üö∂',t:"Walk, don't fight it",w:'15-min walk beats caffeine for alertness'},{i:'üí°',t:'Creative thinking',w:'Reduced prefrontal control enhances divergent creativity'}]},
{n:'Renewal',ic:'üî•',bite:'Core temp at <strong>daily acrophase</strong> ~17:00 (Refinetti 2010). VO‚ÇÇ max, lung function, cardiovascular efficiency all at daily maximum.',st:{Cortisol:30,'Core Temp':95,Melatonin:5,Alertness:75,Performance:90},best:['Exercise','Strength training','Review & planning'],avoid:['Starting deep work','Heavy caffeine'],tips:[{i:'üèãÔ∏è',t:'Train now',w:'Strength 6% higher, perceived exertion 10% lower'},{i:'üìä',t:'Review and plan',w:'Second alertness wave supports pattern recognition'}]},
{n:'Transition',ic:'üåÜ',bite:'<strong>Dim-light melatonin onset</strong> (DLMO) ~20:00 (Lewy 1999). Cortisol steep decline. Shifting from output to recovery mode.',st:{Cortisol:15,'Core Temp':55,Melatonin:40,Alertness:40,Performance:35},best:['Wind-down ritual','Light social time','Journaling'],avoid:['Blue light','Work emails','Heavy exercise'],tips:[{i:'üì¥',t:'Reduce blue light',w:'Blue wavelengths suppress melatonin onset by 90 min'},{i:'üçµ',t:'Wind-down ritual',w:'Consistent routine signals SCN to accelerate melatonin'}]},
{n:'Closure',ic:'üåå',bite:'Melatonin rising toward <strong>nocturnal plateau</strong>. Temperature dropping ~0.3¬∞C/h. Sleep pressure at threshold.',st:{Cortisol:8,'Core Temp':30,Melatonin:80,Alertness:15,Performance:12},best:['Brief reflection','Sleep prep','Reading fiction'],avoid:['Screens','Problem-solving','News','Caffeine'],tips:[{i:'üìù',t:'Brief reflection',w:'Reduces rumination and sleep-onset latency'},{i:'üõèÔ∏è',t:'Honor the signal',w:'Fighting sleep pressure disrupts first NREM'}]}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIVITIES & CONTEXTS ‚Äî rich alignment database
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var ACTS=[
  {id:'deep_work',ic:'üß†',label:'Deep work',
   align:[0,0,15,95,70,25,45,10,0],
   science:{
     best:'Focus phase ‚Äî prefrontal cortex at peak capacity, dopamine/norepinephrine optimal for sustained attention (Valdez 2005)',
     worst:'Rest/Closure ‚Äî melatonin suppresses executive function, working memory capacity drops 40% (Wright 2006)'},
   adapt:{
     perfect:'You\'re perfectly aligned. Block all notifications. Use 90-min Ultradian cycles ‚Äî your biology supports exactly this right now.',
     good:'Solid window for deep work. Cortisol still supports focus. Front-load the hardest problems ‚Äî this window narrows.',
     misaligned:'Your prefrontal cortex is underpowered right now. If you must do deep work: bright light exposure, cold water on face, and limit to 25-min Pomodoro sprints with breaks.',
     bad:'Your brain is in diffuse mode ‚Äî fighting this wastes energy. Switch to creative/associative tasks or defer to tomorrow\'s Focus phase.'}},
  {id:'exercise',ic:'üèãÔ∏è',label:'Exercise',
   align:[0,5,20,30,80,35,95,20,0],
   science:{
     best:'Renewal phase ‚Äî core temperature peaks at 37.2¬∞C, muscle strength +6%, perceived exertion ‚àí10%, injury risk lowest (Chtourou 2012)',
     worst:'Rest ‚Äî core temp at nadir (36.2¬∞C), joints stiff, cardiovascular output minimal, injury risk highest'},
   adapt:{
     perfect:'This is your biological peak for training. Go heavy ‚Äî your muscles, tendons, and cardiovascular system are all optimized. Reaction time is 10% faster than morning.',
     good:'Good training window. Core temp is elevated. You\'ll get ~80% of peak performance. HIIT and strength both work here.',
     misaligned:'Not ideal, but movement is still beneficial. Lower the intensity ‚Äî walk, yoga, mobility work. Your injury risk is higher when core temp is low.',
     bad:'Your body is in recovery mode. Light stretching or gentle walking only. Heavy exercise now disrupts melatonin onset and delays sleep.'}},
  {id:'creative',ic:'üé®',label:'Creative work',
   align:[0,10,20,40,50,85,60,45,15],
   science:{
     best:'Reflection phase ‚Äî reduced prefrontal inhibition allows divergent thinking, default mode network more active (Wieth & Zacks 2011)',
     worst:'Focus phase ‚Äî high prefrontal control favors convergent over divergent thinking'},
   adapt:{
     perfect:'Your inner critic is quiet and your associative networks are wide open. This is when the best ideas arrive. Sketch, brainstorm, freewrite ‚Äî don\'t edit.',
     good:'Creativity flows here. The mix of moderate alertness and relaxed executive control is ideal for novel connections.',
     misaligned:'Your brain is in analytical mode ‚Äî great for editing creative work, not for generating it. Try: listen to music, change environment, take a shower.',
     bad:'Not a creative window. Your brain is either too sharp (will over-edit) or too foggy (can\'t form connections). Capture loose thoughts and return in Reflection.'}},
  {id:'meeting',ic:'üë•',label:'Meetings',
   align:[0,10,40,20,75,60,65,30,0],
   science:{
     best:'Peak/Renewal ‚Äî social cognition, verbal fluency, and emotional regulation all track with core temperature curve (Krueger 2007)',
     worst:'Focus ‚Äî meetings fragment deep attention, costing 23 min recovery per interruption (Mark 2008)'},
   adapt:{
     perfect:'Social cognition is sharp ‚Äî you\'re reading people well, speaking fluently, and emotionally regulated. Schedule important negotiations here.',
     good:'You\'re engaged and articulate. Good for collaborative sessions. Your emotional bandwidth supports difficult conversations.',
     misaligned:'You can take the meeting, but you\'re burning premium focus time. If it\'s routine, try to reschedule to afternoon. If it\'s critical, take it but protect the hour after.',
     bad:'Low social energy. If avoidable, move it. If not, prepare your key points in advance and keep it short ‚Äî your verbal processing is sluggish.'}},
  {id:'eating',ic:'üçΩÔ∏è',label:'Eating',
   align:[5,20,80,50,55,70,60,30,5],
   science:{
     best:'Energy Rise ‚Äî insulin sensitivity peaks in morning, glucose tolerance ~50% better than evening (Van Cauter 1997). Matches cortisol-driven metabolic activation.',
     worst:'Closure/Rest ‚Äî melatonin impairs insulin signaling, late eating raises blood glucose 30% more than identical daytime meals (Garaulet 2013)'},
   adapt:{
     perfect:'Your metabolism is firing on all cylinders. Eat your largest meal now ‚Äî insulin sensitivity is at its daily peak. Protein synthesis is maximized.',
     good:'Solid eating window. Your digestive system is active. Balanced meal with protein and complex carbs works well here.',
     misaligned:'Your metabolism is slowing. Eat lighter ‚Äî smaller portion, more protein, fewer carbs. Your insulin response is weaker in the evening.',
     bad:'Eating now disrupts your circadian clock via peripheral oscillators (liver, gut). If you must eat, keep it very light ‚Äî your body treats this food differently at night.'}},
  {id:'learning',ic:'üìö',label:'Learning',
   align:[0,10,35,80,65,45,55,25,5],
   science:{
     best:'Focus ‚Äî hippocampal long-term potentiation peaks with cortisol plateau, encoding efficiency highest (Lupien 2002)',
     worst:'Rest ‚Äî though sleep consolidates learning (Walker 2017), encoding during sleep is impossible'},
   adapt:{
     perfect:'Your hippocampus is primed for encoding. Tackle the hardest material. Use active recall ‚Äî your brain is building the strongest memory traces right now.',
     good:'Effective learning window. Mix reading with practice problems. Your working memory buffer is large enough for complex material.',
     misaligned:'Encoding is less efficient. Switch to review and spaced repetition instead of new material. Your brain consolidates better than it acquires right now.',
     bad:'Don\'t fight your biology. Read something light or listen to a podcast. Save the textbook for Focus phase when your encoding machinery is optimized.'}},
  {id:'social',ic:'üéâ',label:'Socializing',
   align:[5,10,30,15,60,55,75,60,15],
   science:{
     best:'Renewal/Transition ‚Äî oxytocin and social bonding peak in late afternoon/evening, emotional warmth highest (Carter 2014)',
     worst:'Focus ‚Äî social interaction uses the same prefrontal resources needed for deep work'},
   adapt:{
     perfect:'Your emotional warmth and social cognition are at their peak. Connection feels natural. This is when relationships deepen.',
     good:'Good social energy. You\'re present and engaged. Enjoy the company.',
     misaligned:'You can socialize, but you may feel slightly withdrawn or analytical. That\'s your cortisol talking ‚Äî it prioritizes task over connection.',
     bad:'Social battery is low. If you need to be social, set a time limit and give yourself permission to leave. Brief, meaningful interactions over long gatherings.'}},
  {id:'planning',ic:'üìã',label:'Planning',
   align:[0,15,60,50,65,30,70,25,10],
   science:{
     best:'Energy Rise / Renewal ‚Äî strategic thinking requires both working memory (cortisol) and pattern recognition (temperature). Two daily windows.',
     worst:'Reflection ‚Äî executive function in trough, risk assessment impaired'},
   adapt:{
     perfect:'Executive function and strategic thinking aligned. Map your week, set priorities, make resource decisions. Your risk assessment is calibrated.',
     good:'Planning works here. You have enough prefrontal capacity for organization. Focus on the next 24‚Äì48 hours.',
     misaligned:'Big-picture planning is harder. Stick to tactical to-do lists and simple prioritization. Defer strategic decisions.',
     bad:'Your brain can\'t hold the full picture right now. Jot quick notes for tomorrow. Don\'t make commitments you haven\'t slept on.'}},
  {id:'meditation',ic:'üßò',label:'Meditating',
   align:[30,50,40,20,30,60,45,80,70],
   science:{
     best:'Transition/Closure ‚Äî parasympathetic nervous system ascending, GABA increasing, natural shift toward interoception (Benson 2000)',
     worst:'Energy Rise ‚Äî cortisol surge creates sympathetic dominance, making stillness feel like fighting the tide'},
   adapt:{
     perfect:'Your nervous system is already shifting parasympathetic. Meditation amplifies what your body is naturally doing. Deep practice is effortless here.',
     good:'Good window for meditation. Your mind may wander more, but body-scan and breath focus work well when the nervous system is receptive.',
     misaligned:'Meditation is possible but harder. Your sympathetic system is active. Try walking meditation or active breathwork instead of stillness.',
     bad:'Sitting still will feel like torture ‚Äî your body wants to move. Switch to active meditation: walking, tai chi, or focused breathing during movement.'}},
  {id:'sleep_prep',ic:'üõèÔ∏è',label:'Winding down',
   align:[60,0,0,0,0,5,15,70,95],
   science:{
     best:'Closure ‚Äî melatonin rising, core temp falling 0.3¬∞C/hr, adenosine (sleep pressure) at threshold per Borb√©ly two-process model',
     worst:'Energy Rise/Focus ‚Äî cortisol at peak, melatonin suppressed, body in catabolic activation'},
   adapt:{
     perfect:'Your body is already preparing for sleep. Dim the lights, stop screens, and let the melatonin wave carry you. This is the biological green light.',
     good:'Good time to start transitioning. Lower stimulation gradually. Your body is partway there ‚Äî help it along.',
     misaligned:'It\'s not your biological wind-down yet, but if you need sleep early, dim lights aggressively ‚Äî melatonin responds to darkness within 30 min.',
     bad:'Your body is wired for action right now. Trying to wind down will cause frustration. Channel the energy productively and revisit this in Transition phase.'}}
];

var CTXS=[
  {id:'home',ic:'üè†',label:'At home'},
  {id:'office',ic:'üè¢',label:'At office'},
  {id:'gym',ic:'üí™',label:'At gym'},
  {id:'commute',ic:'üöó',label:'Commuting'},
  {id:'outdoors',ic:'üå≥',label:'Outdoors'},
  {id:'cafe',ic:'‚òï',label:'Caf√©/public'}
];

var CTX_MODS={
  home:{boost:['meditation','sleep_prep','creative'],hinder:[],tips:['Control your light environment ‚Äî this is your biggest circadian lever at home','Set a \"screens off\" alarm 60 min before target bedtime']},
  office:{boost:['deep_work','meeting','planning'],hinder:['sleep_prep','meditation'],tips:['If in Focus phase, put on headphones ‚Äî even without music, it signals \"do not disturb\"','Request walking meetings during Reflection phase ‚Äî it\'s biology, not laziness']},
  gym:{boost:['exercise'],hinder:['deep_work','meeting'],tips:['Train compound movements first while neural drive is highest','If in Renewal phase, push hard ‚Äî you\'re in your biological performance peak']},
  commute:{boost:['learning','planning','meditation'],hinder:['deep_work','exercise','creative'],tips:['Use commute for podcast/audiobook learning ‚Äî hippocampal encoding still works through audio','Practice box breathing (4-4-4-4) to shift from sympathetic to parasympathetic before arriving']},
  outdoors:{boost:['exercise','social','creative'],hinder:['deep_work'],tips:['Morning outdoor light (>10,000 lux) is the single most powerful circadian signal ‚Äî 10 min resets your clock','If it\'s evening, the sunset spectrum helps trigger melatonin onset naturally']},
  cafe:{boost:['creative','learning','planning'],hinder:['deep_work','meditation'],tips:['Moderate ambient noise (~70 dB) actually enhances creative cognition (Mehta 2012)','If in Focus phase, use noise-canceling ‚Äî caf√© noise helps creativity but hurts analysis']}
};

var off=0, wakeH=7, selAct=null, selCtx=null;

// Build activity & context pills
function buildPills(){
  var ap=document.getElementById('act-pills'),cp=document.getElementById('ctx-pills');
  ap.innerHTML=ACTS.map(function(a){return '<div class="al-pill" data-act="'+a.id+'"><span class="al-pill-ic">'+a.ic+'</span>'+a.label+'</div>'}).join('');
  cp.innerHTML=CTXS.map(function(c){return '<div class="al-pill" data-ctx="'+c.id+'"><span class="al-pill-ic">'+c.ic+'</span>'+c.label+'</div>'}).join('');
  ap.querySelectorAll('.al-pill').forEach(function(p){p.addEventListener('click',function(){
    ap.querySelectorAll('.al-pill').forEach(function(x){x.classList.remove('sel')});p.classList.add('sel');selAct=p.dataset.act;renderAlign();})});
  cp.querySelectorAll('.al-pill').forEach(function(p){p.addEventListener('click',function(){
    cp.querySelectorAll('.al-pill').forEach(function(x){x.classList.remove('sel')});p.classList.add('sel');selCtx=p.dataset.ctx;renderAlign();})});
}

function adjWake(min){wakeH=Math.max(4,Math.min(12,wakeH+min/60));
  var hh=Math.floor(wakeH),mm=Math.round((wakeH-hh)*60);
  document.getElementById('aw-time').textContent=hh.toString().padStart(2,'0')+':'+mm.toString().padStart(2,'0');
  // Compute offset: model default wake ~07:00 (start of phase 3 energy rise)
  off=wakeH-7;
  document.getElementById('aw-info').textContent='Clock shifted '+(off>=0?'+':'')+off.toFixed(1)+'h from default. All 9 phase boundaries adjusted to your wake time.';
  renderAlign();
}

function getCur(){
  var now=new Date(),sec=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();
  var shifted=(sec-off*3600+86400)%86400,curDeg=(shifted/86400)*360;
  var times=MT.map(function(t){return(t+off)%T}),cur=0;
  for(var i=0;i<9;i++){var sT=times[i],eT=times[(i+1)%9],sD=(sT/T)*360,eD=(eT/T)*360;if(eT>sT?curDeg>=sD&&curDeg<eD:curDeg>=sD||curDeg<eD)cur=i}
  return cur;
}

function renderAlign(){
  if(!selAct){document.getElementById('al-result').innerHTML='<div style="text-align:center;color:var(--text3);padding:20px 0">Select an activity to see your alignment</div>';document.getElementById('al-next').style.display='none';return;}
  var cur=getCur(),ph=PH[cur],act=ACTS.find(function(a){return a.id===selAct});
  var score=act.align[cur];
  var grade=score>=80?'perfect':score>=50?'good':score>=25?'misaligned':'bad';
  var gradeLabel=score>=80?'In the zone':score>=50?'Good window':score>=25?'Suboptimal':'Against the grain';
  var gradeCol=score>=80?'var(--mint)':score>=50?'var(--gold)':score>=25?'var(--rose)':'#ff5555';

  // Build score ring
  var rc=document.createElement('canvas');rc.width=160;rc.height=160;rc.style.width='80px';rc.style.height='80px';rc.className='al-score-ring';
  var rx=rc.getContext('2d');rx.scale(2,2);
  rx.beginPath();rx.arc(40,40,32,0,PI2);rx.strokeStyle='rgba(255,255,255,.06)';rx.lineWidth=6;rx.stroke();
  rx.beginPath();rx.arc(40,40,32,-Math.PI/2,-Math.PI/2+PI2*(score/100));
  rx.strokeStyle=score>=80?'#5cc4a0':score>=50?'#d4a84b':score>=25?'#e05a7a':'#ff5555';
  rx.lineWidth=6;rx.lineCap='round';rx.stroke();
  rx.fillStyle='#eae6dc';rx.font="600 20px 'Outfit'";rx.textAlign='center';rx.textBaseline='middle';rx.fillText(score+'%',40,36);
  rx.fillStyle='#9a9488';rx.font="300 8px 'Outfit'";rx.fillText('aligned',40,50);

  var h='<div class="al-score-row"><div id="al-ring"></div><div class="al-score-info"><div class="al-score-title" style="color:'+gradeCol+'">'+act.ic+' '+act.label+' ‚Äî '+gradeLabel+'</div><div class="al-score-sub">'+ph.ic+' <strong>'+ph.n+'</strong> phase ¬∑ '+act.science[score>=50?'best':'worst']+'</div></div></div>';

  h+='<div class="al-verdict"><div class="al-verdict-lbl" style="color:'+gradeCol+'">'+gradeLabel+'</div><div class="al-verdict-txt">'+act.adapt[grade]+'</div></div>';

  // Context tips
  if(selCtx){
    var ctx=CTX_MODS[selCtx];
    var boosted=ctx.boost.indexOf(selAct)>=0;
    var hindered=ctx.hinder.indexOf(selAct)>=0;
    h+='<div class="al-verdict"><div class="al-verdict-lbl" style="color:'+(boosted?'var(--mint)':hindered?'var(--rose)':'var(--gold)')+'">'+CTXS.find(function(c){return c.id===selCtx}).ic+' '+(boosted?'Environment supports this':hindered?'Environment works against this':'Neutral environment')+'</div>';
    h+='<div class="al-tips">';
    ctx.tips.forEach(function(tip){h+='<div class="al-tip"><div class="al-tip-ic">üí°</div><div class="al-tip-content"><div class="al-tip-w">'+tip+'</div></div></div>'});
    h+='</div></div>';
  }

  // What to do right now ‚Äî always show top 3 aligned activities for this phase
  h+='<div class="al-verdict"><div class="al-verdict-lbl" style="color:var(--mint)">Best activities for '+ph.n+' phase</div><div class="al-tips">';
  var ranked=ACTS.slice().sort(function(a,b){return b.align[cur]-a.align[cur]}).slice(0,3);
  ranked.forEach(function(a){h+='<div class="al-tip"><div class="al-tip-ic">'+a.ic+'</div><div class="al-tip-content"><div class="al-tip-t">'+a.label+' ‚Äî '+a.align[cur]+'% aligned</div><div class="al-tip-w">'+a.adapt[a.align[cur]>=80?'perfect':a.align[cur]>=50?'good':'misaligned']+'</div></div></div>'});
  h+='</div></div>';

  document.getElementById('al-result').innerHTML=h;
  document.getElementById('al-result').querySelector('#al-ring')||0;
  // Insert canvas
  var ringSlot=document.querySelector('.al-score-row');
  if(ringSlot){ringSlot.insertBefore(rc,ringSlot.firstChild)}

  // Up next card
  var ni=(cur+1)%9,times=MT.map(function(t){return(t+off)%T});
  var nextBest=ACTS.slice().sort(function(a,b){return b.align[ni]-a.align[ni]})[0];
  document.getElementById('al-next').style.display='flex';
  document.getElementById('al-next').innerHTML='<div class="al-next-bar" style="background:'+COL[ni]+'"></div><div class="al-next-content"><div class="al-next-lbl">Coming up ¬∑ '+PH[ni].n+'</div><div class="al-next-name">Best activity: '+nextBest.ic+' '+nextBest.label+' ('+nextBest.align[ni]+'%)</div><div class="al-next-sub">Switch at '+fm(times[ni])+'</div></div><div class="al-next-time">'+fm(times[ni])+'</div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.nb').forEach(function(b){b.addEventListener('click',function(){
  var v=b.dataset.v;
  document.querySelectorAll('.vw').forEach(function(el){el.classList.remove('on')});
  document.querySelectorAll('.nb').forEach(function(x){x.classList.remove('on')});
  document.getElementById('v-'+v).classList.add('on');b.classList.add('on');
  if(v==='s')buildS();if(v==='i')drawI();if(v==='a')renderAlign();
})});

function setA(i){document.getElementById('o1').style.background=BG[i][0];document.getElementById('o2').style.background=BG[i][1];document.getElementById('o3').style.background=BG[i][2]}

var cEl=document.getElementById('cc'),cCtx=cEl.getContext('2d');
function drawC(){
  var dpr=window.devicePixelRatio||1,pw=cEl.parentElement?cEl.parentElement.offsetWidth:300,sz=Math.min(pw||300,320);
  if(sz<20)return;cEl.style.width=sz+'px';cEl.style.height=sz+'px';cEl.width=sz*dpr;cEl.height=sz*dpr;
  var ctx=cCtx;ctx.scale(dpr,dpr);var W=sz,cx=W/2,cy=W/2,R=Math.max(W/2-26,30);
  ctx.clearRect(0,0,W,W);var now=new Date(),sec=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();
  var shifted=(sec-off*3600+86400)%86400,curDeg=(shifted/86400)*360,curRad=(curDeg-90)*Math.PI/180;
  var times=MT.map(function(t){return(t+off)%T}),tR=function(h){return(h/T)*PI2-Math.PI/2};var cur=0;
  for(var i=0;i<9;i++){var sT=times[i],eT=times[(i+1)%9],sR=tR(sT),eR=tR(eT);if(eR<=sR)eR+=PI2;
  var sD=(sT/T)*360,eD=(eT/T)*360;var inP=eT>sT?(curDeg>=sD&&curDeg<eD):(curDeg>=sD||curDeg<eD);if(inP)cur=i;
  ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,R,sR,eR);ctx.closePath();ctx.fillStyle=COL[i]+(inP?'47':'14');ctx.fill();
  ctx.beginPath();ctx.arc(cx,cy,R,sR,eR);ctx.strokeStyle=COL[i]+(inP?'bb':'33');ctx.lineWidth=inP?3.5:1.2;ctx.stroke();
  var mid=(sR+eR)/2,ir=R-16;ctx.font=(inP?'13px':'10px')+' sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.globalAlpha=inP?1:.6;
  ctx.fillText(PH[i].ic,cx+ir*Math.cos(mid),cy+ir*Math.sin(mid));ctx.globalAlpha=1;
  ctx.beginPath();ctx.moveTo(cx+(R-5)*Math.cos(sR),cy+(R-5)*Math.sin(sR));ctx.lineTo(cx+(R+3)*Math.cos(sR),cy+(R+3)*Math.sin(sR));ctx.strokeStyle='rgba(212,168,75,.25)';ctx.lineWidth=1;ctx.stroke();}
  for(var h=0;h<24;h++){var r=(h/24*360-90)*Math.PI/180,r1=R+7,r2=R+(h%6===0?16:h%3===0?12:9);ctx.beginPath();ctx.moveTo(cx+r1*Math.cos(r),cy+r1*Math.sin(r));ctx.lineTo(cx+r2*Math.cos(r),cy+r2*Math.sin(r));ctx.strokeStyle=h%6===0?'rgba(212,168,75,.5)':'rgba(212,168,75,.12)';ctx.lineWidth=h%6===0?1.5:.7;ctx.stroke();
  if(h%6===0){ctx.fillStyle='rgba(212,168,75,.45)';ctx.font="500 8px 'JetBrains Mono'";ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(h.toString().padStart(2,'0'),cx+(R+22)*Math.cos(r),cy+(R+22)*Math.sin(r))}}
  var hx=cx+(R-6)*Math.cos(curRad),hy=cy+(R-6)*Math.sin(curRad);ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(hx,hy);ctx.strokeStyle='rgba(255,255,255,.85)';ctx.lineWidth=1.5;ctx.stroke();
  ctx.beginPath();ctx.arc(hx,hy,4,0,PI2);ctx.fillStyle='rgba(255,255,255,.6)';ctx.fill();ctx.beginPath();ctx.arc(cx,cy,4,0,PI2);ctx.fillStyle=COL[cur];ctx.fill();
  var ts=now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0');ctx.fillStyle='rgba(255,255,255,.8)';ctx.font="500 15px 'JetBrains Mono'";ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(ts,cx,cy+28);
  updH(cur,times,curDeg,now);setA(cur);
}

function fm(h){h=(h+24)%24;return Math.floor(h).toString().padStart(2,'0')+':'+Math.round((h%1)*60).toString().padStart(2,'0')}

function updH(idx,times,curDeg,now){
  var ph=PH[idx],col=COL[idx],sT=times[idx],eT=times[(idx+1)%9];
  var sD=(sT/T)*360,eD=(eT/T)*360;if(eD<=sD)eD+=360;var cd=curDeg;if(cd<sD)cd+=360;
  var pct=Math.min(100,Math.max(0,(cd-sD)/(eD-sD)*100)),totalDur=eT>sT?eT-sT:24-sT+eT,remMin=Math.max(0,Math.round(totalDur*(1-pct/100)*60));
  var remStr=remMin>=60?Math.floor(remMin/60)+'h '+remMin%60+'m left':remMin+'m left';
  document.getElementById('hb').textContent='Phase '+(idx+1)+' of 9';document.getElementById('hcd').textContent=remStr;document.getElementById('hi').textContent=ph.ic;
  document.getElementById('hn').textContent=ph.n;document.getElementById('hn').style.color=col;document.getElementById('hw').textContent=fm(sT)+' ‚Üí '+fm(eT);
  document.getElementById('hp').style.width=pct+'%';document.getElementById('hp').style.background=col;document.getElementById('hbt').innerHTML=ph.bite;
  document.getElementById('hero').style.background='linear-gradient(135deg,'+col+'12,'+col+'06)';
  var bsH='',keys=Object.keys(ph.st);for(var i=0;i<keys.length;i++){var k=keys[i],v=ph.st[k];bsH+='<div class="bsr"><div class="bsl">'+k+'</div><div class="bst"><div class="bsf" style="width:'+v+'%;background:'+stCols[k]+'"></div></div><div class="bsv">'+v+'%</div></div>'}
  document.getElementById('hbs').innerHTML=bsH;
  document.getElementById('ha').innerHTML=ph.tips.map(function(t){return'<div class="gs ac"><div class="ac-i">'+t.i+'</div><div class="ac-t">'+t.t+'</div><div class="ac-w">'+t.w+'</div></div>'}).join('');
  var ni=(idx+1)%9;document.getElementById('hun').innerHTML='<div class="unb" style="background:'+COL[ni]+'"></div><div class="unc"><div class="unl">Up next</div><div class="unn">'+PH[ni].ic+' '+PH[ni].n+'</div></div><div class="unt">'+fm(times[ni])+'</div>';
  document.getElementById('tm').textContent=now.toLocaleTimeString('en-US',{hour12:false,hour:'2-digit',minute:'2-digit',second:'2-digit'});
  var h=now.getHours();document.getElementById('gr').textContent=h<5?'Good night':h<12?'Good morning':h<17?'Good afternoon':'Good evening';
}

function buildS(){
  var times=MT.map(function(t){return(t+off)%T}),now=new Date();var sec=now.getHours()*3600+now.getMinutes()*60+now.getSeconds(),shifted=(sec-off*3600+86400)%86400,curDeg=(shifted/86400)*360;
  var h='';for(var i=0;i<9;i++){var sT=times[i],eT=times[(i+1)%9],sD=(sT/T)*360,eD=(eT/T)*360;var inP=eT>sT?(curDeg>=sD&&curDeg<eD):(curDeg>=sD||curDeg<eD);
  var dur=eT>sT?eT-sT:24-sT+eT,ds=dur>=1?Math.floor(dur)+'h '+Math.round((dur%1)*60)+'m':Math.round(dur*60)+'m';var ph=PH[i];
  h+='<div class="tl '+(inP?'nw':'')+'"><div class="tll"><div class="tlt">'+fm(sT)+'</div><div class="tld">'+ds+'</div></div><div class="tlb" style="background:'+COL[i]+'"></div><div class="tlr"><div class="tln" style="'+(inP?'color:var(--gold)':'')+'">'+ph.ic+' '+ph.n+(inP?'<span class="tlp">NOW</span>':'')+'</div><div class="tlbi">'+ph.bite.replace(/<\/?strong>/g,'')+'</div><div class="tlch">'+ph.tips.map(function(t){return'<span class="tlc">'+t.i+' '+t.t+'</span>'}).join('')+'</div></div></div>';}
  document.getElementById('sl').innerHTML=h;
}

function drawI(){
  var cur=getCur(),ph=PH[cur],now=new Date();
  var rn='<div class="rnt">'+ph.ic+' '+ph.n+' ‚Äî Your Body Right Now</div><div class="rnm">';
  var keys=Object.keys(ph.st);for(var i=0;i<keys.length;i++){var k=keys[i],v=ph.st[k];rn+='<div class="rnmr"><div class="rnml">'+k+'</div><div class="rnmt"><div class="rnmf" style="width:'+v+'%;background:'+stCols[k]+'"></div></div><div class="rnmv">'+v+'%</div></div>'}
  rn+='</div><div class="opt"><div class="optl optg">‚úì Optimal right now</div><div class="opti">'+ph.best.map(function(b){return'<span class="optgt">'+b+'</span>'}).join('')+'</div><div class="optl optr">‚úó Avoid right now</div><div class="opti">'+ph.avoid.map(function(b){return'<span class="optrt">'+b+'</span>'}).join('')+'</div></div>';
  document.getElementById('rn').innerHTML=rn;

  var rc=document.createElement('canvas');rc.width=200;rc.height=200;rc.style.width='100px';rc.style.height='100px';
  var rx=rc.getContext('2d');rx.scale(2,2);rx.beginPath();rx.arc(50,50,38,0,PI2);rx.strokeStyle='rgba(255,255,255,.06)';rx.lineWidth=8;rx.stroke();
  var score=Math.round(R2_V*100);rx.beginPath();rx.arc(50,50,38,-Math.PI/2,-Math.PI/2+PI2*(score/100));rx.strokeStyle='#5cc4a0';rx.lineWidth=8;rx.lineCap='round';rx.stroke();
  rx.fillStyle='#eae6dc';rx.font="600 22px 'Outfit'";rx.textAlign='center';rx.textBaseline='middle';rx.fillText(score+'%',50,46);rx.fillStyle='#9a9488';rx.font="300 9px 'Outfit'";rx.fillText('match',50,62);
  document.getElementById('sring').innerHTML='';document.getElementById('sring').appendChild(rc);
  document.getElementById('sring').insertAdjacentHTML('beforeend','<div class="sring-info"><div class="sring-val">Model predicts with <strong>'+MAE_V.toFixed(1)+'¬∞ mean error</strong> ‚Äî less than 2% of full circle. <strong>'+mtch+'/9</strong> phases within 5¬∞.</div></div>');

  var pdH='';for(i=0;i<9;i++){var diff=Math.abs(MA[i]-AW[i]),cls=diff<=5?'pdot-ok':diff<=15?'pdot-mid':'pdot-off';
  pdH+='<div class="pdot"><div class="pdot-n">'+(i+1)+'</div><div class="pdot-sw" style="background:'+COL[i]+'"></div><div class="pdot-wrap"><div class="pdot-m" style="left:0;width:'+MA[i]/360*100+'%;background:'+COL[i]+'"></div><div class="pdot-a" style="left:calc('+AW[i]/360*100+'% - 3px)"></div></div><div class="pdot-d '+cls+'">'+diff.toFixed(1)+'¬∞</div></div>'}
  document.getElementById('pd').innerHTML=pdH;

  var canvas=document.getElementById('ich'),dpr=window.devicePixelRatio||1,W=canvas.parentElement.offsetWidth-40;if(W<20)return;
  canvas.style.width=W+'px';canvas.style.height='170px';canvas.width=W*dpr;canvas.height=170*dpr;
  var ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);var H=170,cW=W-12,cH=H-32;
  function toX(t){return 6+(t/T)*cW}function toY(v){return 10+(1-(v+1)/2)*cH}
  ctx.clearRect(0,0,W,H);ctx.beginPath();ctx.moveTo(6,toY(0));ctx.lineTo(6+cW,toY(0));ctx.strokeStyle='rgba(212,168,75,.1)';ctx.lineWidth=1;ctx.stroke();
  MT.forEach(function(t){var x=toX((t+off)%T);ctx.beginPath();ctx.moveTo(x,10);ctx.lineTo(x,10+cH);ctx.strokeStyle='rgba(212,168,75,.15)';ctx.lineWidth=1;ctx.setLineDash([2,3]);ctx.stroke();ctx.setLineDash([])});
  var nowH=now.getHours()+now.getMinutes()/60,nx=toX(nowH);ctx.beginPath();ctx.moveTo(nx,10);ctx.lineTo(nx,10+cH);ctx.strokeStyle='rgba(255,255,255,.3)';ctx.lineWidth=1.5;ctx.stroke();ctx.fillStyle='#fff';ctx.font="bold 8px 'JetBrains Mono'";ctx.textAlign='center';ctx.fillText('NOW',nx,8);
  var N=500;[[cN,'#f0922a',.4,1.2],[tN,'#3ec8c0',.4,1.2],[mN,'#8b6fe0',.4,1.2],[F,'#d4a84b',1,2.5]].forEach(function(arr){ctx.beginPath();for(var j=0;j<=N;j++){var t=j*T/N,x=toX(t),y=toY(arr[0](t));j===0?ctx.moveTo(x,y):ctx.lineTo(x,y)}ctx.strokeStyle=arr[1];ctx.globalAlpha=arr[2];ctx.lineWidth=arr[3];ctx.stroke();ctx.globalAlpha=1});
  ctx.beginPath();for(var j=0;j<=N;j++){var t=j*T/N,x=toX(t),y=toY(F(t));j===0?ctx.moveTo(x,y):ctx.lineTo(x,y)}
  ctx.lineTo(toX(T),10+cH);ctx.lineTo(6,10+cH);ctx.closePath();var gf=ctx.createLinearGradient(0,10,0,10+cH);gf.addColorStop(0,'rgba(212,168,75,.06)');gf.addColorStop(1,'transparent');ctx.fillStyle=gf;ctx.fill();
  [0,6,12,18].forEach(function(h){ctx.fillStyle='rgba(212,168,75,.3)';ctx.font="8px 'JetBrains Mono'";ctx.textAlign='center';ctx.fillText(h+'h',toX(h),H-4)});
}

function tick(){drawC();requestAnimationFrame(tick)}
window.addEventListener('load',function(){buildPills();tick();buildS();setInterval(buildS,6e4);setInterval(renderAlign,6e4)});
window.addEventListener('resize',drawC);
</script>
</body>
</html>
