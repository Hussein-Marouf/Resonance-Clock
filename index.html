<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Resonance</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#010103">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.4/Recharts.min.js"></script>

<style>
*,*::before,*::after{box-sizing:border-box;-webkit-font-smoothing:antialiased}
html,body{margin:0;padding:0;background:#010103;overflow-x:hidden;-webkit-overflow-scrolling:touch}
#root{min-height:100vh}
::-webkit-scrollbar{width:2px}::-webkit-scrollbar-thumb{background:#0a2a25}
button{cursor:pointer;font-family:'Chakra Petch',sans-serif;border:none;background:none;color:#c8e8e2;-webkit-tap-highlight-color:transparent}
textarea,input{font-family:'Chakra Petch',sans-serif}
@keyframes rise{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:none}}
@keyframes slideUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:none}}
@keyframes saveFlash{0%{background:rgba(0,255,200,0.28)}100%{background:rgba(0,255,200,0.06)}}
@keyframes urgentPulse{0%,100%{opacity:1}50%{opacity:0.35}}
.rise{animation:rise .32s cubic-bezier(0.16,1,0.3,1) both}
.slide-up{animation:slideUp .38s cubic-bezier(0.16,1,0.3,1) both}
.save-flash{animation:saveFlash 0.7s ease both}
.urgent{animation:urgentPulse 1.2s ease infinite}
.pcolor{transition:color 2.5s ease}
.pbg{transition:background 2.5s ease,border-color 2.5s ease,box-shadow 2.5s ease}
.chip{padding:6px 11px;border-radius:2px;font-size:10px;font-family:'Chakra Petch',sans-serif;font-weight:500;letter-spacing:0.08em;transition:all .18s;cursor:pointer;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)}
.pbar{height:2px;background:rgba(0,255,200,0.08);border-radius:0}
.pbar-fill{height:100%;border-radius:0;transition:width .9s linear}
.step-btn{width:48px;height:48px;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:300;border:1px solid rgba(0,255,200,0.15);background:rgba(0,255,200,0.05);border-radius:2px;color:#00FFD1;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%);transition:all .15s;touch-action:manipulation}
.step-btn:active{transform:scale(0.9)}
.nav{display:flex;border-top:1px solid rgba(0,255,200,0.1);padding:0 0 env(safe-area-inset-bottom);background:rgba(1,1,3,0.96);backdrop-filter:blur(20px);position:fixed;bottom:0;left:0;right:0;max-width:480px;margin:0 auto;z-index:90}
.nav-btn{flex:1;padding:12px 0 10px;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:9px;letter-spacing:0.12em;text-transform:uppercase;font-family:'Chakra Petch',sans-serif;font-weight:500;color:rgba(0,255,200,0.28);border-bottom:2px solid transparent;transition:all .2s;min-height:48px;touch-action:manipulation}
.nav-btn.active{color:#00FFD1;border-bottom-color:#00FFD1}
.nav-icon{font-size:18px;line-height:1}
.lbl{font-size:10px;font-weight:600;letter-spacing:0.2em;font-family:'Chakra Petch',sans-serif;color:rgba(0,255,200,0.3);margin-bottom:10px;display:block;text-transform:uppercase}
.sci-table{width:100%;border-collapse:collapse;font-family:'Share Tech Mono',monospace;font-size:11px}
.sci-table th{text-align:left;padding:6px 8px;color:rgba(0,255,200,0.3);font-size:9px;letter-spacing:0.15em;border-bottom:1px solid rgba(0,255,200,0.1);font-family:'Chakra Petch',sans-serif}
.sci-table td{padding:8px;border-bottom:1px solid rgba(0,255,200,0.04)}
.sci-table tr:nth-child(even) td{background:rgba(0,255,200,0.02)}
.wake-input{background:rgba(0,255,200,0.04);border:1px solid rgba(0,255,200,0.35);color:#00FFD1;font-size:22px;font-family:'Share Tech Mono',monospace;text-align:center;width:104px;padding:4px 6px;outline:none;display:block;margin:0 auto;-webkit-appearance:none}
.acts-rest{overflow:hidden;transition:max-height 0.4s cubic-bezier(0.16,1,0.3,1),opacity 0.3s ease}
.acts-rest.open{max-height:900px;opacity:1}
.acts-rest.closed{max-height:0;opacity:0}
.ring{transition:stroke-dashoffset 1.2s cubic-bezier(0.16,1,0.3,1)}
</style>

</head>
<body>
<div id="root"></div>
<script>
(function(){
'use strict';

var h=React.createElement;
var useState=React.useState,useEffect=React.useEffect,useMemo=React.useMemo,useCallback=React.useCallback;
var RC=Recharts;

// ═══════════════════════════════════════════════════
// PHASE DATA
// ═══════════════════════════════════════════════════
var PHASES=[
{id:1,name:“Deep Rest”,sym:”\u{1F319}”,start:0,end:4.27,color:”#818cf8”,glo:“rgba(129,140,248,0.6)”,
desc:“Melatonin dominant \u2014 neural restoration & memory consolidation”,
sci:“Melatonin at peak concentration. Glymphatic clearance of metabolic waste peaks during slow-wave sleep. Growth hormone secretion in first 90-min cycle. Hippocampal replay consolidates declarative memories.”,
best:[“Sleep”,“Rest”],avoid:[“Light”,“Stimulants”]},
{id:2,name:“Pre-Dawn”,sym:”\u2728”,start:4.27,end:6.83,color:”#a78bfa”,glo:“rgba(167,139,250,0.6)”,
desc:“Cortisol begins its asymmetric rise toward waking”,
sci:“Cortisol secretory bursts increase in amplitude (Veldhuis 1989). HPA axis pre-awakening activation. Core temperature at nadir begins slow ascent. REM sleep predominates in final cycles.”,
best:[“Sleep”,“Light stretching”],avoid:[“Alarm disruption of REM”]},
{id:3,name:“Awakening”,sym:”\u{1F305}”,start:6.83,end:9.10,color:”#fb923c”,glo:“rgba(251,146,60,0.6)”,
desc:“Cortisol Awakening Response \u2014 system activation”,
sci:“CAR: cortisol doubles within 30\u201345 min of waking (Weitzman 1971, Debono 2009). Blood pressure and heart rate rise sharply. Delay caffeine 90\u2013120 min to preserve natural CAR amplitude.”,
best:[“Sunlight”,“Planning”,“Light exercise”],avoid:[“Caffeine early”,“Screens”]},
{id:4,name:“Peak Focus”,sym:”\u26A1”,start:9.10,end:10.93,color:”#f87171”,glo:“rgba(248,113,113,0.65)”,
desc:“Cortisol apex \u2014 maximum analytical capacity”,
sci:“Cortisol and norepinephrine near daily maximum. Prefrontal cortex activation peaks. Working memory, reaction time, and executive function are optimal (Van Cauter 1999). Guard this window fiercely.”,
best:[“Deep work”,“Complex decisions”,“Hard learning”],avoid:[“Meetings”,“Email”,“Multitasking”]},
{id:5,name:“Sustain”,sym:”\u{1F3AF}”,start:10.93,end:13.30,color:”#34d399”,glo:“rgba(52,211,153,0.6)”,
desc:“Elevated performance plateau with gradual decline”,
sci:“Cortisol still above baseline. Dopamine supports sustained attention. Serotonin rising supports empathy and collaboration. Best for structured work needing focus and flexibility.”,
best:[“Collaboration”,“Writing”,“Learning”],avoid:[“Passive consumption”]},
{id:6,name:“Integration”,sym:”\u{1F517}”,start:13.30,end:14.98,color:”#22d3ee”,glo:“rgba(34,211,238,0.6)”,
desc:“Post-lunch dip \u2014 physiological, not a failure”,
sci:“Circadian F(t) reaches afternoon trough. Post-prandial blood glucose shift. Adenosine accumulation since waking. The post-lunch dip is endogenous. Brief rest or social activity optimal.”,
best:[“Lunch”,“Social”,“Power nap”],avoid:[“Critical decisions”,“Complex analysis”]},
{id:7,name:“Creative”,sym:”\u{1F3A8}”,start:14.98,end:17.84,color:”#c084fc”,glo:“rgba(192,132,252,0.6)”,
desc:“Reduced inhibition + temperature peak \u2192 creative-physical window”,
sci:“Prefrontal inhibition slightly reduced \u2192 divergent thinking (Wieth & Zacks 2011). Core temperature approaching peak (Refinetti 2010). Muscle strength and VO2 max rising. Dual window: create or train.”,
best:[“Brainstorming”,“Art”,“Exercise”,“Sport”],avoid:[“Rigid analytical work”]},
{id:8,name:“Wind Down”,sym:”\u{1F306}”,start:17.84,end:21.75,color:”#f472b6”,glo:“rgba(244,114,182,0.6)”,
desc:“Parasympathetic shift \u2014 melatonin synthesis begins”,
sci:“Core temperature falling from peak. Serotonin\u2192melatonin conversion in pineal gland. DLMO ~21:00 (Lewy 1999). Individual DLMO varies \u00B190 min (Burgess 2008). Blue light at 480nm suppresses melatonin by up to 50%.”,
best:[“Light social”,“Cooking”,“Reflection”,“Reading”],avoid:[“Intense exercise”,“Blue light”,“News”]},
{id:9,name:“Sleep Gate”,sym:”\u{1F30C}”,start:21.75,end:24.0,color:”#60a5fa”,glo:“rgba(96,165,250,0.6)”,
desc:“Melatonin rising \u2014 sleep architecture initiating”,
sci:“Melatonin secretion accelerating. Core temperature continues dropping toward nadir. Cortisol at daily minimum. Protect this window: light, alcohol, and stimulants all delay sleep onset.”,
best:[“Meditation”,“Journaling”,“Dim environment”],avoid:[“Screens”,“Caffeine”,“Alcohol”]}
];

// Activity alignment arrays — heuristically tuned to F(t) phase profile
var ACTS=[
{name:“Deep Work”,icon:”\u{1F4A1}”,shape:”\u25CF”,align:[0,10,70,95,80,15,25,10,0],
adapt:{high:“Prefrontal cortex at peak capacity. Block all notifications. Use 90-min ultradian cycles.”,mid:“Cortisol supports focus. Front-load the hardest sub-tasks.”,low:“Brain in diffuse mode. Switch to creative tasks or defer.”}},
{name:“Exercise”,icon:”\u{1F3CB}\uFE0F”,shape:”\u25A0”,align:[0,15,45,25,30,20,90,35,0],
adapt:{high:“Core temp peaks, strength +6%, perceived exertion \u221210%. Train compound lifts.”,mid:“Good window. HIIT and moderate strength both effective.”,low:“Recovery mode. Light stretching or gentle walking only.”}},
{name:“Creative”,icon:”\u{1F3A8}”,shape:”\u25C6”,align:[10,15,30,40,45,50,90,40,15],
adapt:{high:“Inner critic quiet, associative networks open. Sketch, brainstorm, freewrite.”,mid:“Moderate alertness + relaxed control. Good for novel connections.”,low:“Too sharp or too foggy. Capture loose thoughts for later.”}},
{name:“Meetings”,icon:”\u{1F465}”,shape:”\u25CF”,align:[0,10,35,50,75,80,55,40,0],
adapt:{high:“Social cognition sharp. Schedule negotiations and key discussions.”,mid:“Engaged and articulate. Good for collaborative sessions.”,low:“Low social energy. Keep it brief and structured.”}},
{name:“Learning”,icon:”\u{1F4DA}”,shape:”\u25A0”,align:[5,15,55,90,75,30,40,20,5],
adapt:{high:“Hippocampus primed for encoding. Active recall builds strongest traces.”,mid:“Mix reading with practice. Moderate complexity works.”,low:“Review and spaced repetition instead of new material.”}},
{name:“Rest”,icon:”\u{1F634}”,shape:”\u25C6”,align:[95,80,10,0,5,20,5,55,90],
adapt:{high:“Biology supports deep restoration. Protect sleep architecture.”,mid:“Short rest can help. Keep naps under 20 min.”,low:“Body optimized for activity. Resting wastes peak neurochemistry.”}},
{name:“Social”,icon:”\u{1F91D}”,shape:”\u25CF”,align:[5,10,25,15,60,80,55,75,20],
adapt:{high:“Oxytocin and warmth peak. Connection feels natural.”,mid:“Good social energy. Present and engaged.”,low:“Social battery low. Brief meaningful interactions.”}},
{name:“Planning”,icon:”\u{1F4CB}”,shape:”\u25A0”,align:[5,30,80,70,55,25,35,20,10],
adapt:{high:“Executive function aligned. Map your week, set priorities.”,mid:“Enough prefrontal capacity for organization.”,low:“Stick to tactical to-do lists. Defer strategy.”}},
{name:“Meditation”,icon:”\u{1F9D8}”,shape:”\u25C6”,align:[80,60,25,10,15,30,20,65,90],
adapt:{high:“Parasympathetic ascending. Deep practice effortless.”,mid:“Mind may wander. Body-scan and breath focus work.”,low:“Sympathetic active. Walking meditation or breathwork.”}},
{name:“Sport”,icon:”\u26BD”,shape:”\u25A0”,align:[0,15,40,30,35,25,95,30,0],
adapt:{high:“Neuromuscular coordination, reaction time, VO2 max peak.”,mid:“Warm up thoroughly. Moderate intensity.”,low:“Suboptimal. Stick to light movement or skill work.”}}
];

var CTXS=[
{id:“home”,icon:”\u{1F3E0}”,label:“Home”,boost:[“Meditation”,“Rest”,“Creative”]},
{id:“office”,icon:”\u{1F3E2}”,label:“Office”,boost:[“Deep Work”,“Meetings”,“Planning”]},
{id:“gym”,icon:”\u{1F4AA}”,label:“Gym”,boost:[“Exercise”,“Sport”]},
{id:“commute”,icon:”\u{1F697}”,label:“Commute”,boost:[“Learning”,“Planning”,“Meditation”]},
{id:“outdoors”,icon:”\u{1F333}”,label:“Outside”,boost:[“Exercise”,“Social”,“Creative”]},
{id:“cafe”,icon:”\u2615”,label:“Caf\u00E9”,boost:[“Creative”,“Learning”,“Planning”]}
];

// ═══════════════════════════════════════════════════
// ASYMMETRIC FOURIER MODELS — H.A. Marouf (2024)
// Uncoupled phase angles per harmonic capture cortisol’s
// 4:1 rise:decay asymmetry (CAR — Weitzman 1971, Debono 2009)
// ═══════════════════════════════════════════════════
function clamp(v){return Math.max(0.02,Math.min(0.98,v));}
function cortisol(t){return clamp(0.3118+0.3528*Math.cos(2*Math.PI*(t-10.48)/24)+0.1596*Math.cos(2*Math.PI*2*(t-8.99)/24)+0.0709*Math.cos(2*Math.PI*3*(t-8.43)/24)+0.0320*Math.cos(2*Math.PI*4*(t-8.46)/24));}
function bodyTemp(t){return clamp(0.4806+0.3997*Math.cos(2*Math.PI*(t-16.47)/24)+0.0122*Math.cos(2*Math.PI*2*(t-17.80)/24)+0.0465*Math.cos(2*Math.PI*3*(t-8.68)/24));}
function melatonin(t){return clamp(0.2699+0.4346*Math.cos(2*Math.PI*(t-1.98)/24)+0.2543*Math.cos(2*Math.PI*2*(t-1.95)/24)+0.0755*Math.cos(2*Math.PI*3*(t-1.77)/24));}
function composite(t){return 0.5*cortisol(t)+0.3*bodyTemp(t)+0.2*melatonin(t);}

// Sleep debt modifier — Walker (2017): ~5% cognitive cost per hour below 8h reference
function sdMod(h){return Math.max(0.60,1-0.05*Math.max(0,8-h));}

// ═══════════════════════════════════════════════════
// GEOMETRY — unchanged from v21
// ═══════════════════════════════════════════════════
function hDeg(hr){return(hr/24)*360;}
function toXY(cx,cy,r,deg){var rad=(deg-90)*Math.PI/180;return[cx+r*Math.cos(rad),cy+r*Math.sin(rad)];}
function arcP(cx,cy,r1,r2,h1,h2){
var a1=hDeg(h1),a2=hDeg(Math.min(h2,23.999));
var s1=toXY(cx,cy,r2,a1),s2=toXY(cx,cy,r2,a2),s3=toXY(cx,cy,r1,a2),s4=toXY(cx,cy,r1,a1);
var big=(a2-a1)>180?1:0;
return”M”+s1[0]+”,”+s1[1]+” A”+r2+”,”+r2+” 0 “+big+”,1 “+s2[0]+”,”+s2[1]+” L”+s3[0]+”,”+s3[1]+” A”+r1+”,”+r1+” 0 “+big+”,0 “+s4[0]+”,”+s4[1]+“Z”;
}
function waveP(cx,cy,rMin,rMax,fn){
return Array.from({length:361},function(_,i){
var t=(i/360)*24,r=rMin+(rMax-rMin)*fn(t),xy=toXY(cx,cy,r,(i/360)*360);
return(i===0?“M”:“L”)+xy[0].toFixed(2)+”,”+xy[1].toFixed(2);
}).join(” “)+“Z”;
}

// Total-minutes approach prevents negative/overflow wrapping
function fmtT(hours){
var total=Math.round(hours*60),m=((total%1440)+1440)%1440;
return Math.floor(m/60)+”:”+String(m%60).padStart(2,“0”);
}
function fmtT12(h){
var total=Math.round(h*60),m=((total%1440)+1440)%1440;
var hh=Math.floor(m/60),mm=m%60,ap=hh>=12?“p”:“a”,h12=hh%12||12;
return h12+(mm?”:”+String(mm).padStart(2,“0”):””)+ap;
}
function phaseAt(sh){
for(var i=0;i<PHASES.length;i++){if(sh>=PHASES[i].start&&sh<PHASES[i].end)return PHASES[i];}
return PHASES[0];
}
function sCol(s){return s>=75?”#00FFD1”:s>=40?”#fb923c”:”#f87171”;}
function sLbl(s){return s>=75?“HIGH”:s>=40?“MID”:“LOW”;}

// ═══════════════════════════════════════════════════
// APP
// ═══════════════════════════════════════════════════
function App(){
// ── STATE — all names defined once here, used consistently below ──
var _now=useState(new Date()),now=_now[0],setNow=_now[1];
var _wk=useState(7.0),wk=_wk[0],setWk=_wk[1];
var _sh=useState(8.0),sleepH=_sh[0],setSleepH=_sh[1];
var _tb=useState(“clock”),tab=_tb[0],setTab=_tb[1];
var _sa=useState(null),selA=_sa[0],setSelA=_sa[1];
var _sc=useState(null),selC=_sc[0],setSelC=_sc[1];
var _lg=useState([]),log=_lg[0],setLog=_lg[1];
var _mo=useState(false),modal=_mo[0],setModal=_mo[1];
var _en=useState({energy:3,focus:3,mood:3,note:””}),ent=_en[0],setEnt=_en[1];
var _fl=useState(false),flashSave=_fl[0],setFlashSave=_fl[1];
var _ao=useState(false),actsOpen=_ao[0],setActsOpen=_ao[1];
var _wi=useState(false),wkInput=_wi[0],setWkInput=_wi[1];
var _ws=useState(””),wkStr=_ws[0],setWkStr=_ws[1];
var _ih=useState(null),inspH=_ih[0],setInspH=_ih[1];

// ── EFFECTS ──
useEffect(function(){var t=setInterval(function(){setNow(new Date());},1000);return function(){clearInterval(t);};},[]);
useEffect(function(){
try{var r=localStorage.getItem(“rx23-log”);if(r)setLog(JSON.parse(r));}catch(e){}
try{var w=localStorage.getItem(“rx23-wake”);if(w)setWk(parseFloat(w));}catch(e){}
try{var s=localStorage.getItem(“rx23-sleep”);if(s)setSleepH(parseFloat(s));}catch(e){}
},[]);
useEffect(function(){try{localStorage.setItem(“rx23-wake”,wk);}catch(e){};},[wk]);
useEffect(function(){try{localStorage.setItem(“rx23-sleep”,sleepH);}catch(e){};},[sleepH]);
useEffect(function(){
document.documentElement.style.setProperty(’–pc’,cP.color);
});// runs every render — cheapest correct approach, no stale comparison needed

// ── DERIVED VALUES ──
var wo=wk-7.0;
var cH=now.getHours()+now.getMinutes()/60+now.getSeconds()/3600;
var sH=((cH-wo)%24+24)%24;
var cP=useMemo(function(){return phaseAt(sH);},[Math.floor(sH*6)]);// recalc max 4x/hr
var pP=Math.min(1,(sH-cP.start)/(cP.end-cP.start));
var mLeft=Math.round((cP.end-sH)*60);
var mod=sdMod(sleepH);
var debtHrs=Math.max(0,8-sleepH).toFixed(1);
var debtCol=sleepH>=7.5?”#34d399”:sleepH>=6?”#fb923c”:”#f87171”;
var nightDim=(cP.id===1||cP.id===2||cP.id===9);

// Next phase + minutes away
var nextP=useMemo(function(){
var i=PHASES.findIndex(function(p){return p.id===cP.id;});
return PHASES[(i+1)%PHASES.length];
},[cP.id]);
var mToNext=useMemo(function(){
var away=((nextP.start+wo)-cH+24)%24;
if(away<0.01)away+=24;
return Math.round(away*60);
},[nextP,wo,cH]);

// Activity score with sleep debt modifier
var aScore=useCallback(function(act){
return Math.round((act.align?act.align[cP.id-1]||0:50)*mod);
},[cP.id,mod]);

var sorted=useMemo(function(){
return ACTS.slice().sort(function(a,b){return aScore(b)-aScore(a);});
},[aScore]);

// 48-point waveform data (every 30 min, wall clock labels)
var hData=useMemo(function(){
var d=[];
for(var i=0;i<48;i++){
var t=i*0.5;
d.push({hr:fmtT(t+wo),cortisol:Math.round(cortisol(t)*100),temp:Math.round(bodyTemp(t)*100),melatonin:Math.round(melatonin(t)*100),composite:Math.round(composite(t)*100)});
}
return d;
},[wo]);

// Personal resonance: empirical peak vs model peak (requires ≥4 log entries)
var resonance=useMemo(function(){
if(log.length<4)return null;
var agg={};
log.forEach(function(e){
if(!agg[e.phase])agg[e.phase]={sum:0,n:0};
agg[e.phase].sum+=e.focus;agg[e.phase].n++;
});
var best=null,bestAvg=0;
Object.keys(agg).forEach(function(k){var a=agg[k].sum/agg[k].n;if(a>bestAvg){bestAvg=a;best=k;}});
var pBest=PHASES.find(function(p){return p.name===best;})||PHASES[0];
var pModel=PHASES.find(function(p){return p.id===4;});// Peak Focus = model prediction
var match=Math.max(0,100-Math.abs(pBest.id-pModel.id)*15);
return {phase:best,phaseObj:pBest,avgFocus:Math.round(bestAvg*20),match:match,n:log.length};
},[log]);

// ── HELPERS ──
var tStr=now.toLocaleTimeString([],{hour:“numeric”,minute:“2-digit”});
var tFull=now.toLocaleTimeString([],{hour:“2-digit”,minute:“2-digit”,second:“2-digit”});
var dStr=now.toLocaleDateString([],{weekday:“short”,month:“short”,day:“numeric”});

var GLOW=”#00FFD1”,BG=”#010103”,FG=“rgba(220,245,240,0.92)”;
var DIM=“rgba(0,255,200,0.32)”,FAINT=“rgba(0,255,200,0.06)”;
var FONT=”‘Chakra Petch’,sans-serif”,MONO=”‘Share Tech Mono’,monospace”;

function card(x){return Object.assign({borderRadius:2,padding:“16px 18px”,background:“rgba(0,255,200,0.018)”,border:“1px solid rgba(0,255,200,0.09)”,position:“relative”,marginBottom:10,clipPath:“polygon(0 0,calc(100% - 14px) 0,100% 14px,100% 100%,14px 100%,0 calc(100% - 14px))”},x||{});}

function addEntry(){
var e={phase:cP.name,time:tFull,ts:new Date().toISOString(),energy:ent.energy,focus:ent.focus,mood:ent.mood,note:ent.note};
var nl=[e].concat(log).slice(0,80);
setLog(nl);
try{localStorage.setItem(“rx23-log”,JSON.stringify(nl));}catch(x){}
setEnt({energy:3,focus:3,mood:3,note:””});
setModal(false);
setFlashSave(true);
setTimeout(function(){setFlashSave(false);},1400);
}

function doExport(){
try{
var hdr=“Phase,Time,Energy,Focus,Mood,Note\n”;
var rows=log.map(function(e){return[e.phase,e.time,e.energy,e.focus,e.mood,’”’+(e.note||””).replace(/”/g,’””’)+’”’].join(”,”);}).join(”\n”);
var blob=new Blob([hdr+rows],{type:“text/csv”});
var url=URL.createObjectURL(blob);
var a=document.createElement(“a”);a.href=url;a.download=“resonance-log.csv”;a.click();
setTimeout(function(){URL.revokeObjectURL(url);},1000);
}catch(e){alert(“Export not available in this browser.”);}
}

function handleWkInput(val){
setWkStr(val);
var p=val.split(”:”);
if(p.length===2){var hh=parseInt(p[0],10),mm=parseInt(p[1],10);if(!isNaN(hh)&&!isNaN(mm)&&hh>=0&&hh<24&&mm>=0&&mm<60)setWk(hh+mm/60);}
}

var wkPresets=[4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5,10];

// ═══════════════════════════════════════════════════
// SVG CLOCK — IIFE runs during render (v21 pattern, guaranteed safe)
// ═══════════════════════════════════════════════════
var SZ=380,CX=190,CY=190,RPI=103,RPO=138,RWI=142,RWO=160,RICO=170,RTICKI=91,RTICKO=100;

var clockEl=(function(){
var segs=[],ticks=[],icons=[];

```
// Guide rings
var rings=[[183,0.3,0.10],[178,0.4,0.06],[163,0.25,0.08],[140,0.25,0.07],[101,0.3,0.10]].map(function(r,i){
  return h("circle",{key:"r"+i,cx:CX,cy:CY,r:r[0],fill:"none",stroke:GLOW,strokeWidth:r[1],strokeOpacity:r[2]});
});

// Ticks (72 = 5° each)
for(var i=0;i<72;i++){
  var deg=i*5,major=(i%6===0),mid=(i%3===0);
  var p1=toXY(CX,CY,RTICKI+(major?0:mid?2:4),deg),p2=toXY(CX,CY,RTICKO,deg);
  ticks.push(h("line",{key:"t"+i,x1:p1[0],y1:p1[1],x2:p2[0],y2:p2[1],stroke:major?"rgba(0,255,200,0.55)":mid?"rgba(0,255,200,0.22)":"rgba(0,255,200,0.09)",strokeWidth:major?1.5:mid?0.9:0.5}));
}

// Cardinal labels
var cards=[0,6,12,18].map(function(hr){
  var xy=toXY(CX,CY,78,(hr/24)*360);
  return h("text",{key:"c"+hr,x:xy[0],y:xy[1]+3.5,textAnchor:"middle",fill:"rgba(0,255,200,0.4)",fontSize:9,fontFamily:FONT,fontWeight:500},fmtT(((hr+wo)%24+24)%24));
});

// Phase arcs — midnight wrap-around split (v21 fix preserved)
PHASES.forEach(function(p){
  var s=((p.start+wo)%24+24)%24,e=((p.end+wo)%24+24)%24;
  var active=p.id===cP.id,col=p.color;
  var st={fill:active?col+"2a":"transparent",stroke:col,strokeWidth:active?1.4:0.6,strokeOpacity:active?0.95:0.28,style:{filter:active?"drop-shadow(0 0 8px "+col+") drop-shadow(0 0 4px "+col+")":"none",transition:"all 0.5s"}};
  if(e>s){segs.push(h("path",Object.assign({key:"a"+p.id,d:arcP(CX,CY,RPI,RPO,s,e)},st)));}
  else if(e===0){segs.push(h("path",Object.assign({key:"a"+p.id,d:arcP(CX,CY,RPI,RPO,s,24)},st)));}
  else{segs.push(h("path",Object.assign({key:"a"+p.id+"A",d:arcP(CX,CY,RPI,RPO,s,24)},st)));segs.push(h("path",Object.assign({key:"a"+p.id+"B",d:arcP(CX,CY,RPI,RPO,0,e)},st)));}
  // Progress fill
  if(active&&pP>0.001){
    var tot=e>s?e-s:(24-s)+e,pe=s+tot*pP;
    if(pe<=24)segs.push(h("path",{key:"f"+p.id,d:arcP(CX,CY,RPI+2,RPO-2,s,pe),fill:col,fillOpacity:0.3,stroke:"none",style:{filter:"drop-shadow(0 0 6px "+col+")"}}));
    else{segs.push(h("path",{key:"f"+p.id+"A",d:arcP(CX,CY,RPI+2,RPO-2,s,24),fill:col,fillOpacity:0.3,stroke:"none",style:{filter:"drop-shadow(0 0 6px "+col+")"}}));segs.push(h("path",{key:"f"+p.id+"B",d:arcP(CX,CY,RPI+2,RPO-2,0,pe-24),fill:col,fillOpacity:0.3,stroke:"none",style:{filter:"drop-shadow(0 0 6px "+col+")"}}));}
  }
});

// Waveform rings — F(t) + cortisol ghost
var wave=[
  h("path",{key:"w1",d:waveP(CX,CY,RWI,RWO,composite),fill:cP.color,fillOpacity:0.07,stroke:cP.color,strokeWidth:1.2,strokeOpacity:0.5,style:{filter:"drop-shadow(0 0 5px "+cP.glo+")"}}),
  h("path",{key:"w2",d:waveP(CX,CY,RWI-3,RWO-3,cortisol),fill:"none",stroke:"#fb923c",strokeWidth:0.6,strokeOpacity:0.2})
];

// Wave inspect dot (inspH comes from outer state closure)
if(inspH!==null){
  var it=((inspH-wo)%24+24)%24;
  var ir=RWI+(RWO-RWI)*composite(it);
  var ixy=toXY(CX,CY,ir,(inspH/24)*360);
  wave.push(h("circle",{key:"insp",cx:ixy[0],cy:ixy[1],r:5,fill:cP.color,style:{filter:"drop-shadow(0 0 10px "+cP.color+")"}}));
}

// Phase icons
PHASES.forEach(function(p){
  var xy=toXY(CX,CY,RICO,((p.start+p.end)/2/24)*360),active=p.id===cP.id,col=p.color;
  icons.push(h("circle",{key:"ic"+p.id,cx:xy[0],cy:xy[1],r:active?20:15,fill:col,fillOpacity:active?0.28:0.09,stroke:col,strokeWidth:active?1.2:0.4,strokeOpacity:active?0.9:0.3,style:{filter:active?"drop-shadow(0 0 12px "+col+")":"none",transition:"all 0.4s cubic-bezier(0.16,1,0.3,1)"}}));
  icons.push(h("text",{key:"it"+p.id,x:xy[0],y:xy[1]+9,textAnchor:"middle",fontSize:active?28:20,style:{filter:active?"drop-shadow(0 0 10px "+col+")":"drop-shadow(0 0 2px rgba(255,255,255,0.2))",opacity:active?1:0.82,transition:"all 0.35s cubic-bezier(0.16,1,0.3,1)"}},p.sym));
});

// Wake marker (gold)
var wa=hDeg(wk);
var wL=toXY(CX,CY,RPI-2,wa),wU=toXY(CX,CY,RPO+2,wa),wD=toXY(CX,CY,RICO+18,wa);
var wakeM=[
  h("line",{key:"wl",x1:wL[0],y1:wL[1],x2:wU[0],y2:wU[1],stroke:"#fde68a",strokeWidth:2.5,style:{filter:"drop-shadow(0 0 5px rgba(253,230,138,0.9))"}}),
  h("circle",{key:"wd",cx:wD[0],cy:wD[1],r:5,fill:"#fde68a",style:{filter:"drop-shadow(0 0 10px rgba(253,230,138,1))"}})
];

// Time needle
var na=hDeg(cH);
var nT=toXY(CX,CY,RPO+1,na),nB=toXY(CX,CY,12,na),nS=toXY(CX,CY,RWO+3,na),nSI=toXY(CX,CY,RWO-4,na);
var sL=toXY(CX,CY,RPO,na-1.2),sR=toXY(CX,CY,RPO,na+1.2);
var needle=[
  h("polygon",{key:"sw",points:CX+","+CY+" "+sL[0]+","+sL[1]+" "+sR[0]+","+sR[1],fill:cP.color,fillOpacity:0.1}),
  h("line",{key:"nl",x1:nB[0],y1:nB[1],x2:nT[0],y2:nT[1],stroke:cP.color,strokeWidth:1.8,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 8px "+cP.glo+")"}}),
  h("line",{key:"sc",x1:nSI[0],y1:nSI[1],x2:nS[0],y2:nS[1],stroke:GLOW,strokeWidth:2.5,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 10px "+GLOW+")"}}),
  h("circle",{key:"cc",cx:CX,cy:CY,r:10,fill:cP.color,fillOpacity:0.18,stroke:cP.color,strokeWidth:1}),
  h("circle",{key:"cd",cx:CX,cy:CY,r:5,fill:cP.color,style:{filter:"drop-shadow(0 0 12px "+cP.glo+")"}})
];

// Center disc
var center=[
  h("circle",{key:"cO",cx:CX,cy:CY,r:58,fill:BG,stroke:GLOW,strokeWidth:0.8,strokeOpacity:0.15}),
  h("circle",{key:"cI",cx:CX,cy:CY,r:54,fill:"none",stroke:cP.color,strokeWidth:0.4,strokeOpacity:0.35}),
  h("circle",{key:"cG",cx:CX,cy:CY,r:58,fill:"url(#cgrad)"}),
  h("text",{key:"cp",x:CX,y:CY-18,textAnchor:"middle",fill:cP.color,fontSize:9,fontFamily:FONT,fontWeight:600,letterSpacing:"0.15em"},cP.name.toUpperCase()),
  h("text",{key:"ct",x:CX,y:CY+4,textAnchor:"middle",fill:FG,fontSize:20,fontFamily:FONT,fontWeight:700,letterSpacing:"0.04em"},tStr),
  h("text",{key:"ci",x:CX,y:CY+19,textAnchor:"middle",fill:"rgba(0,255,200,0.22)",fontSize:8,fontFamily:FONT,letterSpacing:"0.14em"},"PHASE "+cP.id+" \u00B7 9")
];

// Corner marks
var corners=[["M"+(CX-168)+","+(CY-168)+" l18,0 M"+(CX-168)+","+(CY-168)+" l0,18"],["M"+(CX+168)+","+(CY-168)+" l-18,0 M"+(CX+168)+","+(CY-168)+" l0,18"],["M"+(CX-168)+","+(CY+168)+" l18,0 M"+(CX-168)+","+(CY+168)+" l0,-18"],["M"+(CX+168)+","+(CY+168)+" l-18,0 M"+(CX+168)+","+(CY+168)+" l0,-18"]].map(function(d,i){return h("path",{key:"cr"+i,d:d,stroke:GLOW+"18",strokeWidth:1,fill:"none"});});

// SVG click for wave inspection
function onClockClick(evt){
  var rect=evt.currentTarget.getBoundingClientRect();
  var scale=SZ/rect.width;
  var mx=(evt.clientX-rect.left)*scale-CX,my=(evt.clientY-rect.top)*scale-CY;
  var dist=Math.sqrt(mx*mx+my*my);
  if(dist>RWI-10&&dist<RWO+12){
    var angle=Math.atan2(my,mx)*180/Math.PI+90;
    if(angle<0)angle+=360;
    setInspH(inspH!==null?null:((angle/360)*24+wo+24)%24);
  }else{setInspH(null);}
}

// Inspect tooltip
var tooltip=null;
if(inspH!==null){
  var it2=((inspH-wo)%24+24)%24;
  tooltip=h("div",{style:{position:"absolute",top:8,right:8,background:"rgba(1,1,3,0.92)",border:"1px solid "+cP.color+"50",padding:"9px 13px",fontSize:10,fontFamily:MONO,color:cP.color,pointerEvents:"none",zIndex:10}},
    h("div",{style:{marginBottom:4}},"\u29D6 "+fmtT12(inspH)),
    h("div",{style:{color:"#fb923c",marginBottom:2}},"\u25CF C "+Math.round(cortisol(it2)*100)+"%"),
    h("div",{style:{color:"#f87171",marginBottom:2}},"\u25A0 T "+Math.round(bodyTemp(it2)*100)+"%"),
    h("div",{style:{color:"#818cf8",marginBottom:2}},"\u25B2 M "+Math.round(melatonin(it2)*100)+"%"),
    h("div",{style:{color:GLOW,borderTop:"1px solid rgba(0,255,200,0.15)",paddingTop:3,marginTop:3}},"\u25C6 F(t) "+Math.round(composite(it2)*100)+"%"),
    h("div",{style:{color:"rgba(0,255,200,0.25)",marginTop:4,fontSize:9}},"tap again to close")
  );
}

return h("div",{style:{position:"relative",width:"100%"}},
  h("svg",{viewBox:"0 0 "+SZ+" "+SZ,width:"100%",style:{display:"block",maxWidth:"380px",margin:"0 auto",cursor:"crosshair"},onClick:onClockClick},
    h("defs",null,
      h("radialGradient",{id:"cgrad",cx:"50%",cy:"50%",r:"50%"},h("stop",{offset:"0%",stopColor:cP.color,stopOpacity:"0.06"}),h("stop",{offset:"100%",stopColor:"transparent"})),
      h("radialGradient",{id:"bgr",cx:"50%",cy:"50%",r:"50%"},h("stop",{offset:"0%",stopColor:"#0d1a28"}),h("stop",{offset:"60%",stopColor:"#060a12"}),h("stop",{offset:"100%",stopColor:BG})),
      h("radialGradient",{id:"vig",cx:"50%",cy:"50%",r:"50%"},h("stop",{offset:"55%",stopColor:"transparent"}),h("stop",{offset:"100%",stopColor:BG,stopOpacity:"0.5"})),
      h("filter",{id:"gl"},h("feGaussianBlur",{stdDeviation:"2.5",result:"b"}),h("feMerge",null,h("feMergeNode",{in:"b"}),h("feMergeNode",{in:"SourceGraphic"})))),
    h("circle",{cx:CX,cy:CY,r:SZ/2,fill:BG}),
    h("circle",{cx:CX,cy:CY,r:SZ/2,fill:"url(#bgr)"}),
    h("circle",{cx:CX,cy:CY,r:130,fill:cP.color,fillOpacity:0.04}),
    rings,ticks,cards,segs,wave,wakeM,icons,needle,center,
    h("circle",{cx:CX,cy:CY,r:SZ/2,fill:"url(#vig)",pointerEvents:"none"}),
    corners),
  tooltip);
```

})();

// ═══════════════════════════════════════════════════
// WAKE + SLEEP CARD
// ═══════════════════════════════════════════════════
var wakeCard=(function(){
return h(“div”,{style:card()},
h(“span”,{className:“lbl”},“Wake \u00B7 Sleep Setup”),
h(“div”,{style:{display:“flex”,alignItems:“center”,gap:10,marginBottom:6}},
h(“button”,{className:“step-btn”,onClick:function(){setWk(function(v){return Math.max(4,Math.round((v-0.25)*4)/4);});}},”\u2212”),
h(“div”,{style:{flex:1,textAlign:“center”}},
wkInput
? h(“input”,{className:“wake-input”,value:wkStr,onChange:function(e){handleWkInput(e.target.value);},onBlur:function(){setWkInput(false);},autoFocus:true})
: h(“div”,{style:{fontSize:28,fontWeight:700,color:GLOW,fontFamily:MONO,letterSpacing:“0.04em”,cursor:“text”,minHeight:40,lineHeight:“42px”},onClick:function(){setWkStr(fmtT(wk));setWkInput(true);}},fmtT(wk)),
h(“div”,{style:{fontSize:10,color:DIM,marginTop:3}},phaseAt(((wk-wo)%24+24)%24).sym+” wake \u2192 “+phaseAt(((wk-wo)%24+24)%24).name)),
h(“button”,{className:“step-btn”,onClick:function(){setWk(function(v){return Math.min(10.5,Math.round((v+0.25)*4)/4);});}},”+”)
),
h(“div”,{style:{fontSize:10,color:“rgba(0,255,200,0.18)”,textAlign:“center”,marginBottom:10}},“tap time to type \u00B7 \u00B115 min steps”),
h(“div”,{style:{display:“flex”,alignItems:“center”,gap:10,padding:“10px 12px”,background:“rgba(0,0,0,0.2)”,border:“1px solid rgba(0,255,200,0.07)”,marginBottom:8}},
h(“span”,{style:{fontSize:11,color:DIM}},“Sleep”),
h(“input”,{type:“range”,min:4,max:11,step:0.5,value:sleepH,onChange:function(e){setSleepH(parseFloat(e.target.value));},style:{flex:1,accentColor:debtCol}}),
h(“div”,{style:{textAlign:“right”,minWidth:80}},
h(“div”,{style:{fontSize:14,fontWeight:700,color:debtCol,fontFamily:MONO}},sleepH+“h”),
h(“div”,{style:{fontSize:9,color:sleepH>=7.5?DIM:”#f87171”,marginTop:1}},sleepH>=7.5?“Rested”:debtHrs+“h debt”))
),
sleepH<7.5&&h(“div”,{style:{padding:“7px 10px”,background:“rgba(248,113,113,0.06)”,border:“1px solid rgba(248,113,113,0.18)”,fontSize:10,color:”#f87171”,marginBottom:10}},
“\u26A0 Sleep debt \u2212”+Math.round((1-mod)*100)+”% on all activity scores (Walker 2017)”),
h(“div”,{style:{display:“flex”,gap:5,flexWrap:“wrap”}},
wkPresets.map(function(t){var act=Math.abs(wk-t)<0.13;return h(“button”,{key:t,className:“chip”,onClick:function(){setWk(t);},style:{background:act?“rgba(0,255,200,0.15)”:FAINT,color:act?GLOW:DIM,border:“1px solid “+(act?“rgba(0,255,200,0.35)”:“rgba(0,255,200,0.1)”)}},fmtT12(t));}))
);
})();

// ═══════════════════════════════════════════════════
// TAB: CLOCK
// ═══════════════════════════════════════════════════
function renderClock(){
var top3=sorted.slice(0,3);
var cpI=PHASES.findIndex(function(p){return p.id===cP.id;});
var upcoming=[].concat(PHASES.slice(cpI+1),PHASES.slice(0,cpI)).map(function(p){
var away=((p.start+wo)-cH+24)%24;if(away<0.01)away+=24;return{p:p,away:away};
});

```
return h("div",{className:"rise",style:{padding:"0 14px",display:"flex",flexDirection:"column",opacity:nightDim?0.9:1,transition:"opacity 3s ease"}},
  clockEl,
  h("div",{style:{fontSize:10,color:"rgba(0,255,200,0.2)",textAlign:"center",marginTop:-4,marginBottom:8,fontFamily:FONT}},"tap waveform ring to inspect any hour"),
  // Phase card
  h("div",{className:"pbg",style:Object.assign(card(),{borderColor:cP.color+"28",background:cP.color+"08",boxShadow:"0 0 40px "+cP.color+"0a"})},
    h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10}},
      h("div",{style:{flex:1}},
        h("p",{className:"pcolor",style:{fontSize:16,fontWeight:700,color:cP.color,margin:"0 0 4px",fontFamily:FONT,textShadow:"0 0 20px "+cP.color+"60"}},cP.sym+" "+cP.name),
        h("p",{style:{fontSize:11,color:DIM,margin:0,lineHeight:1.6}},cP.desc)),
      h("div",{style:{textAlign:"right",flexShrink:0,marginLeft:14}},
        h("div",{style:{fontSize:18,fontWeight:700,color:cP.color,fontFamily:MONO}},Math.round(pP*100)+"%"),
        h("div",{className:mLeft<=20?"urgent":"",style:{fontSize:10,color:mLeft<=20?"#f87171":DIM,marginTop:2,fontWeight:mLeft<=20?700:400}},mLeft+"m left"),
        h("div",{style:{fontSize:9,color:"rgba(255,255,255,0.2)",marginTop:2}},fmtT(cP.start+wo)+"\u2013"+fmtT(cP.end+wo)))),
    h("div",{className:"pbar"},h("div",{className:"pbar-fill",style:{width:(pP*100)+"%",background:cP.color,boxShadow:"0 0 10px "+cP.color+"60"}})),
    // Next phase teaser
    h("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8,padding:"6px 10px",background:"rgba(0,0,0,0.18)",border:"1px solid rgba(0,255,200,0.06)"}},
      h("span",{style:{fontSize:10,color:"rgba(0,255,200,0.2)",fontFamily:FONT,letterSpacing:"0.1em"}},"NEXT"),
      h("span",{style:{fontSize:11,color:nextP.color}},nextP.sym+" "+nextP.name),
      h("span",{style:{fontSize:10,color:"rgba(0,255,200,0.2)",marginLeft:"auto",fontFamily:MONO}},
        (function(){var hh=Math.floor(mToNext/60),mm=mToNext%60;return hh>0?hh+"h "+mm+"m":mm+"m";})())),
    h("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:10}},
      cP.best.map(function(a){return h("span",{key:"b"+a,style:{fontSize:10,padding:"4px 10px",background:cP.color+"12",color:cP.color,border:"1px solid "+cP.color+"25",clipPath:"polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)",fontFamily:FONT,letterSpacing:"0.08em"}},"\u2713 "+a);}),
      cP.avoid.map(function(a){return h("span",{key:"v"+a,style:{fontSize:10,padding:"4px 10px",background:"rgba(248,113,113,0.08)",color:"#f87171",border:"1px solid rgba(248,113,113,0.2)",clipPath:"polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)",fontFamily:FONT,letterSpacing:"0.08em"}},"\u00D7 "+a);}))),
  wakeCard,
  // Top 3
  h("div",{style:card()},
    h("span",{className:"lbl",style:{color:GLOW}},"Optimal Now"),
    mod<1&&h("div",{style:{fontSize:10,color:"rgba(248,113,113,0.6)",marginBottom:8}},"\u26A0 Scores reflect sleep debt ("+sleepH+"h / 8h ref)"),
    top3.map(function(act,i){
      var sc=aScore(act),col=sCol(sc),tier=sc>=75?"high":sc>=40?"mid":"low";
      return h("div",{key:act.name,style:{display:"flex",alignItems:"center",gap:12,padding:"11px 0",borderBottom:i<2?"1px solid rgba(0,255,200,0.06)":"none"}},
        h("span",{style:{fontSize:22,width:30,textAlign:"center",lineHeight:1}},act.icon),
        h("div",{style:{flex:1}},
          h("div",{style:{fontSize:12,fontWeight:600,color:FG}},act.name),
          h("div",{style:{fontSize:10,color:DIM,marginTop:2,lineHeight:1.4}},act.adapt[tier].split(".")[0]+".")),
        h("div",{style:{textAlign:"right"}},
          h("div",{style:{fontSize:16,fontWeight:700,color:col,fontFamily:MONO}},sc+"%"),
          h("div",{style:{fontSize:9,color:col,letterSpacing:"0.1em",fontFamily:FONT}},sLbl(sc))));
    })),
  // Incoming
  h("div",{style:card()},
    h("span",{className:"lbl"},"Incoming"),
    upcoming.slice(0,3).map(function(item,i){
      var p=item.p,away=item.away,hh=Math.floor(away),mm=Math.round((away-hh)*60);
      return h("div",{key:p.id,style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0",borderBottom:i<2?"1px solid rgba(0,255,200,0.05)":"none"}},
        h("div",{style:{width:3,height:26,background:p.color,boxShadow:"0 0 8px "+p.color+"50",flexShrink:0}}),
        h("div",{style:{flex:1}},
          h("div",{style:{fontSize:12,fontWeight:500,color:FG}},p.sym+" "+p.name),
          h("div",{style:{fontSize:10,color:DIM,marginTop:1}},p.desc.slice(0,44)+"\u2026")),
        h("div",{style:{fontSize:11,color:DIM,fontFamily:MONO,textAlign:"right"}},hh>0?hh+"h "+mm+"m":mm+"m"));
    }))
);
```

}

// ═══════════════════════════════════════════════════
// TAB: ALIGN
// ═══════════════════════════════════════════════════
function renderAlign(){
var top3=sorted.slice(0,3),rest=sorted.slice(3);
return h(“div”,{className:“rise”,style:{padding:“0 14px”,display:“flex”,flexDirection:“column”}},
h(“div”,{className:“pbg”,style:Object.assign(card(),{borderColor:cP.color+“28”,background:cP.color+“08”})},
h(“div”,{style:{display:“flex”,justifyContent:“space-between”,alignItems:“center”}},
h(“div”,null,h(“div”,{style:{fontSize:15,fontWeight:700,color:cP.color}},cP.sym+” “+cP.name),h(“div”,{style:{fontSize:10,color:DIM,marginTop:2}},cP.desc)),
h(“div”,{style:{textAlign:“right”}},h(“div”,{style:{fontSize:13,fontWeight:700,color:GLOW,fontFamily:MONO}},mLeft+“m left”),mod<1&&h(“div”,{style:{fontSize:9,color:”#f87171”,marginTop:2}},“sleep \u2212”+Math.round((1-mod)*100)+”%”)))),
h(“div”,{style:{display:“flex”,flexWrap:“wrap”,gap:6,marginBottom:10}},
CTXS.map(function(ctx){var sel=selC&&selC.id===ctx.id;return h(“button”,{key:ctx.id,className:“chip”,onClick:function(){setSelC(sel?null:ctx);},style:{background:sel?“rgba(0,255,200,0.12)”:FAINT,color:sel?GLOW:DIM,border:“1px solid “+(sel?“rgba(0,255,200,0.3)”:“rgba(0,255,200,0.08)”)}},ctx.icon+” “+ctx.label);})),
h(“span”,{className:“lbl”,style:{color:GLOW}},“Top 3 This Phase”),
top3.map(function(act){
var sc=aScore(act),sel=selA&&selA.name===act.name,col=sCol(sc),tier=sc>=75?“high”:sc>=40?“mid”:“low”;
return h(“button”,{key:act.name,onClick:function(){setSelA(sel?null:act);},
style:{width:“100%”,display:“flex”,alignItems:“center”,gap:14,padding:“14px 16px”,textAlign:“left”,marginBottom:6,
background:sel?col+“0e”:“rgba(0,255,200,0.02)”,border:“1px solid “+(sel?col+“35”:“rgba(0,255,200,0.08)”),
borderLeft:“4px solid “+(sel?col:col+“55”),position:“relative”,overflow:“hidden”,
clipPath:“polygon(0 0,calc(100% - 8px) 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px))”,transition:“all 0.18s”}},
h(“div”,{style:{width:36,height:36,flexShrink:0,display:“flex”,alignItems:“center”,justifyContent:“center”,background:col+“12”,border:“1px solid “+col+“25”,fontSize:20}},act.icon),
h(“div”,{style:{flex:1,minWidth:0}},
h(“div”,{style:{fontSize:13,fontWeight:600,color:sel?FG:DIM}},act.name),
sel&&h(“div”,{style:{fontSize:10,color:DIM,marginTop:4,lineHeight:1.55}},act.adapt[tier])),
h(“div”,{style:{textAlign:“right”,flexShrink:0}},
h(“div”,{style:{fontSize:20,fontWeight:700,color:col,fontFamily:MONO}},sc+”%”),
h(“div”,{style:{fontSize:9,color:col,letterSpacing:“0.1em”,fontFamily:FONT}},sLbl(sc))),
h(“div”,{className:“pbar”,style:{position:“absolute”,bottom:0,left:0,right:0}},h(“div”,{className:“pbar-fill”,style:{width:sc+”%”,background:col+“80”}})));
}),
selA&&aScore(selA)<75&&sorted[0].name!==selA.name&&h(“div”,{style:{padding:“10px 14px”,background:“rgba(0,255,200,0.04)”,border:“1px solid rgba(0,255,200,0.12)”,fontSize:11,color:GLOW,marginBottom:8}},”\u2192 Better now: “+sorted[0].icon+” “+sorted[0].name+” (”+aScore(sorted[0])+”%)”),
h(“div”,null,
h(“button”,{onClick:function(){setActsOpen(function(v){return!v;});},
style:{display:“flex”,alignItems:“center”,gap:8,width:“100%”,padding:“10px 0”,color:DIM,fontSize:10,letterSpacing:“0.12em”,borderBottom:“1px solid rgba(0,255,200,0.06)”,background:“none”,cursor:“pointer”}},
h(“span”,{style:{fontFamily:FONT,letterSpacing:“0.15em”}},“ALL ACTIVITIES”),
h(“span”,{style:{marginLeft:“auto”,fontSize:14,transition:“transform 0.3s”,transform:actsOpen?“rotate(180deg)”:“none”}},”\u2304”)),
h(“div”,{className:“acts-rest “+(actsOpen?“open”:“closed”)},
rest.map(function(act){
var sc=aScore(act),sel=selA&&selA.name===act.name,col=sCol(sc),tier=sc>=75?“high”:sc>=40?“mid”:“low”;
return h(“button”,{key:act.name,onClick:function(){setSelA(sel?null:act);},
style:{width:“100%”,display:“flex”,alignItems:“center”,gap:12,padding:“10px 12px”,textAlign:“left”,marginTop:6,
background:sel?col+“0e”:“rgba(0,255,200,0.01)”,border:“1px solid “+(sel?col+“35”:“rgba(0,255,200,0.05)”),borderLeft:“3px solid “+(sel?col:col+“40”),transition:“all 0.18s”}},
h(“span”,{style:{fontSize:18,width:26,textAlign:“center”,flexShrink:0}},act.icon),
h(“div”,{style:{flex:1,minWidth:0}},
h(“div”,{style:{fontSize:11,fontWeight:500,color:sel?FG:DIM}},act.name),
sel&&h(“div”,{style:{fontSize:10,color:DIM,marginTop:3,lineHeight:1.5}},act.adapt[tier])),
h(“div”,{style:{textAlign:“right”,flexShrink:0}},
h(“div”,{style:{fontSize:14,fontWeight:700,color:col,fontFamily:MONO}},sc+”%”),
h(“div”,{className:“pbar”,style:{width:56,marginTop:4}},h(“div”,{className:“pbar-fill”,style:{width:sc+”%”,background:col}}))));
})))
);
}

// ═══════════════════════════════════════════════════
// TAB: INSIGHTS
// ═══════════════════════════════════════════════════
function renderInsights(){
var bm=[
{name:“Cortisol”,val:cortisol(sH),color:”#fb923c”,shape:”\u25CF”,desc:cortisol(sH)>0.65?“Elevated \u2014 peak alertness”:cortisol(sH)>0.38?“Moderate \u2014 focus”:“Low \u2014 recovery”},
{name:“Core Temp”,val:bodyTemp(sH),color:”#f87171”,shape:”\u25A0”,desc:bodyTemp(sH)>0.65?“Near peak \u2014 physical window”:bodyTemp(sH)>0.42?“Mid-range”:“Low \u2014 rest optimal”},
{name:“Melatonin”,val:melatonin(sH),color:”#818cf8”,shape:”\u25B2”,desc:melatonin(sH)>0.52?“Elevated \u2014 sleep pressure”:“Suppressed \u2014 active”},
{name:“F(t)”,val:composite(sH),color:GLOW,shape:”\u25C6”,desc:“Composite arousal index”}
];

```
function gauge(val,col,label,shape){
  var r=30,circ=2*Math.PI*r;
  return h("div",{style:{textAlign:"center"}},
    h("svg",{width:74,height:74,viewBox:"0 0 74 74"},
      h("circle",{cx:37,cy:37,r:r,fill:"none",stroke:"rgba(255,255,255,0.05)",strokeWidth:5}),
      h("circle",{cx:37,cy:37,r:r,fill:"none",stroke:col,strokeWidth:5,strokeLinecap:"round",strokeDasharray:circ,strokeDashoffset:circ*(1-val),transform:"rotate(-90 37 37)",className:"ring",style:{filter:"drop-shadow(0 0 6px "+col+")"}}),
      h("text",{x:37,y:31,textAnchor:"middle",fill:col,fontSize:11,fontFamily:MONO},shape),
      h("text",{x:37,y:47,textAnchor:"middle",fill:col,fontSize:12,fontFamily:MONO,fontWeight:500},Math.round(val*100)+"%")),
    h("div",{style:{fontSize:10,color:FG,fontWeight:600,marginTop:2}},label));
}

// Resonance panel
var resPanel=resonance
  ?(function(){
      var mc=resonance.match>=80?GLOW:resonance.match>=60?"#fb923c":"#f87171";
      var r=34,circ=2*Math.PI*r;
      return h("div",{style:Object.assign(card(),{borderColor:"rgba(0,255,200,0.2)",background:"rgba(0,255,200,0.022)"})},
        h("span",{className:"lbl",style:{color:GLOW}},"Personal Resonance"),
        h("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:12}},
          h("svg",{width:78,height:78,viewBox:"0 0 78 78"},
            h("circle",{cx:39,cy:39,r:r,fill:"none",stroke:"rgba(255,255,255,0.05)",strokeWidth:5}),
            h("circle",{cx:39,cy:39,r:r,fill:"none",stroke:mc,strokeWidth:5,strokeLinecap:"round",strokeDasharray:circ,strokeDashoffset:circ*(1-resonance.match/100),transform:"rotate(-90 39 39)",className:"ring",style:{filter:"drop-shadow(0 0 8px "+mc+")"}}),
            h("text",{x:39,y:35,textAnchor:"middle",fill:mc,fontSize:14,fontFamily:MONO,fontWeight:700},resonance.match+"%"),
            h("text",{x:39,y:49,textAnchor:"middle",fill:"rgba(0,255,200,0.3)",fontSize:7,fontFamily:FONT,letterSpacing:"0.1em"},"MATCH")),
          h("div",{style:{flex:1}},
            h("div",{style:{fontSize:12,fontWeight:600,color:FG,marginBottom:6}},"Your peak focus phase"),
            h("div",{style:{fontSize:13,color:mc,marginBottom:4}},resonance.phaseObj.sym+" "+resonance.phase),
            h("div",{style:{fontSize:10,color:DIM,lineHeight:1.5}},"Avg focus: "+resonance.avgFocus+"% \u00B7 Model predicts: \u26A1 Peak Focus"),
            h("div",{style:{fontSize:9,color:"rgba(0,255,200,0.2)",marginTop:4}},resonance.n+" entries analyzed"))),
        h("div",{style:{padding:"8px 12px",background:FAINT,fontSize:10,color:DIM,lineHeight:1.55}},"Resonance = alignment of your self-reported peak vs the F(t) model peak. Keep logging to refine."));
    })()
  : h("div",{style:Object.assign(card(),{borderColor:"rgba(0,255,200,0.1)"})},
      h("span",{className:"lbl",style:{color:GLOW}},"Personal Resonance"),
      h("div",{style:{textAlign:"center",padding:"20px 0",color:DIM}},
        h("div",{style:{fontSize:24,marginBottom:8}},"\u25CE"),
        h("div",{style:{fontSize:11}},"Log 4+ entries to unlock your personal resonance score"),
        h("div",{style:{fontSize:10,color:"rgba(0,255,200,0.18)",marginTop:6}},"Your empirical peak vs the F(t) model prediction")));

return h("div",{className:"rise",style:{padding:"0 14px",display:"flex",flexDirection:"column"}},
  h("div",{style:card({paddingBottom:18})},
    h("span",{className:"lbl",style:{color:cP.color}},"Relative Activation \u2014 "+cP.name),
    h("div",{style:{fontSize:9,color:"rgba(0,255,200,0.2)",marginBottom:12}},"\u25CF=Cortisol  \u25A0=Core Temp  \u25B2=Melatonin  \u25C6=F(t) \u00B7 Normalized 0\u2013100%, not physiological units"),
    h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6}},bm.map(function(b){return gauge(b.val,b.color,b.name,b.shape);}))),
  resPanel,
  h("div",{style:card()},
    h("span",{className:"lbl"},"Phase Sequence"),
    PHASES.map(function(p){
      var isNow=p.id===cP.id,past=sH>p.end&&!isNow,prog=isNow?pP:past?1:0;
      return h("div",{key:p.id,style:{display:"flex",alignItems:"center",gap:10,padding:"7px 0",opacity:past?0.22:1,borderLeft:"2px solid "+(isNow?p.color:p.color+"15"),paddingLeft:10}},
        h("span",{style:{fontSize:14,width:20,lineHeight:1}},p.sym),
        h("div",{style:{flex:1}},
          h("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4}},
            h("span",{style:{fontSize:11,fontWeight:isNow?600:400,color:isNow?FG:DIM}},p.name),
            h("span",{style:{fontSize:9,color:"rgba(0,255,200,0.18)",fontFamily:MONO}},fmtT(p.start+wo)+"\u2013"+fmtT(p.end+wo))),
          h("div",{className:"pbar"},h("div",{className:"pbar-fill",style:{width:(prog*100)+"%",background:p.color,boxShadow:isNow?"0 0 6px "+p.color+"50":"none"}}))),
        isNow&&h("span",{style:{fontSize:8,color:p.color,fontWeight:700,letterSpacing:"0.12em",marginLeft:4}},"LIVE"));
    })),
  h("div",{style:card()},
    h("span",{className:"lbl"},"24h Waveform"),
    h("div",{style:{fontSize:9,color:"rgba(0,255,200,0.2)",marginBottom:8}},"\u25CF=Cortisol  \u25A0=Core Temp  \u25B2=Melatonin  \u25C6=F(t)"),
    (function(){
      var W=480,H=120,PAD_L=8,PAD_R=8,PAD_T=8,PAD_B=20;
      var cW=W-PAD_L-PAD_R,cH=H-PAD_T-PAD_B;
      var n=hData.length;
      function px(i){return PAD_L+i/(n-1)*cW;}
      function py(v){return PAD_T+(1-v/100)*cH;}
      function pts(key){return hData.map(function(d,i){return px(i).toFixed(1)+","+py(d[key]).toFixed(1);}).join(" ");}
      // hour labels: every 6h = index 0,12,24,36
      var labels=[0,12,24,36].map(function(i){return{x:px(i),label:hData[i].hr};});
      var lines=[
        {key:"cortisol",stroke:"#fb923c",w:1.2,name:"\u25CF Cortisol"},
        {key:"temp",stroke:"#f87171",w:1.2,name:"\u25A0 Temp"},
        {key:"melatonin",stroke:"#818cf8",w:1.2,name:"\u25B2 Melatonin"},
        {key:"composite",stroke:GLOW,w:2,name:"\u25C6 F(t)"}
      ];
      // current hour marker
      var nowI=Math.min(n-1,Math.round((sH/24)*(n-1)));
      var nowX=px(nowI);
      return h("div",{style:{width:"100%",overflowX:"hidden"}},
        h("svg",{viewBox:"0 0 "+W+" "+H,width:"100%",style:{display:"block"}},
          // grid lines
          [25,50,75].map(function(v){return h("line",{key:"g"+v,x1:PAD_L,y1:py(v),x2:W-PAD_R,y2:py(v),stroke:"rgba(0,255,200,0.06)",strokeWidth:1});}),
          // data lines
          lines.map(function(ln){return h("polyline",{key:ln.key,points:pts(ln.key),fill:"none",stroke:ln.stroke,strokeWidth:ln.w,strokeLinejoin:"round",strokeLinecap:"round",opacity:0.85});}),
          // F(t) fill area
          (function(){
            var topPts=hData.map(function(d,i){return px(i).toFixed(1)+","+py(d.composite).toFixed(1);}).join(" ");
            var bottom=PAD_T+cH;
            var first=PAD_L+","+bottom;
            var last=(PAD_L+cW)+","+bottom;
            return h("polygon",{key:"fill",points:first+" "+topPts+" "+last,fill:GLOW,fillOpacity:0.04,stroke:"none"});
          })(),
          // Now line
          h("line",{key:"now",x1:nowX,y1:PAD_T,x2:nowX,y2:PAD_T+cH,stroke:cP.color,strokeWidth:1.5,strokeDasharray:"3,3",opacity:0.7}),
          h("circle",{key:"nowdot",cx:nowX,cy:py(Math.round(composite(sH)*100)),r:3,fill:cP.color,style:{filter:"drop-shadow(0 0 4px "+cP.color+")"}}),
          // x-axis labels
          labels.map(function(lb){return h("text",{key:"lb"+lb.x,x:lb.x,y:H-4,textAnchor:"middle",fill:"rgba(0,255,200,0.25)",fontSize:8,fontFamily:FONT},lb.label);}),
          // legend
          lines.map(function(ln,i){return h("text",{key:"leg"+i,x:PAD_L+i*118,y:H-4,fill:ln.stroke,fontSize:8,fontFamily:FONT,opacity:0.7},ln.name);})));
    })()),
  h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
    h("span",{style:{fontSize:13,fontWeight:600,color:FG}},"Energy Log"),
    h("div",{style:{display:"flex",gap:8}},
      log.length>0&&h("button",{onClick:doExport,style:{fontSize:9,padding:"5px 10px",background:"rgba(0,255,200,0.04)",border:"1px solid rgba(0,255,200,0.12)",color:DIM,letterSpacing:"0.08em",clipPath:"polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)"}},"↓ CSV"),
      h("button",{onClick:function(){setModal(true);},className:flashSave?"save-flash":"",style:{fontSize:10,padding:"6px 14px",background:"rgba(0,255,200,0.06)",border:"1px solid rgba(0,255,200,0.18)",color:GLOW,letterSpacing:"0.08em",clipPath:"polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)",minHeight:36,touchAction:"manipulation",transition:"background 0.4s"}},"✚ Track"))),
  log.length>0&&h("div",{style:{display:"flex",flexDirection:"column",gap:6}},
    log.slice(0,5).map(function(e,i){
      var ep=PHASES.find(function(p){return p.name===e.phase;})||PHASES[0];
      return h("div",{key:i,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",background:"rgba(0,255,200,0.015)",border:"1px solid rgba(0,255,200,0.07)",clipPath:"polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,0 100%)"}},
        h("span",{style:{fontSize:16}},ep.sym),
        h("div",{style:{flex:1}},
          h("div",{style:{display:"flex",justifyContent:"space-between"}},
            h("span",{style:{fontSize:11,fontWeight:600,color:FG}},e.phase),
            h("span",{style:{fontSize:9,color:"rgba(0,255,200,0.15)",fontFamily:MONO}},e.time)),
          h("div",{style:{display:"flex",gap:10,marginTop:3}},
            [["\u25CF",e.energy,"#fb923c"],["\u25C6",e.focus,GLOW],["\u25B2",e.mood,"#a78bfa"]].map(function(a){return h("span",{key:a[0],style:{fontSize:9,color:a[2],fontFamily:MONO}},a[0]+" "+a[1]+"/5");}))));}))
);
```

}

// ═══════════════════════════════════════════════════
// TAB: SCIENCE
// ═══════════════════════════════════════════════════
function renderScience(){
var artD=[[1,“0.0\u00B0”,“12.7\u00B0”,12.7],[2,“40.1\u00B0”,“38.8\u00B0”,1.3],[3,“82.0\u00B0”,“64.0\u00B0”,18.0],[4,“128.3\u00B0”,“136.5\u00B0”,8.2],[5,“171.1\u00B0”,“164.0\u00B0”,7.1],[6,“196.2\u00B0”,“199.4\u00B0”,3.2],[7,“237.2\u00B0”,“224.8\u00B0”,12.4],[8,“270.0\u00B0”,“267.6\u00B0”,2.4],[9,“317.6\u00B0”,“326.2\u00B0”,8.6]];
var mae=artD.reduce(function(s,r){return s+r[3];},0)/artD.length;// = 8.2°
var effD=((40-mae)/mae).toFixed(2);// effect size vs 40° chance baseline
var rSq=(1-mae/40).toFixed(2);

```
return h("div",{className:"rise",style:{padding:"0 14px",display:"flex",flexDirection:"column"}},
  h("div",{style:Object.assign(card(),{borderColor:"rgba(0,255,200,0.2)"})},
    h("span",{className:"lbl",style:{color:GLOW}},"The Discovery"),
    h("h2",{style:{fontSize:20,fontWeight:700,color:FG,margin:"0 0 12px",fontFamily:FONT}},"Mathematics Validates Art"),
    h("p",{style:{fontSize:12,lineHeight:1.75,color:DIM,margin:"0 0 8px"}},"H.A. Marouf derived this 9-phase model from hormonal mathematics using published biochemical parameters. F(t) was computed from three biological oscillators with asymmetric, empirically-fitted Fourier harmonics."),
    h("p",{style:{fontSize:12,lineHeight:1.75,color:DIM,margin:"0 0 16px"}},"Phase boundaries were then compared against independent automatic mandala drawings — created through meditative practice as a wholly separate process — yielding statistically significant alignment."),
    h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6}},
      [{stat:"8.2\u00B0",sub:"MAE",c:GLOW},{stat:"p=.003",sub:"Monte Carlo",c:"#a78bfa"},{stat:"d="+effD,sub:"Effect Size",c:"#60a5fa"},{stat:"R\u00B2="+rSq,sub:"vs Chance",c:"#fb923c"}].map(function(s){
        return h("div",{key:s.sub,style:{textAlign:"center",padding:"12px 4px",background:s.c+"09",border:"1px solid "+s.c+"20",clipPath:"polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%)"}},
          h("div",{style:{fontSize:15,fontWeight:700,color:s.c,fontFamily:MONO}},s.stat),
          h("div",{style:{fontSize:8,color:DIM,marginTop:4,letterSpacing:"0.1em"}},s.sub));}))
  ),
  h("div",{style:card()},
    h("span",{className:"lbl"},"Artwork vs Model Boundaries"),
    h("div",{style:{overflowX:"auto"}},
      h("table",{className:"sci-table"},
        h("thead",null,h("tr",null,["#","Phase","Artwork","Model","Err",""].map(function(t,i){return h("th",{key:i},t);}))),
        h("tbody",null,artD.map(function(r){
          var err=r[3],good=err<=5,ok=err<=10,col=good?GLOW:ok?"#fb923c":"#f87171";
          return h("tr",{key:r[0]},
            h("td",{style:{color:PHASES[r[0]-1].color,fontWeight:700}},r[0]),
            h("td",{style:{color:DIM}},PHASES[r[0]-1].sym+" "+PHASES[r[0]-1].name.split(" ")[0]),
            h("td",{style:{color:DIM}},r[1]),h("td",{style:{color:"#60a5fa"}},r[2]),
            h("td",{style:{color:col,fontWeight:700}},r[3].toFixed(1)+"\u00B0"),
            h("td",{style:{color:col}},good?"\u2713":ok?"\u2248":"\u25B3"));})))),
    h("div",{style:{marginTop:10,padding:"8px 12px",background:FAINT,fontSize:10,color:DIM,lineHeight:1.55}},"MAE\u202F=\u202F8.2\u00B0 vs 40\u00B0 random baseline (360\u00B0/9 equal sectors). Asymmetric model \u221244% error vs symmetric (14.6\u00B0). Effect size d\u202F=\u202F"+effD+" (large). Activity alignment arrays are heuristically tuned to the F(t) phase profile, not derived from the Fourier formalism.")),
  h("div",{style:card()},
    h("span",{className:"lbl"},"Asymmetric Fourier Model"),
    h("div",{style:{padding:"14px",background:FAINT,border:"1px solid rgba(0,255,200,0.08)",fontFamily:MONO,fontSize:11,lineHeight:2.1}},
      h("div",{style:{color:GLOW,fontWeight:600,fontSize:12}},"F(t) = 0.5\u00B7C(t) + 0.3\u00B7T(t) + 0.2\u00B7M(t)"),
      h("div",{style:{color:DIM,fontSize:9,marginBottom:8}},"// uncoupled phase angles per harmonic — key innovation"),
      h("div",null,h("span",{style:{color:"#fb923c"}},"C(t)"),h("span",{style:{color:DIM}}," = \u03A3 a\u2099\u00B7cos(2\u03C0n(t\u2212\u03C6\u2099)/24)")),
      h("div",{style:{fontSize:9,color:"rgba(0,255,200,0.25)",marginLeft:18}},"\u03C6\u2081=10.5h \u03C6\u2082=9.0h \u03C6\u2083=8.4h \u03C6\u2084=8.5h"),
      h("div",{style:{fontSize:9,color:"rgba(0,255,200,0.15)",marginLeft:18,marginBottom:6}},"4h rise : 16h decay — uncoupled phases capture 4:1 CAR asymmetry"),
      h("div",null,h("span",{style:{color:"#f87171"}},"T(t)"),h("span",{style:{color:DIM}}," = \u03A3 b\u2099\u00B7cos(2\u03C0n(t\u2212\u03C8\u2099)/24)")),
      h("div",{style:{fontSize:9,color:"rgba(0,255,200,0.2)",marginLeft:18,marginBottom:6}},"\u03C8\u2081=16.5h \u03C8\u2082=17.8h \u03C8\u2083=8.7h"),
      h("div",null,h("span",{style:{color:"#818cf8"}},"M(t)"),h("span",{style:{color:DIM}}," = \u03A3 c\u2099\u00B7cos(2\u03C0n(t\u2212\u03B8\u2099)/24)")),
      h("div",{style:{fontSize:9,color:"rgba(0,255,200,0.2)",marginLeft:18}},"\u03B8\u2081=2.0h \u03B8\u2082=2.0h \u03B8\u2083=1.8h"),
      h("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid rgba(0,255,200,0.08)",color:"rgba(0,255,200,0.2)",fontSize:9}},"10 harmonics \u2192 17 critical features \u2192 9 phase boundaries"),
      h("div",{style:{color:"rgba(0,255,200,0.2)",fontSize:9}},"200k Monte Carlo \u00B7 p = 0.003 \u00B7 MAE = 8.2\u00B0 \u00B7 d = "+effD))),
  h("div",{style:Object.assign(card(),{borderColor:"rgba(251,146,60,0.18)"})},
    h("span",{className:"lbl",style:{color:"#fb923c"}},"Why Asymmetric?"),
    h("p",{style:{fontSize:12,lineHeight:1.75,color:DIM,margin:"0 0 8px"}},"Standard cosinor locks all harmonics to the same acrophase, producing symmetric waveforms. But cortisol's Awakening Response doubles in 30\u201345 min while decay takes 12+ hours \u2014 a 4:1 asymmetry ratio."),
    h("p",{style:{fontSize:12,lineHeight:1.75,color:DIM,margin:"0 0 8px"}},"Uncoupling each harmonic's phase angle allows the Fourier series to capture this biological asymmetry. Higher harmonics shift earlier, steepening the morning rise."),
    h("p",{style:{fontSize:12,lineHeight:1.75,color:DIM,margin:0}},"DLMO (dim-light melatonin onset) varies \u00B190 min between individuals (Burgess 2008). Use the wake time slider to calibrate to your personal chronotype.")),
  h("div",{style:card()},
    h("span",{className:"lbl"},"Validation Protocol"),
    [{n:"1",t:"Derivation from published data",d:"Phase boundaries computed from F(t) critical features using published hormonal parameters (Weitzman 1971; Veldhuis 1989; Debono 2009; Refinetti 2010; Lewy 1999).",c:GLOW},
     {n:"2",t:"Independent artwork",d:"9-fold automatic mandala drawings created through meditative practice. Sector angles measured independently without reference to the mathematical model.",c:"#60a5fa"},
     {n:"3",t:"Statistical comparison",d:"Model vs artwork: MAE = 8.2\u00B0. Monte Carlo 200k random 9-boundary sets: p = 0.003. Effect size d = "+effD+" (large effect).",c:"#a78bfa"},
     {n:"4",t:"Sensitivity analysis",d:"Symmetric model MAE = 14.6\u00B0. Asymmetric correction reduces error 44% by resolving cortisol's steep rise vs slow decay.",c:"#fb923c"}
    ].map(function(item){
      return h("div",{key:item.n,style:{display:"flex",gap:12,marginBottom:14}},
        h("div",{style:{width:24,height:24,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,background:item.c+"10",color:item.c,border:"1px solid "+item.c+"25",clipPath:"polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)"}},item.n),
        h("div",null,h("p",{style:{fontSize:12,fontWeight:600,color:FG,margin:"0 0 3px"}},item.t),h("p",{style:{fontSize:11,color:DIM,margin:0,lineHeight:1.55}},item.d)));
    }),
    h("p",{style:{fontSize:8,color:"rgba(0,255,200,0.15)",borderTop:"1px solid rgba(0,255,200,0.06)",paddingTop:10,margin:0,fontFamily:MONO}},
      "Weitzman 1971 \u00B7 Veldhuis 1989 \u00B7 Debono 2009 \u00B7 Refinetti 2010 \u00B7 Lewy 1999 \u00B7 Burgess 2008 \u00B7 Walker 2017"))
);
```

}

// ═══════════════════════════════════════════════════
// TRACK MODAL
// ═══════════════════════════════════════════════════
var modalEl=modal&&h(“div”,{onClick:function(e){if(e.target===e.currentTarget)setModal(false);},style:{position:“fixed”,inset:0,zIndex:100,display:“flex”,alignItems:“flex-end”,justifyContent:“center”,background:“rgba(1,1,3,0.88)”,backdropFilter:“blur(14px)”}},
h(“div”,{className:“slide-up”,style:{width:“100%”,maxWidth:480,padding:22,background:“linear-gradient(180deg,#0b0e16,#010103)”,border:“1px solid rgba(0,255,200,0.14)”,borderBottom:“none”,clipPath:“polygon(0 18px,18px 0,calc(100% - 18px) 0,100% 18px,100% 100%,0 100%)”}},
h(“div”,{style:{display:“flex”,justifyContent:“space-between”,alignItems:“center”,marginBottom:18}},
h(“div”,null,h(“h3”,{style:{fontSize:15,fontWeight:700,color:FG,margin:0}},“Track State”),h(“p”,{style:{fontSize:9,color:DIM,margin:“3px 0 0”}},cP.sym+” “+cP.name+” \u00B7 “+tFull)),
h(“button”,{onClick:function(){setModal(false);},style:{width:36,height:36,background:“rgba(0,255,200,0.06)”,border:“1px solid rgba(0,255,200,0.18)”,fontSize:16,color:GLOW,minHeight:36,touchAction:“manipulation”}},”\u00D7”)),
[{k:“energy”,l:“Energy”,sh:”\u25CF”,c:”#fb923c”},{k:“focus”,l:“Focus”,sh:”\u25C6”,c:GLOW},{k:“mood”,l:“Mood”,sh:”\u25B2”,c:”#a78bfa”}].map(function(item){
return h(“div”,{key:item.k,style:{marginBottom:16}},
h(“div”,{style:{display:“flex”,justifyContent:“space-between”,marginBottom:8}},
h(“span”,{style:{fontSize:11,color:DIM}},item.sh+” “+item.l),
h(“span”,{style:{fontSize:13,color:item.c,fontWeight:700,fontFamily:MONO}},ent[item.k]+”/5”)),
h(“div”,{style:{display:“flex”,gap:7}},
[1,2,3,4,5].map(function(v){
var upd={};upd[item.k]=v;
return h(“button”,{key:v,onClick:function(){setEnt(function(prev){return Object.assign({},prev,upd);});},
style:{flex:1,height:44,background:v<=ent[item.k]?item.c+“18”:“rgba(0,255,200,0.03)”,border:“1px solid “+(v<=ent[item.k]?item.c+“35”:“rgba(0,255,200,0.08)”),color:v<=ent[item.k]?item.c:“rgba(0,255,200,0.18)”,fontSize:13,fontWeight:700,clipPath:“polygon(4px 0,100% 0,calc(100% - 4px) 100%,0 100%)”,minHeight:44,touchAction:“manipulation”}},v);})));}),
h(“textarea”,{value:ent.note,onChange:function(e){var v=e.target.value;setEnt(function(prev){return Object.assign({},prev,{note:v});});},placeholder:“Note\u2026”,style:{width:“100%”,padding:10,background:“rgba(0,255,200,0.03)”,border:“1px solid rgba(0,255,200,0.08)”,fontSize:11,resize:“none”,height:48,outline:“none”,display:“block”,color:FG}}),
h(“button”,{onClick:addEntry,style:{width:“100%”,marginTop:12,padding:“14px 0”,background:“rgba(0,255,200,0.1)”,border:“1px solid rgba(0,255,200,0.25)”,fontSize:12,fontWeight:700,color:GLOW,letterSpacing:“0.14em”,minHeight:48,touchAction:“manipulation”,clipPath:“polygon(0 0,calc(100% - 12px) 0,100% 12px,100% 100%,12px 100%,0 calc(100% - 12px))”}},”\u2713 SAVE ENTRY”)));

// ═══════════════════════════════════════════════════
// ROOT RENDER
// ═══════════════════════════════════════════════════
var TABS=[[“clock”,“Clock”,”\u29D6”],[“align”,“Align”,”\u26A1”],[“insights”,“Data”,”\u{1F4C8}”],[“science”,“Science”,”\u2726”]];

return h(“div”,{style:{minHeight:“100vh”,fontFamily:FONT,background:BG,color:FG,paddingBottom:72,overflowX:“hidden”,opacity:nightDim?0.9:1,transition:“opacity 3s ease”}},
h(“div”,{style:{padding:“14px 16px 10px”,display:“flex”,justifyContent:“space-between”,alignItems:“flex-start”,background:“rgba(1,1,3,0.9)”,backdropFilter:“blur(20px)”,borderBottom:“1px solid rgba(0,255,200,0.08)”,position:“sticky”,top:0,zIndex:80}},
h(“div”,null,
h(“h1”,{style:{fontSize:19,fontWeight:700,color:GLOW,margin:0,letterSpacing:“0.18em”,textShadow:“0 0 30px rgba(0,255,200,0.4)”}},“RESONANCE”),
h(“p”,{style:{fontSize:8,color:“rgba(0,255,200,0.25)”,marginTop:2,letterSpacing:“0.14em”,fontFamily:FONT}},“9-PHASE CIRCADIAN INTELLIGENCE”)),
h(“div”,{style:{textAlign:“right”}},
h(“p”,{style:{fontSize:10,color:“rgba(0,255,200,0.22)”,margin:0,fontFamily:MONO}},dStr),
h(“div”,{style:{display:“flex”,alignItems:“center”,gap:6,marginTop:4,justifyContent:“flex-end”}},
h(“span”,{style:{width:6,height:6,borderRadius:“50%”,background:cP.color,display:“inline-block”,boxShadow:“0 0 8px “+cP.color}}),
h(“span”,{className:“pcolor”,style:{fontSize:9,color:cP.color,fontFamily:MONO,letterSpacing:“0.08em”}},cP.name.toUpperCase()),
h(“span”,{style:{fontSize:9,color:“rgba(0,255,200,0.2)”,fontFamily:MONO}},mLeft+“m”)),
h(“button”,{onClick:function(){setModal(true);},className:flashSave?“save-flash”:””,style:{marginTop:5,fontSize:9,padding:“5px 12px”,background:“rgba(0,255,200,0.06)”,border:“1px solid rgba(0,255,200,0.18)”,color:GLOW,letterSpacing:“0.1em”,clipPath:“polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)”,transition:“background 0.4s”,minHeight:32,touchAction:“manipulation”}},“✚ TRACK”))),
h(“div”,{key:tab,style:{paddingTop:4}},
tab===“clock”&&renderClock(),
tab===“align”&&renderAlign(),
tab===“insights”&&renderInsights(),
tab===“science”&&renderScience()),
h(“div”,{className:“nav”},
TABS.map(function(t){var act=tab===t[0];return h(“button”,{key:t[0],className:“nav-btn”+(act?” active”:””),onClick:function(){setTab(t[0]);}},h(“div”,{className:“nav-icon”,style:{filter:act?“drop-shadow(0 0 8px “+GLOW+”)”:“none”,transition:“filter .25s”}},t[2]),t[1].toUpperCase());})),
modalEl
);
}

ReactDOM.createRoot(document.getElementById(“root”)).render(h(App));
})();
</script>

</body>
</html>
